# üö® –ü–†–û–ë–õ–ï–ú–ê: LLM –Ω–µ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
2. –ó–∞–ø—Ä–æ—Å –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –±–µ–∫–µ–Ω–¥–∞
3. `crawl4ai_ask_node` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
4. `universal_crawler_service.crawl_with_llm_extraction()` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
5. –ö–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `state.model_copy(update={table_html, table_data})`

### ‚ùå –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **LLM –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - `extracted['items']` –ø—É—Å—Ç–æ–π
2. **Crawl4AI –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –º–µ–Ω—é**, –∞ –Ω–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã
3. **JavaScript wait script –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω** –¥–ª—è kurs.com.ua

## –ü—Ä–∏—á–∏–Ω–∞

`_crawl_with_js()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **markdown —Å—Å—ã–ª–æ–∫ –º–µ–Ω—é** –≤–º–µ—Å—Ç–æ –¥–∞–Ω–Ω—ã—Ö:
```
**üîç –ê–Ω–∞–ª–∏–∑ https://kurs.com.ua/...:**
üîó –î–µ–Ω—å–≥–∏
üîó –ù–æ–≤–æ—Å—Ç–∏
üîó –ö—É—Ä—Å –≤–∞–ª—é—Ç –≤ –ö–∏–µ–≤–µ
...
```

**–ü–æ—á–µ–º—É:**
- kurs.com.ua –∏–º–µ–µ—Ç **—Ç—è–∂–µ–ª—É—é JS –∑–∞—â–∏—Ç—É**
- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ **AJAX –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã**
- `delay_before_return_html=5.0` –∏ wait script **–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã**
- –í–æ–∑–º–æ–∂–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è **—Ä–µ–∞–ª—å–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä** (–Ω–µ headless)

## –ë—ã—Å—Ç—Ä–æ–µ –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å NBU API (RECOMMENDED) 
–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ë–∞–Ω–∫ –£–∫—Ä–∞–∏–Ω—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ API:

```python
async def get_currency_rates():
    url = "https://bank.gov.ua/NBUStatService/v1/statdirectory/exchange?json"
    response = await httpx.get(url)
    rates = response.json()
    
    # –§–æ—Ä–º–∞—Ç: [{'r030': 840, 'txt': '–î–æ–ª–∞—Ä –°–®–ê', 'rate': 41.25, ...}]
    return rates
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PrivatBank API
```python
url = "https://api.privatbank.ua/p24api/pubinfo?exchange&coursid=5"
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: [{'ccy': 'USD', 'base_ccy': 'UAH', 'buy': '41.20', 'sale': '41.60'}]
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –£–≤–µ–ª–∏—á–∏—Ç—å delay –¥–æ 15 —Å–µ–∫—É–Ω–¥
```python
delay_before_return_html=15.0,  # –ë—ã–ª–æ 5.0
```

–ò –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π wait:
```javascript
await new Promise(resolve => setTimeout(resolve, 10000)); // 10 sec initial wait
```

### –í–∞—Ä–∏–∞–Ω—Ç 4: –î–æ–±–∞–≤–∏—Ç—å Regex Fallback
–ï—Å–ª–∏ LLM –Ω–µ –∏–∑–≤–ª–µ–∫–∞–µ—Ç - –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å regex:

```python
if not extracted.get('items'):
    # Fallback: regex extraction
    import re
    pattern = r'(USD|EUR|PLN).*?(\d+\.\d{2}).*?(\d+\.\d{2})'
    matches = re.findall(pattern, content)
    extracted['items'] = [
        {'currency': m[0], 'buy': m[1], 'sell': m[2]}
        for m in matches
    ]
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API (NBU –∏–ª–∏ PrivatBank)  
**–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∫—Ä–∞—É–ª–µ—Ä–∞**: –í—ã–±—Ä–∞—Ç—å –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π —Å–∞–π—Ç (–Ω–µ kurs.com.ua)

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–∞–π—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. `https://minfin.com.ua/currency/` (–±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π)
2. `https://finance.ua/currency` (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π HTML)
3. `https://www.xe.com/currency-rates/` (–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π)

## –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–ß—Ç–æ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ:
1. **–î–æ–±–∞–≤–∏—Ç—å NBU API** –¥–ª—è –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç?
2. **–£–≤–µ–ª–∏—á–∏—Ç—å delay –¥–æ 15 —Å–µ–∫** –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑?
3. **–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–æ–π —Å–∞–π—Ç** –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∫—Ä–∞—É–ª–µ—Ä–∞?
4. **–î–æ–±–∞–≤–∏—Ç—å regex fallback** –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è?

