# âš¡ ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ° Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ—Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ Ğ· ĞšĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ñ–ÑÑ‚Ñ

## ğŸ“‹ Ğ—Ğ¼Ñ–ÑÑ‚

1. [ĞĞ³Ğ»ÑĞ´](#Ğ¾Ğ³Ğ»ÑĞ´)
2. [ĞšĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ñ–ÑÑ‚ÑŒ (ĞĞ´Ğ¸Ğ½ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ñ–Ğ»ÑŒ - Ğ Ñ–Ğ·Ğ½Ñ– Ğ Ğ°ĞºÑƒÑ€ÑĞ¸)](#ĞºĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ñ–ÑÑ‚ÑŒ)
3. [ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ–ÑÑ‚ÑŒ (ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ° Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ)](#Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ–ÑÑ‚ÑŒ)
4. [ĞÑ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°](#Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)
5. [Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½Ñ](#Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½Ñ)
6. [ĞŸÑ€Ğ¸ĞºĞ»Ğ°Ğ´](#Ğ¿Ñ€Ğ¸ĞºĞ»Ğ°Ğ´)

---

## ĞĞ³Ğ»ÑĞ´

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ— Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ Ğ·Ğ°Ğ±ĞµĞ·Ğ¿ĞµÑ‡ÑƒÑ”:

1. **ĞšĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ñ–ÑÑ‚ÑŒ**: Ğ’ÑÑ– Ñ€Ğ°ĞºÑƒÑ€ÑĞ¸ Ğ²Ñ–Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ÑÑ‚ÑŒ ĞĞ”Ğ˜Ğ Ñ– Ñ‚Ğ¾Ğ¹ Ğ¶Ğµ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ñ–Ğ»ÑŒ
2. **ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ–ÑÑ‚ÑŒ**: Ğ’ÑÑ– Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ³ĞµĞ½ĞµÑ€ÑƒÑÑ‚ÑŒÑÑ Ğ¿Ğ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ ÑˆĞ²Ğ¸Ğ´ĞºĞ¾ÑÑ‚Ñ–
3. **Web Search**: Ğ”Ğ¸Ğ½Ğ°Ğ¼Ñ–Ñ‡Ğ½Ğ¸Ğ¹ Ğ¿Ğ¾ÑˆÑƒĞº Ğ»Ğ¾Ğ³Ğ¾Ñ‚Ğ¸Ğ¿Ñ–Ğ² Ñ‚Ğ° Ñ€ĞµÑ„ĞµÑ€ĞµĞ½ÑĞ½Ğ¸Ñ… Ñ„Ğ¾Ñ‚Ğ¾
4. **Fallback**: Ğ‘Ğ°Ğ³Ğ°Ñ‚Ğ¾Ñ€Ñ–Ğ²Ğ½ĞµĞ²Ñ– fallback-Ğ¸ Ğ´Ğ»Ñ Ğ½Ğ°Ğ´Ñ–Ğ¹Ğ½Ğ¾ÑÑ‚Ñ–

---

## ĞšĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ñ–ÑÑ‚ÑŒ

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°

ĞŸÑ€Ğ¸ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ— Ğ¼Ğ½Ğ¾Ğ¶Ğ¸Ğ½Ğ¸ Ñ€Ğ°ĞºÑƒÑ€ÑÑ–Ğ² (front, side, rear) AI Ğ¼Ğ¾Ğ¶Ğµ Ğ³ĞµĞ½ĞµÑ€ÑƒĞ²Ğ°Ñ‚Ğ¸ **Ğ Ğ†Ğ—ĞĞ†** Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ñ–Ğ»Ñ–:
- Ğ Ñ–Ğ·Ğ½Ñ– ĞºĞ¾Ğ»ÑŒĞ¾Ñ€Ğ¸
- Ğ Ñ–Ğ·Ğ½Ñ– Ğ¼Ğ¾Ğ´ĞµĞ»Ñ–
- Ğ Ñ–Ğ·Ğ½Ñ– Ğ´ĞµÑ‚Ğ°Ğ»Ñ–

### Ğ Ñ–ÑˆĞµĞ½Ğ½Ñ: Session ID + Seed

```python
# 1. Ğ„Ğ´Ğ¸Ğ½Ğ¸Ğ¹ Session ID Ğ´Ğ»Ñ Ğ²ÑÑ–Ñ”Ñ— ÑĞµÑ€Ñ–Ñ—
session_id = generate_consistent_session_id(brand, model, year, color, body_type)
# ĞŸÑ€Ğ¸ĞºĞ»Ğ°Ğ´: "3f8a9b2c1d5e"

# 2. Ğ£Ğ½Ñ–ĞºĞ°Ğ»ÑŒĞ½Ğ¸Ğ¹ Seed Ğ´Ğ»Ñ ĞºĞ¾Ğ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ€Ğ°ĞºÑƒÑ€ÑÑƒ (Ğ±Ğ°Ğ·ÑƒÑ”Ñ‚ÑŒÑÑ Ğ½Ğ° session_id)
seed_front = generate_consistent_seed(session_id, "front")  # 123456
seed_side = generate_consistent_seed(session_id, "side")    # 654321
seed_rear = generate_consistent_seed(session_id, "rear")    # 789012
```

### Ğ¯Ğº Ñ†Ğµ Ğ¿Ñ€Ğ°Ñ†ÑÑ”

#### 1. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Session ID

```python
def generate_consistent_session_id(brand: str, model: str, year: int, 
                                    color: str, body_type: str) -> str:
    """
    Ğ¡Ñ‚Ğ²Ğ¾Ñ€ÑÑ” ÑƒĞ½Ñ–ĞºĞ°Ğ»ÑŒĞ½Ğ¸Ğ¹ ID Ğ´Ğ»Ñ ÑĞµÑ€Ñ–Ñ— Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ°Ğ²Ñ‚Ğ¾.
    """
    session_data = f"{brand}_{model}_{year}_{color}_{body_type}_{int(time.time())}"
    session_id = hashlib.md5(session_data.encode()).hexdigest()[:12]
    return session_id
```

#### 2. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Seed Ğ´Ğ»Ñ Ğ Ğ°ĞºÑƒÑ€ÑÑƒ

```python
def generate_consistent_seed(session_id: str, angle: str) -> int:
    """
    Ğ“ĞµĞ½ĞµÑ€ÑƒÑ” seed Ğ´Ğ»Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ñ€Ğ°ĞºÑƒÑ€ÑÑƒ.
    ĞĞ´Ğ¸Ğ½ session_id + Ñ€Ñ–Ğ·Ğ½Ñ– angles = Ñ€Ñ–Ğ·Ğ½Ñ– seeds, Ğ°Ğ»Ğµ Ğ´Ğ»Ñ ĞĞ”ĞĞĞ“Ğ Ğ°Ğ²Ñ‚Ğ¾.
    """
    seed_data = f"{session_id}_{angle}"
    seed = abs(hash(seed_data)) % 1000000
    return seed
```

#### 3. ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚ Ğ· Consistency Hints

```python
prompt = f"""
{year} {brand} {model} {body_type}, {color}, {angle} view.

CONSISTENCY: Same vehicle across all angles (Session: {session_id}, Seed: {seed}).
Show {logo_description} on front grille, clearly visible.

Photorealistic automotive photography, authentic {brand} design.
Same exact vehicle from different angle, identical color and details.
"""
```

---

## ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ–ÑÑ‚ÑŒ

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°

ĞŸĞ¾ÑĞ»Ñ–Ğ´Ğ¾Ğ²Ğ½Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ¿Ğ¾Ğ²Ñ–Ğ»ÑŒĞ½Ğ°:
- 3 Ñ€Ğ°ĞºÑƒÑ€ÑĞ¸ Ã— 10 ÑĞµĞºÑƒĞ½Ğ´ = **30 ÑĞµĞºÑƒĞ½Ğ´**
- ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡ Ñ‡ĞµĞºĞ°Ñ” Ğ´Ğ¾Ğ²Ğ³Ğ¾
- ĞĞµĞµÑ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğµ Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½Ñ Ñ€ĞµÑÑƒÑ€ÑÑ–Ğ²

### Ğ Ñ–ÑˆĞµĞ½Ğ½Ñ: Async/Await + sync_to_async/async_to_sync

```python
# ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ 3 Ñ€Ğ°ĞºÑƒÑ€ÑÑ–Ğ² = ~10 ÑĞµĞºÑƒĞ½Ğ´ (Ğ·Ğ°Ğ¼Ñ–ÑÑ‚ÑŒ 30)
angle_prompts = sync_generate_all_prompts(...)  # ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ¸Ğ¹ web search
generated_images = sync_generate_all_images(...)  # ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ
```

### Ğ•Ñ‚Ğ°Ğ¿Ğ¸ ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾ÑÑ‚Ñ–

#### Ğ•Ñ‚Ğ°Ğ¿ 1: ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ¸Ğ¹ Web Search

```python
async def async_generate_all_prompts(...):
    # 1. Web search Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¾Ñ‚Ğ¸Ğ¿Ñƒ (Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·)
    logo_info = await async_web_search_for_logo(brand)
    
    # 2. ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ¸Ğ¹ Ğ¿Ğ¾ÑˆÑƒĞº Ñ€ĞµÑ„ĞµÑ€ĞµĞ½ÑĞ½Ğ¸Ñ… Ñ„Ğ¾Ñ‚Ğ¾ Ğ´Ğ»Ñ Ğ’Ğ¡Ğ†Ğ¥ Ñ€Ğ°ĞºÑƒÑ€ÑÑ–Ğ²
    photo_tasks = [
        async_real_photo_search(brand, model, year, "front"),
        async_real_photo_search(brand, model, year, "side"),
        async_real_photo_search(brand, model, year, "rear"),
    ]
    
    references = await asyncio.gather(*photo_tasks)  # ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ¾!
    
    # 3. ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ–Ğ²
    prompt_tasks = [
        async_generate_prompt_for_angle(..., angle="front", ...),
        async_generate_prompt_for_angle(..., angle="side", ...),
        async_generate_prompt_for_angle(..., angle="rear", ...),
    ]
    
    prompts = await asyncio.gather(*prompt_tasks)  # ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ¾!
```

#### Ğ•Ñ‚Ğ°Ğ¿ 2: ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ° Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ—Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ

```python
async def async_generate_all_images(angle_prompts, ...):
    # ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ’Ğ¡Ğ†Ğ¥ Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ
    tasks = [
        async_generate_image_from_prompt(prompt_data_1, ...),
        async_generate_image_from_prompt(prompt_data_2, ...),
        async_generate_image_from_prompt(prompt_data_3, ...),
    ]
    
    images = await asyncio.gather(*tasks)  # ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ¾!
```

### Django ĞĞ´Ğ°Ğ¿Ñ‚ĞµÑ€Ğ¸

```python
from asgiref.sync import sync_to_async, async_to_sync

# 1. ĞŸĞµÑ€ĞµÑ‚Ğ²Ğ¾Ñ€ÑÑ”Ğ¼Ğ¾ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñƒ Ñ„ÑƒĞ½ĞºÑ†Ñ–Ñ Ğ½Ğ° Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñƒ
async_search = sync_to_async(search_brand_logo_info, thread_sensitive=False)
logo_info = await async_search(brand)

# 2. ĞŸĞµÑ€ĞµÑ‚Ğ²Ğ¾Ñ€ÑÑ”Ğ¼Ğ¾ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñƒ Ñ„ÑƒĞ½ĞºÑ†Ñ–Ñ Ğ½Ğ° ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñƒ (Ğ´Ğ»Ñ Django view)
sync_wrapper = async_to_sync(async_generate_all_prompts)
prompts = sync_wrapper(brand, model, year, color, body_type, angles)
```

---

## ĞÑ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ° Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

```
backend/apps/chat/
â”œâ”€â”€ views/
â”‚   â””â”€â”€ image_generation_views.py     # Django REST View (ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¸Ğ¹)
â””â”€â”€ utils/
    â”œâ”€â”€ async_image_generation.py      # âš¡ ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ° Ğ»Ğ¾Ğ³Ñ–ĞºĞ°
    â”œâ”€â”€ brand_logo_search.py           # Web search (DuckDuckGo)
    â””â”€â”€ brand_logo_descriptions.py     # Fallback Ğ±Ğ°Ğ·Ğ° Ğ»Ğ¾Ğ³Ğ¾Ñ‚Ğ¸Ğ¿Ñ–Ğ²
```

### ĞŸĞ¾Ñ‚Ñ–Ğº Ğ”Ğ°Ğ½Ğ¸Ñ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Django View (ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¸Ğ¹)                                       â”‚
â”‚  generate_car_images_with_mock_algorithm()                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. sync_generate_all_prompts() [async_to_sync]                â”‚
â”‚     â”œâ”€ Web search Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¾Ñ‚Ğ¸Ğ¿Ñƒ (async)                          â”‚
â”‚     â”œâ”€ ĞŸĞ¾ÑˆÑƒĞº Ñ€ĞµÑ„ĞµÑ€ĞµĞ½ÑĞ½Ğ¸Ñ… Ñ„Ğ¾Ñ‚Ğ¾ (async, Ğ¿Ğ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ¾)               â”‚
â”‚     â””â”€ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ–Ğ² (async, Ğ¿Ğ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ¾)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ angle_prompts (Ğ· session_id + seeds)
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. sync_generate_all_images() [async_to_sync]                 â”‚
â”‚     â”œâ”€ ĞŸĞµÑ€ĞµĞºĞ»Ğ°Ğ´ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ–Ğ² (async)                                â”‚
â”‚     â”œâ”€ DALL-E / Pollinations (async, Ğ¿Ğ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ¾)                â”‚
â”‚     â””â”€ Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ image objects                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ generated_images
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Django Response                                                â”‚
â”‚  {images: [...], session_id: "...", success: true}             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½Ñ

### Ğ’Ğ¸ĞºĞ»Ğ¸Ğº Ğ· Django View

```python
# backend/apps/chat/views/image_generation_views.py

from apps.chat.utils.async_image_generation import (
    sync_generate_all_prompts,
    sync_generate_all_images
)

# 1. ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ–Ğ² Ğ· web search
angle_prompts = sync_generate_all_prompts(
    brand="Renault",
    model="Clio",
    year=2019,
    color="blue",
    body_type="hatchback",
    angles=["front", "side", "rear"]
)

# 2. ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ
generated_images = sync_generate_all_images(
    angle_prompts=angle_prompts,
    canonical_data=canonical_data,
    mock_cmd=mock_cmd,
    get_angle_title=get_angle_title
)
```

### Fallback ĞœĞµÑ…Ğ°Ğ½Ñ–Ğ·Ğ¼

```python
try:
    # Ğ¡Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñƒ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ
    generated_images = sync_generate_all_images(...)
except Exception as e:
    # Fallback Ğ½Ğ° Ğ¿Ğ¾ÑĞ»Ñ–Ğ´Ğ¾Ğ²Ğ½Ñƒ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ
    generated_images = []
    for angle_data in angle_prompts:
        # ĞŸĞ¾ÑĞ»Ñ–Ğ´Ğ¾Ğ²Ğ½Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ (ÑÑ‚Ğ°Ñ€Ğ¸Ğ¹ Ğ¿Ñ–Ğ´Ñ…Ñ–Ğ´)
        ...
```

---

## ĞŸÑ€Ğ¸ĞºĞ»Ğ°Ğ´

### Ğ—Ğ°Ğ¿Ğ¸Ñ‚

```bash
POST /api/chat/generate-car-images/
{
  "car_data": {
    "brand": "Renault",
    "model": "Clio",
    "year": 2019,
    "color": "blue",
    "body_type": "hatchback"
  },
  "angles": ["front", "side", "rear"],
  "use_mock_algorithm": true
}
```

### Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ÑŒ

```json
{
  "success": true,
  "session_id": "CAR-3f8a9b2c",
  "images": [
    {
      "url": "https://image.pollinations.ai/prompt/...",
      "angle": "front",
      "seed": 123456,
      "session_id": "CAR-3f8a9b2c",
      "isMain": true,
      "prompt": "2019 Renault Clio hatchback, blue, front view. CONSISTENCY: Same vehicle, session CAR-3f8a9b2c..."
    },
    {
      "url": "https://image.pollinations.ai/prompt/...",
      "angle": "side",
      "seed": 654321,
      "session_id": "CAR-3f8a9b2c",
      "isMain": false,
      "prompt": "2019 Renault Clio hatchback, blue, side view. CONSISTENCY: Same vehicle, session CAR-3f8a9b2c..."
    },
    {
      "url": "https://image.pollinations.ai/prompt/...",
      "angle": "rear",
      "seed": 789012,
      "session_id": "CAR-3f8a9b2c",
      "isMain": false,
      "prompt": "2019 Renault Clio hatchback, blue, rear view. CONSISTENCY: Same vehicle, session CAR-3f8a9b2c..."
    }
  ],
  "total_generated": 3,
  "debug": {
    "requested_angles": ["front", "side", "rear"],
    "generated_count": 3
  }
}
```

### Ğ›Ğ¾Ğ³ Ğ’Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ½Ñ

```
[AsyncGen] ğŸš€ Starting parallel prompt generation for 3 angles
[AsyncSearch] âœ… Logo info found for Renault
[AsyncSearch] âœ… Reference photo found for front
[AsyncSearch] âœ… Reference photo found for side
[AsyncSearch] âš ï¸ No reference photo for rear
[AsyncGen] âœ… Generated 3 prompts in parallel
[AsyncGen] ğŸ”— All prompts share session_id for consistency

[AsyncImages] ğŸš€ Starting parallel image generation for 3 angles
[AsyncImage] ğŸ”„ Generating image for angle: front
[AsyncImage] ğŸ”„ Generating image for angle: side
[AsyncImage] ğŸ”„ Generating image for angle: rear
[AsyncImage] âœ… Generated front with seed 123456
[AsyncImage] âœ… Generated side with seed 654321
[AsyncImage] âœ… Generated rear with seed 789012
[AsyncImages] âœ… Generated 3/3 images in parallel
```

---

## ğŸ¯ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚

### ĞšĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ñ–ÑÑ‚ÑŒ âœ…
- Ğ’ÑÑ– Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ¼Ğ°ÑÑ‚ÑŒ **Ğ¾Ğ´Ğ¸Ğ½ session_id**: `CAR-3f8a9b2c`
- ĞšĞ¾Ğ¶ĞµĞ½ Ñ€Ğ°ĞºÑƒÑ€Ñ Ğ¼Ğ°Ñ” **ÑƒĞ½Ñ–ĞºĞ°Ğ»ÑŒĞ½Ğ¸Ğ¹ seed** (123456, 654321, 789012)
- AI Ğ³ĞµĞ½ĞµÑ€ÑƒÑ” **ĞĞ”ĞĞ• Ğ°Ğ²Ñ‚Ğ¾** Ğ· Ñ€Ñ–Ğ·Ğ½Ğ¸Ñ… ĞºÑƒÑ‚Ñ–Ğ² (Ğ·Ğ°Ğ²Ğ´ÑĞºĞ¸ consistency hints Ğ² Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°Ñ…)

### Ğ¨Ğ²Ğ¸Ğ´ĞºÑ–ÑÑ‚ÑŒ âš¡
- **Ğ Ğ°Ğ½Ñ–ÑˆĞµ**: 3 Ñ€Ğ°ĞºÑƒÑ€ÑĞ¸ Ã— 10 ÑĞµĞº = 30 ÑĞµĞºÑƒĞ½Ğ´
- **Ğ¢ĞµĞ¿ĞµÑ€**: 3 Ñ€Ğ°ĞºÑƒÑ€ÑĞ¸ Ğ¿Ğ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ¾ = ~10 ÑĞµĞºÑƒĞ½Ğ´
- **ĞŸÑ€Ğ¸ÑĞºĞ¾Ñ€ĞµĞ½Ğ½Ñ**: **3x ÑˆĞ²Ğ¸Ğ´ÑˆĞµ**

### ĞĞ°Ğ´Ñ–Ğ¹Ğ½Ñ–ÑÑ‚ÑŒ ğŸ›¡ï¸
- Web search fallback Ğ½Ğ° Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñƒ Ğ±Ğ°Ğ·Ñƒ
- DALL-E fallback Ğ½Ğ° Pollinations
- Async fallback Ğ½Ğ° sync Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ

---

## ğŸ“š Ğ”Ğ¾Ğ´Ğ°Ñ‚ĞºĞ¾Ğ²Ñ– Ğ ĞµÑÑƒÑ€ÑĞ¸

- [Django Async Views](https://docs.djangoproject.com/en/stable/topics/async/)
- [asgiref.sync](https://github.com/django/asgiref)
- [Pollinations.ai API](https://pollinations.ai/)
- [OpenAI DALL-E 3](https://platform.openai.com/docs/guides/images)

