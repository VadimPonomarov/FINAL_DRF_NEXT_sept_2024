# üöó AutoRia Backend API - –ü–æ–≤–Ω–µ –∫–µ—Ä—ñ–≤–Ω–∏—Ü—Ç–≤–æ

## üìã –û–≥–ª—è–¥

–°—É—á–∞—Å–Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∂—É –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤ –∑ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é AI/LLM —Ç–∞ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö API —Å–µ—Ä–≤—ñ—Å—ñ–≤.

## üéØ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
- **Swagger UI**: http://localhost:8000/api/doc/
- **ReDoc**: http://localhost:8000/api/redoc/
- **OpenAPI Schema**: –î–æ—Å—Ç—É–ø–Ω–∞ —É —Ñ–æ—Ä–º–∞—Ç–∞—Ö YAML —Ç–∞ JSON

### Postman –∫–æ–ª–µ–∫—Ü—ñ—ó
- –û—Å–Ω–æ–≤–Ω–∞: `backend/AutoRia_API_Complete_Test_Suite.postman_collection.json`
- –î–µ—Ç–∞–ª—å–Ω–∏–π –≥–∞–π–¥: `backend/POSTMAN_TESTING_GUIDE.md`

---

## ü§ñ AI/LLM –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –º–æ–¥–µ—Ä–∞—Ü—ñ—è –∫–æ–Ω—Ç–µ–Ω—Ç—É
- **Hard-block —Å–ª–æ–≤–Ω–∏–∫**: 161 —Å–ª–æ–≤–æ (—É–∫—Ä–∞—ó–Ω—Å—å–∫–∞, —Ä–æ—Å—ñ–π—Å—å–∫–∞, –∞–Ω–≥–ª—ñ–π—Å—å–∫–∞, —Ç—Ä–∞–Ω—Å–ª—ñ—Ç–µ—Ä–∞—Ü—ñ—è)
- **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: 58ms –¥–ª—è –ø—Ä–æ—Ñ–∞–Ω–Ω–æ—Å—Ç—ñ, ~15s –¥–ª—è topic analysis
- **LLM Provider**: g4f + PollinationsAI (–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ)
- **–¢–æ—á–Ω—ñ—Å—Ç—å**: 100% –¥–ª—è –ø—Ä–æ—Ñ–∞–Ω–Ω–æ—Å—Ç—ñ

### AI –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è
- **–ê–≤–∞—Ç–∞—Ä–∏**: —á–µ—Ä–µ–∑ g4f API
- **–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ–≥–æ–ª–æ—à–µ–Ω—å**: —á–µ—Ä–µ–∑ LLM prompts

**–ö–æ–¥**: `backend/core/services/llm_moderation.py`

---

## üåê –ó–æ–≤–Ω—ñ—à–Ω—ñ API –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó

### üí∞ –í–∞–ª—é—Ç–Ω—ñ –∫—É—Ä—Å–∏ (PrivatBank + NBU)
```python
# GET /api/currency/rates/
# POST /api/currency/convert/
{
    "amount": 100,
    "from_currency": "UAH",
    "to_currency": "USD"
}
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ**:
- –ö–µ—à Redis 24h
- DB fallback –¥–ª—è —Å—Ç–∞—Ä–∏—Ö –¥–∞–Ω–∏—Ö
- –ö—Ä–æ—Å—Å-–∫–æ–Ω–≤–µ—Ä—Å—ñ—è —á–µ—Ä–µ–∑ UAH

**–ö–æ–¥**: `backend/apps/currency/services.py`

### üó∫Ô∏è Google Maps Geocoding
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –∞–¥—Ä–µ—Å
- –†–µ–≥—ñ–æ–Ω/–º—ñ—Å—Ç–æ resolution

### ü§ñ g4f API
- –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑–æ–±—Ä–∞–∂–µ–Ω—å
- LLM –∑–∞–ø–∏—Ç–∏ (–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ)

---

## üë• –°–∏—Å—Ç–µ–º–∞ –†–æ–ª–µ–π —Ç–∞ –ü—Ä–∞–≤

### –¢–∏–ø–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

| –†–æ–ª—å | –ü—Ä–∞–≤–∞ | –û–±–º–µ–∂–µ–Ω–Ω—è |
|------|-------|-----------|
| **–ü–æ–∫—É–ø–µ—Ü—å** | –ü–µ—Ä–µ–≥–ª—è–¥ –æ–≥–æ–ª–æ—à–µ–Ω—å, –ø–æ—à—É–∫, —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è | –ù–µ–º–∞—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–≥–æ–ª–æ—à–µ–Ω—å |
| **–ü—Ä–æ–¥–∞–≤–µ—Ü—å (Basic)** | + –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–≥–æ–ª–æ—à–µ–Ω—å | –ú–∞–∫—Å–∏–º—É–º 1 –∞–∫—Ç–∏–≤–Ω–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è |
| **–ü—Ä–æ–¥–∞–≤–µ—Ü—å (Premium)** | + –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞, –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∞ –º–æ–¥–µ—Ä–∞—Ü—ñ—è | –ë–µ–∑ –æ–±–º–µ–∂–µ–Ω—å |
| **–ú–µ–Ω–µ–¥–∂–µ—Ä** | + –ú–æ–¥–µ—Ä–∞—Ü—ñ—è –∫–æ–Ω—Ç–µ–Ω—Ç—É | –ù–µ–º–∞—î –∑–º—ñ–Ω–∏ —Ç–∏–ø—ñ–≤ –∞–∫–∞—É–Ω—Ç—ñ–≤ |
| **–°—É–ø–µ—Ä—é–∑–µ—Ä** | –ü–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø | –í—Å–µ –¥–æ–∑–≤–æ–ª–µ–Ω–æ |

### Permissions
```python
# backend/core/permissions/permissions.py
IsSuperUser         # –¢—ñ–ª—å–∫–∏ —Å—É–ø–µ—Ä—é–∑–µ—Ä
IsPremiumUser       # Premium –ø—ñ–¥–ø–∏—Å–∫–∞
IsOwnerOrReadOnly   # –¢—ñ–ª—å–∫–∏ –≤–ª–∞—Å–Ω–∏–∫ –º–æ–∂–µ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏
```

---

## üîê –°—É–ø–µ—Ä—é–∑–µ—Ä—Å—å–∫—ñ –ï–Ω–¥–ø–æ—ñ–Ω—Ç–∏

### –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å–∞–º–∏ –æ–≥–æ–ª–æ—à–µ–Ω—å

```http
# –û—Ç—Ä–∏–º–∞—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Å—Ç–∞—Ç—É—Å
GET /api/ads/admin/{ad_id}/status/

# –ó–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è
PATCH /api/ads/admin/{ad_id}/status/
{
    "status": "active",  # pending, active, rejected, blocked
    "reason": "–ú–æ–¥–µ—Ä–∞—Ü—ñ—è –ø—Ä–æ–π–¥–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ"
}

# –ü–∞–∫–µ—Ç–Ω–∞ –∑–º—ñ–Ω–∞ —Å—Ç–∞—Ç—É—Å—ñ–≤
POST /api/ads/admin/bulk-status-update/
{
    "ad_ids": [1, 2, 3],
    "status": "active"
}
```

### –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–∏–ø–∞–º–∏ –∞–∫–∞—É–Ω—Ç—ñ–≤

```http
# –ó–º—ñ–Ω–∏—Ç–∏ —Ç–∏–ø –∞–∫–∞—É–Ω—Ç—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
POST /api/accounts/change-type/{user_id}/
{
    "account_type": "premium",  # basic, premium
    "expires_at": "2025-12-31T23:59:59Z"
}

# –ü–∞–∫–µ—Ç–Ω–∞ –∑–º—ñ–Ω–∞ —Ç–∏–ø—ñ–≤
POST /api/accounts/bulk-change-type/
{
    "user_ids": [1, 2, 3],
    "account_type": "premium"
}
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏

```http
# –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
GET /api/ads/admin/statistics/

# –í—ñ–¥–ø–æ–≤—ñ–¥—å:
{
    "total_ads": 1523,
    "active_ads": 1234,
    "pending_moderation": 45,
    "rejected_ads": 78,
    "blocked_ads": 12,
    "total_users": 567,
    "premium_users": 89,
    "daily_new_ads": 23,
    "moderation_queue_size": 45
}
```

**‚ö†Ô∏è –í–ê–ñ–õ–ò–í–û**: –í—Å—ñ —Å—É–ø–µ—Ä—é–∑–µ—Ä—Å—å–∫—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏:
- –í–∏–º–∞–≥–∞—é—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- –ü–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å `is_superuser = True`
- –õ–æ–≥—É—é—Ç—å –≤—Å—ñ –¥—ñ—ó
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ

---

## üîç –°–∏—Å—Ç–µ–º–∞ –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó, –ü–∞–≥—ñ–Ω–∞—Ü—ñ—ó —Ç–∞ –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è

### –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –æ–≥–æ–ª–æ—à–µ–Ω—å

**–ë–∞–∑–æ–≤–∏–π URL**: `GET /api/ads/cars/`

#### –§—ñ–ª—å—Ç—Ä–∏ –ø–æ —Ü—ñ–Ω—ñ
```http
# –î—ñ–∞–ø–∞–∑–æ–Ω —Ü—ñ–Ω
/api/ads/cars/?price_min=10000&price_max=50000&currency=USD

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –≤–∞–ª—é—Ç–∞
/api/ads/cars/?currency=UAH
```

#### –§—ñ–ª—å—Ç—Ä–∏ –ø–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞—Ö
```http
# –ú–∞—Ä–∫–∞ —Ç–∞ –º–æ–¥–µ–ª—å
/api/ads/cars/?mark=Toyota&model=Camry

# –†—ñ–∫ –≤–∏–ø—É—Å–∫—É
/api/ads/cars/?year_min=2015&year_max=2023

# –ü—Ä–æ–±—ñ–≥
/api/ads/cars/?mileage_max=100000

# –¢–∏–ø –ø–∞–ª–∏–≤–∞
/api/ads/cars/?fuel_type=petrol
```

#### –§—ñ–ª—å—Ç—Ä–∏ –ø–æ –ª–æ–∫–∞—Ü—ñ—ó
```http
# –†–µ–≥—ñ–æ–Ω —Ç–∞ –º—ñ—Å—Ç–æ
/api/ads/cars/?region=1&city=3

# –¢—ñ–ª—å–∫–∏ –∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
/api/ads/cars/?has_coordinates=true
```

#### –§—ñ–ª—å—Ç—Ä–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É
```http
# –°—Ç–∞—Ç—É—Å –º–æ–¥–µ—Ä–∞—Ü—ñ—ó
/api/ads/cars/?status=active

# –¢—ñ–ª—å–∫–∏ –≤–∞–ª—ñ–¥–æ–≤–∞–Ω—ñ
/api/ads/cars/?is_validated=true

# –¢–∏–ø –ø—Ä–æ–¥–∞–≤—Ü—è
/api/ads/cars/?seller_type=dealer
```

#### –ü–æ—à—É–∫ –ø–æ —Ç–µ–∫—Å—Ç—É
```http
# –ü–æ—à—É–∫ –≤ –∑–∞–≥–æ–ª–æ–≤–∫—É —Ç–∞ –æ–ø–∏—Å—ñ
/api/ads/cars/?search=Toyota+Camry+2020
```

### –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è

```http
# –ü–æ —Ü—ñ–Ω—ñ (–∑–∞ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è–º/—Å–ø–∞–¥–∞–Ω–Ω—è–º)
/api/ads/cars/?ordering=price
/api/ads/cars/?ordering=-price

# –ü–æ –¥–∞—Ç—ñ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è (–Ω–∞–π–Ω–æ–≤—ñ—à—ñ)
/api/ads/cars/?ordering=-created_at

# –ü–æ –ø—Ä–æ–±—ñ–≥—É
/api/ads/cars/?ordering=mileage

# –ú–Ω–æ–∂–∏–Ω–Ω–µ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
/api/ads/cars/?ordering=-created_at,price
```

**–î–æ—Å—Ç—É–ø–Ω—ñ –ø–æ–ª—è –¥–ª—è —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è**:
- `price`, `created_at`, `updated_at`
- `year`, `mileage`, `engine_volume`
- `views_count`, `phone_views_count`

### –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è

```http
# PageNumberPagination (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
/api/ads/cars/?page=2&page_size=20

# –í—ñ–¥–ø–æ–≤—ñ–¥—å:
{
    "count": 1523,
    "next": "http://localhost:8000/api/ads/cars/?page=3",
    "previous": "http://localhost:8000/api/ads/cars/?page=1",
    "results": [...]
}
```

**–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è**:
- –î–µ—Ñ–æ–ª—Ç–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —Å—Ç–æ—Ä—ñ–Ω–∫–∏: 10
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —Å—Ç–æ—Ä—ñ–Ω–∫–∏: 100

### –ö–æ–º–±—ñ–Ω–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏

```http
# –ü—Ä–∏–∫–ª–∞–¥: Premium Toyota Camry —É –ö–∏—î–≤—ñ –¥–æ $30k
/api/ads/cars/?mark=Toyota&model=Camry&city=1&price_max=30000&currency=USD&ordering=-created_at&page_size=20
```

---

## üìä –ö–æ–¥ —Ç–∞ –Ü–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—è

### CarAdFilter
```python
# backend/apps/ads/filters.py
class CarAdFilter(django_filters.FilterSet):
    price_min = django_filters.NumberFilter(field_name='price', lookup_expr='gte')
    price_max = django_filters.NumberFilter(field_name='price', lookup_expr='lte')
    year_min = django_filters.NumberFilter(method='filter_year_min')
    year_max = django_filters.NumberFilter(method='filter_year_max')
    # ... —ñ–Ω—à—ñ —Ñ—ñ–ª—å—Ç—Ä–∏
```

### ViewSet
```python
# backend/apps/ads/views/car_ad_views.py
class CarAdViewSet(viewsets.ModelViewSet):
    filterset_class = CarAdFilter
    pagination_class = PageNumberPagination
    ordering_fields = ['price', 'created_at', 'mileage']
    search_fields = ['title', 'description']
```

---

## üéØ Best Practices

1. **–ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—é** –¥–ª—è —Å–ø–∏—Å–∫—ñ–≤
2. **–ö–æ–º–±—ñ–Ω—É–π—Ç–µ —Ñ—ñ–ª—å—Ç—Ä–∏** –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ—à—É–∫—É
3. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è** –¥–ª—è –∫—Ä–∞—â–æ–≥–æ UX
4. **–ö–µ—à—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏** –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ñ
5. **–õ–æ–≥—É–π—Ç–µ —Å—É–ø–µ—Ä—é–∑–µ—Ä—Å—å–∫—ñ –¥—ñ—ó**

---

## üîó –ü–æ–≤'—è–∑–∞–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏

- [Backend Services](./BACKEND_SERVICES.md) - –ú–æ–¥–µ—Ä–∞—Ü—ñ—è, Celery, Media
- [Postman Testing Guide](../backend/POSTMAN_TESTING_GUIDE.md) - –ü–æ–≤–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è API
- [Setup Guide](./SETUP_GUIDE.md) - –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤

---

**–í–µ—Ä—Å—ñ—è**: 2.0  
**–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è**: 2025-01-25

