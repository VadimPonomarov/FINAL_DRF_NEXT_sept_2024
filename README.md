# üéì Full-Stack –ù–∞–≤—á–∞–ª—å–Ω–∞ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ - Modern Web Development

[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)](https://python.org)
[![Django](https://img.shields.io/badge/Django-5.0+-green.svg)](https://djangoproject.com)
[![Next.js](https://img.shields.io/badge/Next.js-15+-black.svg)](https://nextjs.org)
[![React](https://img.shields.io/badge/React-19+-61DAFB.svg)](https://react.dev)
[![TypeScript](https://img.shields.io/badge/TypeScript-5+-blue.svg)](https://typescriptlang.org)
[![Docker](https://img.shields.io/badge/Docker-Ready-blue.svg)](https://docker.com)

> üéØ **–ö–æ–º–ø–ª–µ–∫—Å–Ω–∏–π –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –ø—Ä–æ–µ–∫—Ç**, —â–æ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î —Å—É—á–∞—Å–Ω—ñ –ø—ñ–¥—Ö–æ–¥–∏ –¥–æ —Ä–æ–∑—Ä–æ–±–∫–∏ full-stack –≤–µ–±-–¥–æ–¥–∞—Ç–∫—ñ–≤ –∑ **–º—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å–Ω–æ—é –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–æ—é**, **–±–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–æ—é –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é** —Ç–∞ **—ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é AI —Å–µ—Ä–≤—ñ—Å—ñ–≤**.

**–¢—Ä–∏ —Ä—ñ–≤–Ω—ñ —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ:**  
üéì **Dummy** - –±–∞–∑–æ–≤—ñ CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó —Ç–∞ API —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó  
üñ•Ô∏è **Backend Management** - —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –º—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å–∞–º–∏ —á–µ—Ä–µ–∑ iframe  
üöó **AutoRia** - –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –∑ –º–æ–¥–µ—Ä–∞—Ü—ñ—î—é, –∞–Ω–∞–ª—ñ—Ç–∏–∫–æ—é —Ç–∞ AI

---

## üåü –©–æ —Ä–æ–±–∏—Ç—å —Ü–µ–π –ø—Ä–æ–µ–∫—Ç –æ—Å–æ–±–ª–∏–≤–∏–º?

### üìö –ù–∞–≤—á–∞–ª—å–Ω–∞ —Ü—ñ–Ω–Ω—ñ—Å—Ç—å

‚úÖ **–ü–æ–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é** - –∫–æ–∂–µ–Ω –∫—Ä–æ–∫ –ø–æ—è—Å–Ω–µ–Ω–∏–π  
‚úÖ **–¢—Ä–∏ —Ä—ñ–≤–Ω—ñ —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ** - –≤—ñ–¥ –ø—Ä–æ—Å—Ç–æ–≥–æ –¥–æ —Å–∫–ª–∞–¥–Ω–æ–≥–æ  
‚úÖ **–†–µ–∞–ª—å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞** - —è–∫ —É production –ø—Ä–æ–µ–∫—Ç–∞—Ö  
‚úÖ **Best practices** - SOLID, DRY, Clean Architecture  
‚úÖ **Automatic deployment** - –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫—É  
‚úÖ **Troubleshooting guide** - –≤–∏—Ä—ñ—à–µ–Ω–Ω—è —Ç–∏–ø–æ–≤–∏—Ö –ø—Ä–æ–±–ª–µ–º

### üîê –£–Ω—ñ–∫–∞–ª—å–Ω—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

### üîê –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó

#### üéØ –ë–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –∑–∞—Ö–∏—Å—Ç—É –¥–ª—è AutoRia

**–ö–ª—é—á–æ–≤–∏–π –ø—Ä–∏–Ω—Ü–∏–ø:** –î–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ AutoRia –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ **–û–ë–ê** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ:
1. ‚úÖ **NextAuth —Å–µ—Å—Å—ñ—è** (HTTP-only cookies)
2. ‚úÖ **Backend —Ç–æ–∫–µ–Ω–∏** (Redis: access + refresh)

–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –±—É–¥—å-—è–∫–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É:
- üî¥ **–í–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç**: –ù–µ–º–∞—î NextAuth —Å–µ—Å—ñ—ó ‚Üí `/api/auth/signin`
- üü° **–ù–∏–∂—á–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç**: –ù–µ–º–∞—î backend —Ç–æ–∫–µ–Ω—ñ–≤ ‚Üí `/login`

#### üìå –î–≤–æ—Ö—Ä—ñ–≤–Ω–µ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–∞—Ö–∏—Å—Ç—É:

```mermaid
graph TD
    A[–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ‚Üí /autoria] --> B{Middleware: NextAuth —Å–µ—Å—ñ—è?}
    B -->|–ù–Ü| C[–†–µ–¥–∏—Ä–µ–∫—Ç ‚Üí /api/auth/signin]
    B -->|–¢–ê–ö| D{Layout: Backend —Ç–æ–∫–µ–Ω–∏ –≤ Redis?}
    D -->|–ù–Ü| E[–†–µ–¥–∏—Ä–µ–∫—Ç ‚Üí /login]
    D -->|–¢–ê–ö| F[‚úÖ –î–æ—Å—Ç—É–ø –¥–æ–∑–≤–æ–ª–µ–Ω–æ]
    
    C --> G[–í—Ö—ñ–¥ —á–µ—Ä–µ–∑ Google/Email]
    G --> H[NextAuth —Å–µ—Å—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–∞]
    H --> E
    
    E --> I[Django API: POST /api/v1/auth/login]
    I --> J[–û—Ç—Ä–∏–º–∞–Ω–Ω—è access + refresh —Ç–æ–∫–µ–Ω—ñ–≤]
    J --> K[–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ Redis]
    K --> L[–†–µ–¥–∏—Ä–µ–∫—Ç ‚Üí /autoria]
    L --> F
```

#### üõ°Ô∏è –†—ñ–≤–µ–Ω—å 1: Middleware (Server-Side)

**–§–∞–π–ª:** `frontend/src/middleware.ts`

```typescript
// –ü–µ—Ä–µ–≤—ñ—Ä—è—î –¢–Ü–õ–¨–ö–ò NextAuth —Å–µ—Å—ñ—é –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ
async function checkBackendAuth(req: NextRequest) {
  const token = await getToken({ req, secret: nextAuthSecret });
  
  if (!token || !token.email) {
    // –ù–µ–º–∞—î —Å–µ—Å—ñ—ó ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ signin
    return NextResponse.redirect('/api/auth/signin?callbackUrl=/autoria');
  }
  
  // –°–µ—Å—ñ—è —î ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ –¥–æ —Ä—ñ–≤–Ω—è 2 (Layout)
  return NextResponse.next();
}
```

**–©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î:**
- ‚úÖ –ù–∞—è–≤–Ω—ñ—Å—Ç—å NextAuth JWT —Ç–æ–∫–µ–Ω–∞ –≤ cookies
- ‚úÖ –í–∞–ª—ñ–¥–Ω—ñ—Å—Ç—å –ø—ñ–¥–ø–∏—Å—É —Ç–æ–∫–µ–Ω–∞
- ‚úÖ Email –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ —Ç–æ–∫–µ–Ω—ñ

**–©–æ –ù–ï –ø–µ—Ä–µ–≤—ñ—Ä—è—î:**
- ‚ùå Backend —Ç–æ–∫–µ–Ω–∏ (—Ü–µ —Ä–æ–±–∏—Ç—å –†—ñ–≤–µ–Ω—å 2)
- ‚ùå –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É (—Ü–µ —Ä–æ–±–∏—Ç—å Backend API)

#### üõ°Ô∏è –†—ñ–≤–µ–Ω—å 2: BackendTokenPresenceGate (Client-Side)

**–§–∞–π–ª:** `frontend/src/components/AutoRia/Auth/BackendTokenPresenceGate.tsx`

```typescript
export default function BackendTokenPresenceGate({ children }) {
  const checkBackendTokens = async () => {
    // 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ–∫–µ–Ω—ñ–≤ —á–µ—Ä–µ–∑ /api/auth/me
    const response = await fetch('/api/auth/me', { credentials: 'include' });
    
    if (response.ok) {
      return; // –¢–æ–∫–µ–Ω–∏ –≤–∞–ª—ñ–¥–Ω—ñ ‚úÖ
    }
    
    // 2. –°–ø—Ä–æ–±–∞ refresh –ø—Ä–∏ 401
    if (response.status === 401) {
      const refreshResponse = await fetch('/api/auth/refresh', {
        method: 'POST',
        credentials: 'include'
      });
      
      if (refreshResponse.ok) {
        return checkBackendTokens(); // –ü–æ–≤—Ç–æ—Ä–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ—Å–ª—è refresh
      }
    }
    
    // 3. –†–æ–∑—É–º–Ω–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç —á–µ—Ä–µ–∑ redirectToAuth
    const { redirectToAuth } = await import('@/utils/auth/redirectToAuth');
    redirectToAuth(currentPath, 'tokens_not_found');
  };
  
  return isAuthenticated ? children : <LoadingSpinner />;
}
```

**–©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î:**
- ‚úÖ –ù–∞—è–≤–Ω—ñ—Å—Ç—å backend —Ç–æ–∫–µ–Ω—ñ–≤ –≤ Redis
- ‚úÖ –í–∞–ª—ñ–¥–Ω—ñ—Å—Ç—å access —Ç–æ–∫–µ–Ω–∞
- ‚úÖ –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å refresh –ø—Ä–∏ –ø—Ä–æ—Ç—É—Ö–∞–Ω–Ω—ñ

#### üîÑ –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ 401/403

**401 Unauthorized (–ø—Ä–æ—Ç—É—Ö —Ç–æ–∫–µ–Ω):**
```
–ó–∞–ø–∏—Ç ‚Üí 401
  ‚Üì
fetchWithAuth –ø–µ—Ä–µ—Ö–æ–ø–ª—é—î
  ‚Üì
POST /api/auth/refresh
  ‚Üì
–ù–æ–≤–∏–π access —Ç–æ–∫–µ–Ω ‚Üí –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ Redis
  ‚Üì
RETRY –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É ‚Üí ‚úÖ –£—Å–ø—ñ—Ö
```

**403 Forbidden (–Ω–µ–º–∞—î –ø—Ä–∞–≤):**
```
–ó–∞–ø–∏—Ç ‚Üí 403
  ‚Üì
fetchWithAuth –ø–µ—Ä–µ—Ö–æ–ø–ª—é—î
  ‚Üì
–†–µ–¥–∏—Ä–µ–∫—Ç ‚Üí /login
  ‚Üì
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: "–ü–æ—Ç—Ä—ñ–±–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è"
```

#### üö™ LOGOUT vs SIGNOUT

**LOGOUT** (–≤–∏—Ö—ñ–¥ –∑ backend):
- üî∏ –í–∏–¥–∞–ª—è—î –¢–Ü–õ–¨–ö–ò backend —Ç–æ–∫–µ–Ω–∏ –∑ Redis
- ‚úÖ –ó–±–µ—Ä—ñ–≥–∞—î NextAuth —Å–µ—Å—ñ—é
- üìç –†–µ–¥–∏—Ä–µ–∫—Ç ‚Üí `/login` (–¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤)
- üîó API: `POST /api/auth/logout`
- üéØ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: –ö–Ω–æ–ø–∫–∞ "–í–∏–π—Ç–∏ –∑ AutoRia"

**SIGNOUT** (–ø–æ–≤–Ω–∏–π –≤–∏—Ö—ñ–¥):
- üî¥ –í–∏–¥–∞–ª—è—î backend —Ç–æ–∫–µ–Ω–∏ –∑ Redis
- üî¥ –í–∏–¥–∞–ª—è—î NextAuth —Å–µ—Å—ñ—é (cookies)
- üìç –†–µ–¥–∏—Ä–µ–∫—Ç ‚Üí `/api/auth/signin`
- üîó API: `POST /api/auth/signout-full`
- üéØ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: –ö–Ω–æ–ø–∫–∞ "–ü–æ–≤–Ω–∏–π –≤–∏—Ö—ñ–¥"

#### üîë –ö–ª—é—á–æ–≤—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

**1. NextAuth (–°–µ—Å—ñ–π–Ω–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è)**
- HTTP-only cookies –¥–ª—è –±–µ–∑–ø–µ–∫–∏
- JWT —Ç–æ–∫–µ–Ω–∏ –∑ –ø—ñ–¥–ø–∏—Å–æ–º
- Google OAuth + Credentials –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ events:
  ```typescript
  events: {
    signOut: async () => { /* –û—á–∏—Å—Ç–∫–∞ Redis —Ç–æ–∫–µ–Ω—ñ–≤ */ },
    signIn: async () => { /* –ü—Ä–µ–≤–µ–Ω—Ç–∏–≤–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤ */ }
  }
  ```

**2. Django JWT (Backend —Ç–æ–∫–µ–Ω–∏)**
- Access token (–∫–æ—Ä–æ—Ç–∫–∏–π TTL: 15 —Ö–≤)
- Refresh token (–¥–æ–≤–≥–∏–π TTL: 7 –¥–Ω—ñ–≤)
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ Redis (–Ω–µ –≤ localStorage!)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π refresh –ø—Ä–∏ 401

**3. Redis (–¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ —Å—Ö–æ–≤–∏—â–µ)**
- –ö–ª—é—á—ñ —Ç–æ–∫–µ–Ω—ñ–≤: `backend_auth`, `tokens:{email}`, `autoria:tokens:{email}`
- TTL –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
- –ê—Ç–æ–º–∞—Ä–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –¥–ª—è thread-safety

#### üé® UI –ú–µ—Ö–∞–Ω—ñ–∑–º–∏

**–ö–Ω–æ–ø–∫–∞ "–£–≤—ñ–π—Ç–∏"**
```typescript
<Button href="/api/auth/pre-signin">
  –£–≤—ñ–π—Ç–∏
</Button>
```
- –ü–æ–≤–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ ‚Üí signin ‚Üí login ‚Üí –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤

**–ö–Ω–æ–ø–∫–∞ "–í–∏–π—Ç–∏ –∑ AutoRia" (LOGOUT)**
```typescript
import { cleanupBackendTokens } from '@/lib/auth/cleanupAuth';

<Button onClick={async () => {
  await cleanupBackendTokens();
  window.location.href = '/login';
}}>
  –í–∏–π—Ç–∏ –∑ AutoRia
</Button>
```
- –í–∏–¥–∞–ª—è—î —Ç—ñ–ª—å–∫–∏ —Ç–æ–∫–µ–Ω–∏, –∑–±–µ—Ä—ñ–≥–∞—î NextAuth —Å–µ—Å—ñ—é
- –ë–µ–π–¥–∂ –∑–Ω–∏–∫–∞—î

**–ö–Ω–æ–ø–∫–∞ "–ü–æ–≤–Ω–∏–π –≤–∏—Ö—ñ–¥" (SIGNOUT)**
```typescript
import { signOut } from 'next-auth/react';

<Button onClick={() => signOut({ callbackUrl: '/api/auth/signin' })}>
  –ü–æ–≤–Ω–∏–π –≤–∏—Ö—ñ–¥
</Button>
```
- –í–∏–¥–∞–ª—è—î —ñ —Ç–æ–∫–µ–Ω–∏ —ñ —Å–µ—Å—ñ—é
- –ü–æ–≤–Ω–∏–π –≤–∏—Ö—ñ–¥ –∑ —Å–∏—Å—Ç–µ–º–∏

**–ë–µ–π–¥–∂ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**
- –í—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≤–∞–ª—ñ–¥–Ω–∏—Ö backend —Ç–æ–∫–µ–Ω—ñ–≤
- –ó–Ω–∏–∫–∞—î –ø—Ä–∏ LOGOUT –∞–±–æ –ø—Ä–æ—Ç—É—Ö–∞–Ω–Ω—ñ —Ç–æ–∫–µ–Ω—ñ–≤
- –ü–æ–∫–∞–∑—É—î email —Ç–∞ –∞–≤–∞—Ç–∞—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

#### ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

- üîí **–ë–µ–∑–ø–µ–∫–∞**: –¢–æ–∫–µ–Ω–∏ —Ç—ñ–ª—å–∫–∏ –≤ Redis (–Ω–µ –≤ localStorage)
- üîÑ **–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π refresh –ø—Ä–∏ 401
- üéØ **–ì–Ω—É—á–∫—ñ—Å—Ç—å**: –†–æ–∑–¥—ñ–ª—å–Ω–∏–π LOGOUT/SIGNOUT
- üìä **–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å**: –ß—ñ—Ç–∫—ñ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏ –ø–æ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∞—Ö
- ‚ö° **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: Middleware –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –∑–∞–ø–∏—Ç—ñ–≤
- üõ°Ô∏è **–ó–∞—Ö–∏—Å—Ç**: –î–≤–æ—Ö—Ä—ñ–≤–Ω–µ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ (—Å–µ—Ä–≤–µ—Ä + –∫–ª—ñ—î–Ω—Ç)

#### üìö –î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

- `AUTH_ARCHITECTURE_FIX.md` - –ü–æ–≤–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
- `AUTH_LOGOUT_SIGNOUT_PROTOCOL.md` - –ü—Ä–æ—Ç–æ–∫–æ–ª LOGOUT/SIGNOUT
- `docs/ACCESS_CONTROL_AND_401_HANDLING.md` - –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
- `docs/MULTI_LEVEL_AUTH_ARCHITECTURE.md` - –ë–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

#### üì¶ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–¥–Ω–∏–∫—ñ–≤ —ñ —Å–µ–ª–µ–∫—Ç–æ—Ä—ñ–≤ (–ø—Ä–∏–≤'—è–∑–∫–∞ –¥–æ —Ç–æ–∫–µ–Ω—ñ–≤)

–£—Å—ñ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ —Ç–∞ –¥–æ–≤—ñ–¥–Ω–∏–∫–∏, –≤–∞–∂–ª–∏–≤—ñ –¥–ª—è AutoRia (—É —Ç–æ–º—É —á–∏—Å–ª—ñ —Å–µ–ª–µ–∫—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –ª–æ–≥—ñ–Ω–∞), –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ –≤–∞–ª—ñ–¥–Ω–∏—Ö backend‚Äë—Ç–æ–∫–µ–Ω—ñ–≤ —É Redis.

- –î–∂–µ—Ä–µ–ª–æ –¥–∞–Ω–∏—Ö –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –ª–æ–≥—ñ–Ω–∞: `GET /api/autoria/users` (–ø—Ä–æ–∫—Å—ñ –¥–æ –±–µ–∫–µ–Ω–¥—É –Ω–∞ –ø—É–±–ª—ñ—á–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤)
  - –®–ª—è—Ö –æ–±—Ä–æ–±–Ω–∏–∫–∞: `frontend/src/app/api/(backend)/autoria/users/route.ts`
  - –ö–æ—Ä–µ–∫—Ç–Ω–µ —Å–∫–ª–∞–¥–∞–Ω–Ω—è –∞–¥—Ä–µ—Å–∏ –¥–æ –±–µ–∫–µ–Ω–¥—É (–±–µ–∑ –ø–æ–¥–≤–æ—î–Ω–Ω—è `/api`):
    - –ë–∞–∑–æ–≤–∏–π URL –±–µ—Ä–µ—Ç—å—Å—è –∑ `NEXT_PUBLIC_BACKEND_URL`
    - –Ø–∫—â–æ –∑–º—ñ–Ω–Ω–∞ –≤–∂–µ –º—ñ—Å—Ç–∏—Ç—å `/api`, –¥—Ä—É–≥–∏–π `/api` –Ω–µ –¥–æ–¥–∞—î—Ç—å—Å—è
  - –ù–∞ –∫–ª—ñ—î–Ω—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è React Query —ñ `BackendUsersComboBox`

- –£—Å—ñ —ñ–Ω—à—ñ –¥–æ–≤—ñ–¥–Ω–∏–∫–∏/—Å–µ–ª–µ–∫—Ç–æ—Ä–∏ –¥–ª—è —Ñ–æ—Ä–º (—Ç–∏–ø–∏ –æ–±–ª—ñ–∫–æ–≤–æ–∫, –¥–æ–≤—ñ–¥–Ω–∏–∫–∏, —Ç–æ—â–æ) –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –∑–∞ —Å—Ö–µ–º–æ—é:
  1) –ö–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π –∑–∞–ø–∏—Ç ‚Üí –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π `app/api` —Ä–æ—É—Ç (–¥–µ –¥–æ–¥–∞—é—Ç—å—Å—è —Ç–æ–∫–µ–Ω–∏ –∑ Redis)
  2) –£ —Ä–∞–∑—ñ `401` ‚Äì –∞–≤—Ç–æ‚Äërefresh —á–µ—Ä–µ–∑ `POST /api/auth/refresh` + –ø–æ–≤—Ç–æ—Ä –∑–∞–ø–∏—Ç—É
  3) –£ —Ä–∞–∑—ñ `403` ‚Äì —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`

- –¢–æ—á–∫–∏ –≤—ñ–¥–º–æ–≤–∏ —Ç–∞ –¥—ñ—ó:
  - –ù–µ–º–∞—î NextAuth —Å–µ—Å—ñ—ó ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/api/auth/signin`
  - –ù–µ–º–∞—î —Ç–æ–∫–µ–Ω—ñ–≤ —É Redis ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`
  - –ü—Ä–æ–±–ª–µ–º–∏ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –±–µ–∫–µ–Ω–¥‚ÄëURL ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ `NEXT_PUBLIC_BACKEND_URL` (–º–∞—î –±—É—Ç–∏ `http://localhost/api` —É dev –∑–∞ nginx)

##### üîç –¢—Ä–∞–±–ª—à—É—Ç—ñ–Ω–≥ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (Login)

1) –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏ Network/Console –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ `/login`:
   - `GET /api/autoria/users` –º–∞—î –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ `{ success: true, data: { results, count } }`
2) –Ø–∫—â–æ —Å—Ç–∞—Ç—É—Å 404/500:
   - –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ `NEXT_PUBLIC_BACKEND_URL` –≤–∫–∞–∑—É—î –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ö–æ—Å—Ç —ñ –ø—Ä–µ—Ñ—ñ–∫—Å `/api`
   - –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Ä–æ—É—Ç –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–¥–≤–æ—î–Ω–Ω—è `/api`
3) –Ø–∫—â–æ —Å—Ç–∞—Ç—É—Å 401:
   - –ú–∞—î —Å–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∞–≤—Ç–æ‚Äërefresh; –∑–∞ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ refresh ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`
4) –Ø–∫—â–æ —Å—Ç–∞—Ç—É—Å 403:
   - –ù–µ–≥–∞–π–Ω–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login` (–Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø—Ä–∞–≤)

‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è** - –≤—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ –≤ –æ–¥–Ω–æ–º—É UI —á–µ—Ä–µ–∑ iframe  
‚úÖ **AI —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è** - —á–∞—Ç –∑ LLM, –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑–æ–±—Ä–∞–∂–µ–Ω—å, –º–æ–¥–µ—Ä–∞—Ü—ñ—è –∫–æ–Ω—Ç–µ–Ω—Ç—É  
‚úÖ **–ö—Ä–∏–ø—Ç–æ–∑–∞—Ö–∏—Å—Ç –∫–ª—é—á—ñ–≤** ‚Äî frontend: —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è OAuth —Å–µ–∫—Ä–µ—Ç—ñ–≤ (Fernet); backend: —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è API‚Äë–∫–ª—é—á—ñ–≤/—Å–µ–∫—Ä–µ—Ç—ñ–≤ —ñ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —á–µ—Ä–µ–∑ EncryptionService (Fernet+PBKDF2 –≤—ñ–¥ SECRET_KEY)  
‚úÖ **–ú—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞** - –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ, –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Å–∏–¥—ñ–Ω–≥** - –≥–æ—Ç–æ–≤–∞ –ë–î –∑ —Ç–µ—Å—Ç–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏ –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É

---

## üîó –í–∑–∞—î–º–æ–¥—ñ—è Backend ‚Üî Celery ‚Üî Mailing —á–µ—Ä–µ–∑ RabbitMQ

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Ç–∞ —Ä–æ–ª—ñ
- Backend (Django/DRF) ‚Äî –ø—É–±–ª—ñ–∫—É—î –∑–∞–¥–∞—á—ñ (producer) —ñ –ø—Ä–∏–π–º–∞—î webhooks/–≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ –≤–∏–∫–ª–∏–∫–∏
- Celery Worker ‚Äî –≤–∏–∫–æ–Ω—É—î —Ñ–æ–Ω–æ–≤—ñ –∑–∞–¥–∞—á—ñ (consumer), —á–µ—Ä–≥–∏: `email`, `notifications`, `data_processing`, `cleanup`
- Celery Beat ‚Äî –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–∏—Ö –∑–∞–¥–∞—á
- Mailing ‚Äî –æ–∫—Ä–µ–º–∏–π —Å–µ—Ä–≤—ñ—Å —Ä–æ–∑—Å–∏–ª–∫–∏ email, —Ç–∞–∫–æ–∂ —Å–ø–æ–∂–∏–≤–∞—î —á–µ—Ä–≥—É `email`
- RabbitMQ ‚Äî –±—Ä–æ–∫–µ—Ä –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (AMQP), –º–∞—Ä—à—Ä—É—Ç–∏–∑—É—î –∑–∞–¥–∞—á—ñ —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ —á–µ—Ä–≥–∏

### –ë–∞–∑–æ–≤–∏–π –ø–æ—Ç—ñ–∫
1) –ü–æ–¥—ñ—è –≤ –±–µ–∫–µ–Ω–¥—ñ (—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è, –º–æ–¥–µ—Ä–∞—Ü—ñ—è, —â–æ–¥–µ–Ω–Ω–∏–π –¥–∞–π–¥–∂–µ—Å—Ç)
2) Backend —Å—Ç–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É –≤ RabbitMQ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `email.send_welcome`, `data_processing.update_exchange_rates`)
3) –í–æ—Ä–∫–µ—Ä Celery –∞–±–æ —Å–µ—Ä–≤—ñ—Å Mailing —Å–ø–æ–∂–∏–≤–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—ó —á–µ—Ä–≥–∏
4) –†–µ–∑—É–ª—å—Ç–∞—Ç/—Å—Ç–∞—Ç—É—Å –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è (Redis/–ë–î/–ª–æ–≥–∏), –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è callback —É Backend

### –¢–æ—á–∫–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
- Backend ‚Üí Celery (–∫–ª–∞—î–Ω—Ç): `core.celery_client.celery_client` (–≤–∏–∫–ª–∏–∫–∞—î `delay()/apply_async()`)
- Celery ‚Üí Backend (internal API):
  - `/internal/reports/daily-digest/trigger`
  - `/internal/exchange-rates/update`
  - `/health/*` (–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤'—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π)
- Backend ‚Üí Mailing: –ø—É–±–ª—ñ–∫–∞—Ü—ñ—è –∑–∞–¥–∞—á —É —á–µ—Ä–≥—É `email` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `send_email_task`)

### –ß–µ—Ä–≥–∏ —Ç–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è
- `email` ‚Äî —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—ñ/–º–∞—Å–æ–≤—ñ –ª–∏—Å—Ç–∏, –¥–∞–π–¥–∂–µ—Å—Ç–∏ (—Å–ø–æ–∂–∏–≤–∞—é—Ç—å: Mailing, Celery Worker)
- `notifications` ‚Äî push/SMS/—Å–∏—Å—Ç–µ–º–Ω—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è (Celery Worker)
- `data_processing` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ–≤—ñ–¥–Ω–∏–∫—ñ–≤, –∫—É—Ä—Å–∏ –≤–∞–ª—é—Ç, –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó (Celery Worker)
- `cleanup` ‚Äî –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤, health-check, –±–µ–∫–∞–ø–∏ (Celery Worker)

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á (—É–∑–≥–æ–¥–∂–µ–Ω–æ –∑ —Å–µ—Ä–≤—ñ—Å–∞–º–∏)
- Email/Mailing:
  - `tasks.email_tasks.send_email_task(to, subject, body)` ‚Üí Mailing –Ω–∞–¥—Å–∏–ª–∞—î —á–µ—Ä–µ–∑ SMTP
  - `tasks.email_tasks.send_daily_digest_task()` ‚Üí –∑–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –¥–æ Backend `/internal/reports/daily-digest/trigger`
- Data Processing:
  - `tasks.data_processing_tasks.update_exchange_rates_task()` ‚Üí `/internal/exchange-rates/update`
- Maintenance:
  - `tasks.cleanup_tasks.system_health_check_task()` ‚Üí GET `/health/*`, –ª–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤

### –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)
–í–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è —É `celery-service/config/celery_app.py` —á–µ—Ä–µ–∑ `app.conf.beat_schedule` (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏):
- 02:00 ‚Äî —â–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø/–æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è (`cleanup`)
- 00 —Ö–≤ —â–æ–≥–æ–¥–∏–Ω–∏ ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç (`data_processing`)
- 08:00 ‚Äî —Ä–∞–Ω–∫–æ–≤—ñ –¥–∞–π–¥–∂–µ—Å—Ç–∏ (`email`)

### –ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å —Ç–∞ –Ω–∞–π–∫—Ä–∞—â—ñ –ø—Ä–∞–∫—Ç–∏–∫–∏
- –Ü–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å –∑–∞–¥–∞—á: —É–Ω–∏–∫–∞—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –æ–±—Ä–æ–±–∫–∏ –ø—Ä–∏ —Ä–µ—Ç—Ä–∞—è—Ö
- –†–µ—Ç—Ä–∞—ó –∑ backoff (`max_retries`, `retry_delay`), dead-letter –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- –û–±–º–µ–∂–µ–Ω–Ω—è —á–∞—Å—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –û–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á ‚Üí —ñ–∑–æ–ª—è—Ü—ñ—è –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Flower (`:5555`) —Ç–∞ –ª–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä—ñ–≤

–î–µ—Ç–∞–ª—ñ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –ø—Ä–∏–∫–ª–∞–¥–∏ –∫–æ–¥—É: `celery-service/README.md` (—Ä–æ–∑–¥—ñ–ª ¬´–ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)¬ª).

---

## üí¨ –ß–∞—Ç–±–æ—Ç (Backend + Frontend)

### Backend (Django/DRF + LLM)
- –°–µ—Ä–≤—ñ—Å: `backend/apps/chat/` (–µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ REST + (–æ–ø—Ü.) WebSocket —á–µ—Ä–µ–∑ Channels).
- LLM-—à–∞—Ä: `core/services/chat_ai.py` (–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∏, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è –º–æ–¥–µ–ª–µ–π, timeouts, retries).
- –ß–µ—Ä–≥–∏: –¥–æ–≤–≥—ñ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó/–∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó ‚Äî —É Celery (`notifications`/`data_processing`).
- –ú–æ–¥–µ—Ä–∞—Ü—ñ—è: pre/post-—Ñ—ñ–ª—å—Ç—Ä–∏ (–Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω–∞ –ª–µ–∫—Å–∏–∫–∞, PII), –∞—É–¥–∏—Ç –∑–∞–ø–∏—Ç—ñ–≤/–≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π —É –ë–î.
- –ö–æ–Ω—Ç–µ–∫—Å—Ç: –∫–æ—Ä–æ—Ç–∫–∞ —ñ—Å—Ç–æ—Ä—ñ—è –¥—ñ–∞–ª–æ–≥—ñ–≤ (Redis keyspace per user), —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É, —Å–∏—Å—Ç–µ–º–Ω—ñ –ø—Ä–æ–º–ø—Ç–∏.
- Rate limiting: —Ç—Ä–æ—Ç–ª—ñ–Ω–≥ –Ω–∞ —Ä—ñ–≤–Ω—ñ DRF/Redis (–ø–µ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞/IP), anti‚Äëspam –ø—Ä–∞–≤–∏–ª–∞.
- –ï–Ω–¥–ø–æ—ñ–Ω—Ç–∏ (–ø—Ä–∏–∫–ª–∞–¥–∏):
  - `POST /api/chat/ask` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å (LLM, –∫–æ—Ä–æ—Ç–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ)
  - `POST /api/chat/stream` ‚Äî –ø–æ—Ç–æ–∫–æ–≤–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å (SSE/WebSocket)
  - `GET /api/chat/history` ‚Äî —ñ—Å—Ç–æ—Ä—ñ—è –¥—ñ–∞–ª–æ–≥—É (–æ—Å—Ç–∞–Ω–Ω—ñ–π N –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å)

### Frontend (Next.js 15 + React 19)
- UI: `frontend/src/app/(main)/chat/*` (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ ChatWindow/MessageList/Input).
- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç:
  - REST: –ø—Ä–æ—Å—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è/–≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (–º–∏—Ç—Ç—î–≤—ñ –∑–∞–ø–∏—Ç–∏)
  - SSE/WebSocket: –∂–∏–≤–∏–π —Å—Ç—Ä—ñ–º —Ç–æ–∫–µ–Ω—ñ–≤ (progress typing effect)
- –°—Ç–∞–Ω: React Query –¥–ª—è –∑–∞–ø–∏—Ç—ñ–≤, –ª–æ–∫–∞–ª—å–Ω–∞ —á–µ—Ä–≥–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å, optimistic updates.
- –ú–æ–¥–µ—Ä–∞—Ü—ñ—è –Ω–∞ –∫–ª—ñ—î–Ω—Ç—ñ: –±–∞–∑–æ–≤—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É (–¥–æ–≤–∂–∏–Ω–∞, —Å—Ç–æ–ø‚Äë—Å–ª–æ–≤–∞), graceful errors.
- –§—ñ—á—ñ:
  - –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å–µ—Å—ñ—ó —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó
  - –ü—ñ–¥—Å–≤—ñ—Ç–∫–∞ –∫–æ–¥—É/markdown —Ä–µ–Ω–¥–µ—Ä
  - –ö–Ω–æ–ø–∫–∏ ¬´–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏¬ª, ¬´–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏¬ª, ¬´–ó—É–ø–∏–Ω–∏—Ç–∏¬ª
- –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è (SSE):
```ts
const res = await fetch('/api/chat/stream', { method: 'POST', body: JSON.stringify({ prompt }) });
const reader = res.body!.getReader();
let acc = '';
for (;;) {
  const { done, value } = await reader.read();
  if (done) break;
  acc += new TextDecoder().decode(value);
  setPartial(acc); // –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
}
```

–ë–µ–∑–ø–µ–∫–∞: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ –¥–≤–æ–µ—Ç–∞–ø–Ω—É –º–æ–¥–µ–ª—å (NextAuth ‚Üí Backend JWT), –ª—ñ–º—ñ—Ç–∏ –Ω–∞ —Ä–æ–∑–º—ñ—Ä –ø—Ä–æ–º–ø—Ç—É/–≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è —Ä–æ–ª–µ–π (user/moderator/admin) –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —á–∞—Ç—É.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
FINAL_DRF_NEXT_sept_2024/
‚îú‚îÄ‚îÄ backend/                  # Django Backend (REST API)
‚îÇ   ‚îú‚îÄ‚îÄ apps/                # –î–æ–¥–∞—Ç–∫–∏ Django
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ accounts/        # –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ç–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ads/             # –û–≥–æ–ª–æ—à–µ–Ω–Ω—è –ø—Ä–æ –∞–≤—Ç–æ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analytics/       # –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ç–∞ –∑–≤—ñ—Ç–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat/            # –ß–∞—Ç –º—ñ–∂ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/            # –°–ø—ñ–ª—å–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notifications/   # –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ payments/        # –ü–ª–∞—Ç—ñ–∂–Ω–∞ —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îú‚îÄ‚îÄ config/              # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É
‚îÇ   ‚îú‚îÄ‚îÄ scripts/             # –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ frontend/                # Next.js Frontend
‚îÇ   ‚îú‚îÄ‚îÄ app/                 # App Router
‚îÇ   ‚îú‚îÄ‚îÄ components/          # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ lib/                 # –£—Ç–∏–ª—ñ—Ç–∏ —Ç–∞ —Ö–µ–ª–ø–µ—Ä–∏
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ celery-service/          # Celery Worker –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å
‚îÇ   ‚îú‚îÄ‚îÄ tasks/              # –ó–∞–≤–¥–∞–Ω–Ω—è Celery
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ mailing/                 # –°–µ—Ä–≤—ñ—Å —Ä–æ–∑—Å–∏–ª–∫–∏ email
‚îÇ   ‚îú‚îÄ‚îÄ templates/          # –®–∞–±–ª–æ–Ω–∏ –ª–∏—Å—Ç—ñ–≤
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ nginx/                   # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Nginx
‚îú‚îÄ‚îÄ rabbitmq/                # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è RabbitMQ
‚îú‚îÄ‚îÄ redis/                   # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Redis
‚îú‚îÄ‚îÄ pg/                     # –î–∞–Ω—ñ PostgreSQL
‚îÇ
‚îú‚îÄ‚îÄ scripts/                 # –ö–æ—Ä–∏—Å–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏ –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏
‚îú‚îÄ‚îÄ docs/                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
‚îî‚îÄ‚îÄ docker-compose.yml      # –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≤—Å—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
```

## üéØ –ü—Ä–æ –ø—Ä–æ–µ–∫—Ç

–¶–µ–π –ø—Ä–æ–µ–∫—Ç —è–≤–ª—è—î —Å–æ–±–æ—é –ø–æ–≤–Ω—É —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∂—É –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —Å—É—á–∞—Å–Ω–æ–≥–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–æ–≥–æ —Å—Ç–µ–∫—É. –í–∫–ª—é—á–∞—î –≤ —Å–µ–±–µ –≤—Å—ñ –æ—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó: –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é, —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è–º–∏, –ø–æ—à—É–∫ —Ç–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é, –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É –ø–∞–Ω–µ–ª—å —Ç–∞ –±–∞–≥–∞—Ç–æ —ñ–Ω—à–æ–≥–æ.

### ‚ú® –ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

- üîê **–¢—Ä–∏—Ä—ñ–≤–Ω–µ–≤–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è** (Middleware + HOC + Auto-Refresh) - [–î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è](docs/MULTI_LEVEL_AUTH_ARCHITECTURE.md)
- üöó **–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è–º–∏** –∑ –ø–æ–≤–Ω–∏–º CRUD —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª–æ–º
- üîç **–†–æ–∑—à–∏—Ä–µ–Ω–∏–π –ø–æ—à—É–∫** –∑ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏ —Ç–∞ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è–º
- üìä **–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
- üí¨ **–ß–∞—Ç –º—ñ–∂ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏** —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
- üìß **Email —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è** —á–µ—Ä–µ–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è
- üè¶ **–ü–ª–∞—Ç—ñ–∂–Ω–∞ —Å–∏—Å—Ç–µ–º–∞** –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –ø—ñ–¥–ø–∏—Å–æ–∫
- üì± **–ü–æ–≤–Ω—ñ—Å—Ç—é –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–π** —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- üåç **–Ü–Ω—Ç–µ—Ä–Ω–∞—Ü—ñ–æ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è** (UA/RU/EN)
- üó∫Ô∏è **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Google Maps**
- üìö **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è API** (Swagger/OpenAPI)

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### Backend (Django REST Framework)
- **API**: RESTful API –∑ –∞–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—î—é (Swagger/OpenAPI)
- **–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö**: PostgreSQL –∑ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–º–∏ –∑–∞–ø–∏—Ç–∞–º–∏
- **–ö–µ—à—É–≤–∞–Ω–Ω—è**: Redis –¥–ª—è —Å–µ—Å—ñ–π, –∫–µ—à—É —Ç–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —á–µ—Ä–≥–∞–º–∏
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è**: Celery + RabbitMQ
- **–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è**: JWT —Ç–æ–∫–µ–Ω–∏ + —Å–µ—Å—ñ—ó
- **–ü–æ—à—É–∫**: –ü—Ä–æ—Å—É–Ω—É—Ç–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –ø–æ–≤–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ—à—É–∫—É
- **–§–∞–π–ª–∏**: –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –º–µ–¥—ñ–∞ –≤ S3-—Å—É–º—ñ—Å–Ω–æ–º—É —Å—Ö–æ–≤–∏—â—ñ

#### üîß –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∑–∞–ø–∏—Ç—ñ–≤, –ø–æ–º–∏–ª–∫–∏, –ø–∞–≥—ñ–Ω–∞—Ü—ñ—è, —Ñ—ñ–ª—å—Ç—Ä–∏, —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ç–æ—Ä–∏, DRY

- **–£–Ω–∏–∫–Ω–µ–Ω–Ω—è N+1**: —Å–∏—Å—Ç–µ–º–Ω–æ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ `select_related` –¥–ª—è FK/OneToOne —Ç–∞ `prefetch_related` –¥–ª—è M2M/Reverse FK —É ViewSet/queryset-–º–µ–Ω–µ–¥–∂–µ—Ä–∞—Ö (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è —Ç—è–≥–Ω—É—Ç—å—Å—è —Ä–∞–∑–æ–º –∑ –º–∞—Ä–∫–æ—é, —Ä–µ–≥—ñ–æ–Ω–æ–º, –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º–∏). –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ñ –ø—Ä–µ—Ñ–µ—Ç—á—ñ —á–µ—Ä–µ–∑ `Prefetch(queryset=...)` –¥–ª—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó/—Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –ø–æ–≤‚Äô—è–∑–∞–Ω–∏—Ö –∫–æ–ª–µ–∫—Ü—ñ–π.
- **–¢—é–Ω—ñ–Ω–≥ –∑–∞–ø–∏—Ç—ñ–≤**: –∞–Ω–æ—Ç–∞—Ü—ñ—ó/–∞–≥—Ä–µ–≥–∞—Ü—ñ—ó (`annotate`, `Subquery`, `Exists`) –¥–ª—è –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤ —Ç–∞ —Ñ–ª–∞–≥—ñ–≤, —á–∏—Ç–∞–Ω–Ω—è –ª–∏—à–µ –ø–æ—Ç—Ä—ñ–±–Ω–∏—Ö –ø–æ–ª—ñ–≤ (`only`, `defer`) —É —Å–ø–∏—Å–∫–∞—Ö.
- **–ö–µ—à—É–≤–∞–Ω–Ω—è (Redis)**: low-level cache (Django cache API) –¥–ª—è ¬´–≤–∞–∂–∫–∏—Ö¬ª –µ–Ω–¥–ø–æ—ñ–Ω—Ç—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–æ–≤—ñ–¥–Ω–∏–∫–∏/–∫—É—Ä—Å–∏ –≤–∞–ª—é—Ç/–ø—É–±–ª—ñ—á–Ω—ñ —Å–ø–∏—Å–∫–∏), –ø–µ—Ä-—é–∑–µ—Ä –∫–µ—à –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π, —ñ–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∑–∞ –∫–ª—é—á–∞–º–∏/–Ω–µ–π–º—Å–ø–µ–π—Å–∞–º–∏ –ø—ñ—Å–ª—è –∑–º—ñ–Ω, –∫–æ—Ä–æ—Ç–∫—ñ TTL –¥–ª—è —à–≤–∏–¥–∫–æ-–∑–∞—Å—Ç–∞—Ä—ñ–≤–∞—é—á–∏—Ö –¥–∞–Ω–∏—Ö, `cache_page` –¥–ª—è read-only –º–∞—Ä—à—Ä—É—Ç—ñ–≤, –∫–µ—à –ø—Ä–æ–º—ñ–∂–Ω–∏—Ö –æ–±—á–∏—Å–ª–µ–Ω—å —É —Å–µ—Ä–≤—ñ—Å–∞—Ö.
- **–ö–∞—Å—Ç–æ–º–Ω—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–º–∏–ª–æ–∫**: —î–¥–∏–Ω–∏–π entry-point DRF exception handler (–ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–∏–Ω—è—Ç–∫—ñ–≤ –ë–î/–≤–∞–ª–∏–¥–∞—Ü—ñ—ó/–¥–æ—Å—Ç—É–ø—É —É –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∏–π JSON –∑ –∫–æ–¥–∞–º–∏ –ø–æ–º–∏–ª–æ–∫, correlation-id, –ø–æ–ª–µ–º `details`). –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞/–∑–∞–ø–∏—Ç—É.
- **–ü–∞–≥—ñ–Ω–∞—Ü—ñ—è**: –±–∞–∑–æ–≤–∏–π `LimitOffsetPagination` + ¬´—Ä–æ–∑—É–º–Ω—ñ¬ª –æ–±–º–µ–∂–µ–Ω–Ω—è (max limit), –º–µ—Ç–∞-–ø–æ–ª—è (`count`, `next`, `previous`). –î–ª—è –≤–µ–ª–∏–∫–∏—Ö —Ç–∞–±–ª–∏—Ü—å ‚Äî —Å—Ç–∞–±—ñ–ª—å–Ω–∞ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—è –ø–æ –∫—É—Ä—Å–æ—Ä—ñ (`CursorPagination`) —É –≤–∏–±—ñ—Ä–∫–æ–≤–∏—Ö –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∞—Ö.
- **–§—ñ–ª—å—Ç—Ä–∏/–ø–æ—à—É–∫/—Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è**: `django-filter` –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é –≤—Ö—ñ–¥–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (—Ç–∏–ø–∏, –¥—ñ–∞–ø–∞–∑–æ–Ω–∏, enum‚Äô–∏), —Å–∫–ª–∞–¥–µ–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏ –¥–ª—è –æ–≥–æ–ª–æ—à–µ–Ω—å (–º–æ–¥–µ–ª—å, —Ä—ñ–∫, —Ü—ñ–Ω–∞, —Ä–µ–≥—ñ–æ–Ω, —Å—Ç–∞–Ω, –ø—Ä–æ–¥–∞–≤–µ—Ü—å), –±–µ–∑–ø–µ—á–Ω—ñ –ø–æ–ª—è –¥–ª—è `ordering` —Ç–∞ `search`.
- **–°–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ç–æ—Ä–∏ –∑ LLM-–≤–∞–ª–∏–¥–∞—Ü—ñ—î—é**: –ø—ñ—Å–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ—ó DRF-–≤–∞–ª—ñ–¥–∞—Ü—ñ—ó (—Ç–∏–ø–∏/–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ—Å—Ç—å/–±—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞) –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è LLM-–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç—É (–Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω–∞ –ª–µ–∫—Å–∏–∫–∞, –Ω–µ—Å—É–ø–µ—Ä–µ—á–ª–∏–≤—ñ—Å—Ç—å –ø–æ–ª—ñ–≤, —è–∫—ñ—Å—Ç—å –æ–ø–∏—Å—É). LLM –ø–æ–≤–µ—Ä—Ç–∞—î —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π –≤–µ—Ä–¥–∏–∫—Ç/–ø—ñ–¥–∫–∞–∑–∫–∏; –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ –¥–æ–¥–∞—é—Ç—å—Å—è `non_field_errors` –∞–±–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è (—Ü–µ–Ω–∑—É—Ä–∞).
- **DRY —á–µ—Ä–µ–∑ –Ω–∞—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è**:
  - –ú–æ–¥–µ–ª—ñ: –±–∞–∑–æ–≤—ñ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ñ –∫–ª–∞—Å–∏ (`TimeStampedModel`, –º—ñ–∫—Å–∏–Ω–∏ —Å—Ç–∞—Ç—É—Å—ñ–≤/–≤–ª–∞—Å–Ω–∏–∫–∞/soft-delete).
  - –°–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ç–æ—Ä–∏: `BaseSerializer` –∑ —î–¥–∏–Ω–∏–º –ø—Ä–∞–≤–∏–ª–æ–º —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è/–ø–æ–º–∏–ª–æ–∫, ¬´–ª–µ–≥–∞—Å—ñ¬ª –ø–æ–ª—ñ—Ç–∏–∫–∏ –ø–æ–ª—ñ–≤ —á–µ—Ä–µ–∑ –º—ñ–∫—Å–∏–Ω–∏; –ø–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤–∫–ª–∞–¥–µ–Ω–∏—Ö —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ç–æ—Ä—ñ–≤.
  - ViewSet‚Äô–∏: `BaseViewSet` –∑ —Ç–∏–ø–æ–≤–∏–º –Ω–∞–±–æ—Ä–æ–º –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó, —Ñ—ñ–ª—å—Ç—Ä—ñ–≤, –ø–µ—Ä–º—ñ—à–Ω—ñ–≤, schema/exception-handling; —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞ –¥–æ–¥–∞—î—Ç—å—Å—è –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º–∏ –æ–≤–µ—Ä—Ä–∞–π–¥–∞–º–∏.
  - –°–µ—Ä–≤—ñ—Å–∏/–º–µ–Ω–µ–¥–∂–µ—Ä–∏: –¥–æ–º–µ–Ω–Ω–∞ –ª–æ–≥—ñ–∫–∞ –≤–∏–Ω–µ—Å–µ–Ω–∞ —É —Å–µ—Ä–≤—ñ—Å–∏/–º–µ–Ω–µ–¥–∂–µ—Ä–∏ –º–æ–¥–µ–ª–µ–π –¥–ª—è –ø–µ—Ä–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º—ñ–∂ API/—Ç–∞—Å–∫–∞–º–∏ Celery.
  - –í–∞–ª—ñ–¥–∞—Ü—ñ—è/–ø–µ—Ä–º—ñ—à–Ω–∏: —Å–ø—ñ–ª—å–Ω—ñ –º—ñ–∫—Å–∏–Ω–∏/–∫–ª–∞—Å–∏ –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ –¥–ª—è —î–¥–∏–Ω–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É —É —Ä—ñ–∑–Ω–∏—Ö –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∞—Ö.

–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–æ–¥ —Ç–∞ –ø—Ä–∏–∫–ª–∞–¥–∏: `backend/apps/ads/*` (querysets + –ø—Ä–µ—Ñ–µ—Ç—á—ñ), `backend/core/exceptions.py` (handler), `backend/core/pagination.py`, `backend/core/filters.py`, `backend/apps/*/serializers.py` (LLM hooks), `backend/core/viewsets.py`.

### Frontend (Next.js 15 + React 19)
- **–†–æ—É—Ç–∏–Ω–≥**: App Router –∑ –ª–µ–π–∞—É—Ç–∞–º–∏ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º
- **–ú–æ–≤–∞**: TypeScript –¥–ª—è —Ç–∏–ø–æ–±–µ–∑–ø–µ–∫–∏
- **–°—Ç–∏–ª—ñ**: Tailwind CSS –∑ –∫–∞—Å—Ç–æ–º–Ω–∏–º–∏ —Ç–µ–º–∞–º–∏
- **UI –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞**: shadcn/ui –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
- **–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å—Ç–∞–Ω–æ–º**: React Query + Zustand
- **–§–æ—Ä–º–∏**: React Hook Form –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é Zod
- **–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è**: NextAuth.js –∑ –∫–∞—Å—Ç–æ–º–Ω–∏–º–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
- **–ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞**: Next-Intl
- **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è**: Jest + React Testing Library

#### **–¢—Ä–∏ —Ä—ñ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ Frontend:**

```
Frontend (Next.js 15 + React 19)
‚îÇ
‚îú‚îÄ‚îÄ‚îÄ üéì Dummy Layer (–ù–∞–≤—á–∞–ª—å–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏)
‚îÇ    ‚îú‚îÄ‚îÄ /recipes - CRUD —Ä–µ—Ü–µ–ø—Ç—ñ–≤
‚îÇ    ‚îú‚îÄ‚îÄ /users - –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏
‚îÇ    ‚îú‚îÄ‚îÄ /weather - API —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
‚îÇ    ‚îî‚îÄ‚îÄ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –±–∞–∑–æ–≤–∏—Ö –ø–∞—Ç–µ—Ä–Ω—ñ–≤
‚îÇ
‚îú‚îÄ‚îÄ‚îÄ üñ•Ô∏è Backend Management Layer ‚≠ê
‚îÇ    ‚îú‚îÄ‚îÄ Swagger UI (iframe) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> :8000/api/schema/swagger/
‚îÇ    ‚îú‚îÄ‚îÄ RabbitMQ Management (iframe) ‚îÄ> :15672
‚îÇ    ‚îú‚îÄ‚îÄ Flower Celery Monitor (iframe)> :5555
‚îÇ    ‚îú‚îÄ‚îÄ Redis Insight (iframe) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> :5540
‚îÇ    ‚îî‚îÄ‚îÄ –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è –º—ñ–∂ —Å–µ—Ä–≤—ñ—Å–∞–º–∏
‚îÇ
‚îî‚îÄ‚îÄ‚îÄ üöó AutoRia Layer (–û—Å–Ω–æ–≤–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫)
     ‚îú‚îÄ‚îÄ –û–≥–æ–ª–æ—à–µ–Ω–Ω—è (CRUD + –º–æ–¥–µ—Ä–∞—Ü—ñ—è)
     ‚îú‚îÄ‚îÄ –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è (NextAuth + Django JWT)
     ‚îú‚îÄ‚îÄ AI Features (—á–∞—Ç, –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑–æ–±—Ä–∞–∂–µ–Ω—å)
     ‚îú‚îÄ‚îÄ –ü–æ—à—É–∫ —Ç–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è
     ‚îú‚îÄ‚îÄ –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–¥–ª—è Premium)
     ‚îî‚îÄ‚îÄ –ü–ª–∞—Ç—ñ–∂–Ω–∞ —Å–∏—Å—Ç–µ–º–∞
```

**Backend Management Layer - –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ UI —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏:**
- üéØ **4 —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏** –≤ —î–¥–∏–Ω–æ–º—É —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ
- üîí **Secure iframes** - —ñ–∑–æ–ª—è—Ü—ñ—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
- ‚ö° **Live Status** - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ –∫–æ–∂–Ω–æ–≥–æ —Å–µ—Ä–≤—ñ—Å—É
- üì± **Responsive** - –ø—Ä–∞—Ü—é—î –Ω–∞ –≤—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π Health Check** - –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ

**–î–æ—Å—Ç—É–ø –¥–æ Backend Management:**
- URL: `http://localhost:3000/backend-management`
- –í–∏–º–æ–≥–∏: –ü–æ—Ç—Ä—ñ–±–Ω–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —á–µ—Ä–µ–∑ NextAuth

### –ú—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å–∏

1. **–°–µ—Ä–≤—ñ—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó**
   - –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è/–≤—Ö—ñ–¥ —á–µ—Ä–µ–∑ email/—Å–æ—Ü—ñ–∞–ª—å–Ω—ñ –º–µ—Ä–µ–∂—ñ
   - –î–≤–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è
   - –ö–µ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª–µ–º —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏

2. **–°–µ—Ä–≤—ñ—Å –æ–≥–æ–ª–æ—à–µ–Ω—å**
   - CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è–º–∏
   - –†–æ–∑—à–∏—Ä–µ–Ω–∏–π –ø–æ—à—É–∫ –∑ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏
   - –ó–±–µ—Ä–µ–∂–µ–Ω—ñ –ø–æ—à—É–∫–æ–≤—ñ –∑–∞–ø–∏—Ç–∏
   - –û–±—Ä–æ–±–∫–∞ –∑–æ–±—Ä–∞–∂–µ–Ω—å —Ç–∞ –º–µ–¥—ñ–∞

3. **–ß–∞—Ç-—Å–µ—Ä–≤—ñ—Å**
   - –û–±–º—ñ–Ω –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ (WebSockets)
   - –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –Ω–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
   - –Ü—Å—Ç–æ—Ä—ñ—è –¥—ñ–∞–ª–æ–≥—ñ–≤
   - –í–∫–ª–∞–¥–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤

4. **–°–µ—Ä–≤—ñ—Å —Å–ø–æ–≤—ñ—â–µ–Ω—å**
   - Email-—Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è
   - –í–µ–±-—Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
   - –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω—å
   - –®–∞–±–ª–æ–Ω—ñ–∑–∞—Ü—ñ—è –ª–∏—Å—Ç—ñ–≤

5. **–ü–ª–∞—Ç—ñ–∂–Ω–∏–π —Å–µ—Ä–≤—ñ—Å**
   - –ü—ñ–¥–ø–∏—Å–∫–∏ —Ç–∞ –ø–æ—Å–ª—É–≥–∏
   - –Ü—Å—Ç–æ—Ä—ñ—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
   - –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ –ø–ª–∞—Ç—ñ–∂–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
   - –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—ñ–≤ –ø–ª–∞—Ç–µ–∂—ñ–≤

6. **–ê–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏–π —Å–µ—Ä–≤—ñ—Å**
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–≥–ª—è–¥—ñ–≤ —Ç–∞ –∫–ª—ñ–∫—ñ–≤
   - –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –æ–≥–æ–ª–æ—à–µ–Ω—å
   - –ö–∞—Å—Ç–æ–º–Ω—ñ –∑–≤—ñ—Ç–∏
   - –ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö

### –Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü—ñ—è**: Docker + Docker Compose
- **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü—ñ—è**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ `deploy.py`
- **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥**: Health checks, –º–µ—Ç—Ä–∏–∫–∏ —Ç–∞ –ª–æ–≥–∏
- **CI/CD**: GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- **–ë–µ–∑–ø–µ–∫–∞**: –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π, —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π
- **–ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è**: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—ñ–≤

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

> üìñ **–î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:** [SETUP.md](SETUP.md) - –ø–æ–≤–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

### –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ –≤–∏–º–æ–≥–∏
- Docker —Ç–∞ Docker Compose
- Python 3.11+ (–¥–ª—è —Å–∫—Ä–∏–ø—Ç–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è)
- Node.js 18+ (–¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É)
- 8GB RAM (—Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è 16GB)
- –í—ñ–ª—å–Ω—ñ –ø–æ—Ä—Ç–∏: 3000, 8000, 5432, 6379, 5672, 15672, 5555, 5540

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫

1. **–ö–ª–æ–Ω—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π**:
   ```bash
   git clone https://github.com/VadimPonomarov/FINAL_DRF_NEXT_sept_2024.git
   cd FINAL_DRF_NEXT_sept_2024
   ```

2. **–û–±–µ—Ä—ñ—Ç—å —Å–ø–æ—Å—ñ–± —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è** (–æ–¥–∏–Ω –∑ –¥–≤–æ—Ö):

---

## üöÄ –®–≤–∏–¥–∫–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

```bash
python deploy.py
```

**–©–æ —Ä–æ–±–∏—Ç—å deploy.py:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (Node.js, npm, Docker)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–∂–∏–º (restart/full_rebuild)
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç Backend –≤ Docker
- ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç frontend —Å production build
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç frontend –ª–æ–∫–∞–ª—å–Ω–æ (–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Nginx –∫–∞–∫ reverse proxy

**–†–µ–∂–∏–º—ã –¥–µ–ø–ª–æ—è:**
```bash
# –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (~2 –º–∏–Ω—É—Ç—ã)
python deploy.py --mode restart

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ (~5 –º–∏–Ω—É—Ç)
python deploy.py --mode full_rebuild
```

---

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ **`env-config/`**:

- `env-config/.env.base` - –±–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ø–æ—Ä—Ç—ã, —Ö–æ—Å—Ç—ã)
- `env-config/.env.secrets` - —Å–µ–∫—Ä–µ—Ç—ã (API –∫–ª—é—á–∏, –ø–∞—Ä–æ–ª–∏)
- `env-config/.env.local` - –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- `env-config/.env.docker` - –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è Docker

**Next.js –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç** –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `env-config/` —á–µ—Ä–µ–∑ `next.config.js`.

### –¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (env-config/.env.base):
```env
NEXT_PUBLIC_BACKEND_URL=http://localhost/api  # –ß–µ—Ä–µ–∑ nginx
BACKEND_URL=http://localhost:8000             # –ù–∞–ø—Ä—è–º—É—é –¥–ª—è SSR
REDIS_HOST=localhost
REDIS_URL=redis://localhost:6379/0
```

> **–ù–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å** `frontend/.env.production.local` - Next.js –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑ `env-config/`!

---

## üö¶ –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –¥–æ—Å—Ç—É–ø–Ω—ã:

### Frontend:
- http://localhost (—á–µ—Ä–µ–∑ Nginx)
- http://localhost:3000 (–ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø)

### Backend API:
- http://localhost:8000/api/
- http://localhost/api/ (—á–µ—Ä–µ–∑ Nginx)

### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:
- http://localhost/admin/

### –î—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã:
- http://localhost:5555 - Celery Flower
- http://localhost:15672 - RabbitMQ Management
- http://localhost:5540 - Redis Insight

---

## ‚ùì –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∏ API (404):
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ:
1. Backend –∑–∞–ø—É—â–µ–Ω: `docker-compose ps app`
2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ `env-config/.env.base` (–∏–ª–∏ `.env.docker` –¥–ª—è Docker)
3. Next.js –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ `cd frontend && npm run build`
4. Nginx –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω: `docker-compose restart nginx`

### –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Backend:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs app
docker-compose logs nginx
```

## üéØ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¢–µ—Å—Ç–æ–≤–∏—Ö –û–≥–æ–ª–æ—à–µ–Ω—å
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
## ‚è∞ –ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ (celery-beat)

Celery Beat –∑–∞–ø—É—Å–∫–∞—î –∑–∞–¥–∞—á—ñ –∑–∞ —Ä–æ–∑–∫–ª–∞–¥–æ–º (cron/—ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏) —ñ —Å—Ç–∞–≤–∏—Ç—å —ó—Ö —É —á–µ—Ä–≥—É –¥–ª—è –≤–æ—Ä–∫–µ—Ä—ñ–≤.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ –ø—Ä–æ–µ–∫—Ç—ñ

- –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫: `celery -A config.celery_app beat`
- –í–æ—Ä–∫–µ—Ä(–∏): `celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup`
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥: Flower `http://localhost:5555`

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä–æ–∑–∫–ª–∞–¥—É

```python
# celery-service/config/celery_app.py
from celery.schedules import crontab
from celery import Celery

app = Celery("celery_service")
# ... —ñ–Ω—à–∏–π –∫–æ–Ω—Ñ—ñ–≥ ...

app.conf.beat_schedule = {
    # 1) –©–æ–¥–µ–Ω–Ω–∏–π –±–µ–∫–∞–ø –ë–î –æ 02:00
    "daily-db-backup": {
        "task": "tasks.cleanup_tasks.daily_maintenance_task",
        "schedule": crontab(hour=2, minute=0),
        "options": {"queue": "cleanup"},
    },
    # 2) –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç —â–æ–≥–æ–¥–∏–Ω–∏ (–¥–ª—è AutoRia)
    "update-exchange-rates-hourly": {
        "task": "tasks.data_processing_tasks.update_exchange_rates_task",
        "schedule": crontab(minute=0),
        "options": {"queue": "data_processing"},
    },
    # 3) –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–π–¥–∂–µ—Å—Ç—É email —â–æ–¥–µ–Ω–Ω–æ –æ 08:00
    "send-daily-email-digest": {
        "task": "tasks.email_tasks.send_daily_digest_task",
        "schedule": crontab(hour=8, minute=0),
        "options": {"queue": "email"},
    },
    # 4) Health-check —Å–µ—Ä–≤—ñ—Å—ñ–≤ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    "system-health-check": {
        "task": "tasks.cleanup_tasks.system_health_check_task",
        "schedule": crontab(minute="*/5"),
        "options": {"queue": "cleanup"},
    },
}
```

### –ü—Ä–∏–∫–ª–∞–¥–∏ –∑–∞–¥–∞—á

```python
# celery-service/tasks/email_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.email_tasks.send_daily_digest_task")
def send_daily_digest_task():
    # –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –∑ –±–µ–∫–µ–Ω–¥—É
    http_post("/internal/reports/daily-digest/trigger")
    return "daily digest triggered"
```

```python
# celery-service/tasks/data_processing_tasks.py
from celery import shared_task
from core.http import http_post

@shared_task(name="tasks.data_processing_tasks.update_exchange_rates_task")
def update_exchange_rates_task():
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ –±–µ–∫–µ–Ω–¥ –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤
    http_post("/internal/exchange-rates/update")
    return "exchange rates update scheduled"
```

```python
# celery-service/tasks/cleanup_tasks.py
from celery import shared_task
from core.http import http_get

@shared_task(name="tasks.cleanup_tasks.system_health_check_task")
def system_health_check_task():
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
    services = [
        "/health/redis",
        "/health/rabbitmq",
        "/health/postgres",
        "/health/search-index",
    ]
    results = {path: http_get(path).status_code for path in services}
    return results
```

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏

- Backend (Django API): `http://app:8000`
  - `/internal/reports/daily-digest/trigger` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞–π–¥–∂–µ—Å—Ç—É
  - `/internal/exchange-rates/update` ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç
  - `/health/*` ‚Äî –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ (internal)
- RabbitMQ (–±—Ä–æ–∫–µ—Ä): `amqp://rabbitmq:5672`
- Redis (—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏/–±—Ä–æ–∫–µ—Ä, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ): `redis://redis:6379/0`
- Flower (–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥): `http://flower:5555`

### –ó–∞–ø—É—Å–∫ —É Docker Compose

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  celery-worker:
    build: ./celery-service
    command: celery -A config.celery_app worker -l info -Q email,notifications,data_processing,cleanup
    depends_on: [rabbitmq, redis, app]

  celery-beat:
    build: ./celery-service
    command: celery -A config.celery_app beat -l info
    depends_on: [rabbitmq, redis, app]

  flower:
    image: mher/flower
    command: flower --broker=amqp://guest:guest@rabbitmq:5672//
    ports: ["5555:5555"]
    depends_on: [rabbitmq]
```

### Best Practices

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–∫—Ä–µ–º—ñ —á–µ—Ä–≥–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞–¥–∞—á (`email`, `cleanup`, `data_processing`)
- –°—Ç–∞–≤—Ç–µ —ñ–¥empotent –ª–æ–≥—ñ–∫—É —É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ë–î/ELK –¥–ª—è –∞—É–¥–∏—Ç—É
- –û–±–º–µ–∂—É–π—Ç–µ runtime (soft/hard time limits) –¥–ª—è –≤–∞–∂–∫–∏—Ö –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º

### –ß–µ—Ä–µ–∑ UI (–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

1. **–í—ñ–¥–∫—Ä–∏–π—Ç–µ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É AutoRia**: http://localhost:3000/autoria

2. **–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –î–µ–º–æ-–î–∞–Ω–∏—Ö"** (–∑–µ–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –∑ —ñ–∫–æ–Ω–∫–æ—é –±–∞–∑–∏ –¥–∞–Ω–∏—Ö)
   
   > üì∏ **Screenshot**: `docs/screenshots/test-ads-button.png`

3. **–ù–∞–ª–∞—à—Ç—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó:**
   
   > üì∏ **Screenshot**: `docs/screenshots/test-ads-modal.png`
   
   - **–ö—ñ–ª—å–∫—ñ—Å—Ç—å –æ–≥–æ–ª–æ—à–µ–Ω—å**: 1-50 (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ 10-20)
   - **–¢–∏–ø–∏ –∑–æ–±—Ä–∞–∂–µ–Ω—å**:
     - ‚úÖ **Real Car Images** - —Ä–µ–∞–ª—å–Ω—ñ —Ñ–æ—Ç–æ –∑ Unsplash
     - ‚úÖ **AI Generated** - –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ —à—Ç—É—á–Ω–∏–º —ñ–Ω—Ç–µ–ª–µ–∫—Ç–æ–º
     - ‚úÖ **Placeholder** - —à–≤–∏–¥–∫—ñ –∑–∞–≥–ª—É—à–∫–∏

4. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é** —Ç–∞ –¥–æ—á–µ–∫–∞–π—Ç–µ—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è

   > üì∏ **Screenshot**: `docs/screenshots/test-ads-progress.png`

### –ß–µ—Ä–µ–∑ Backend Management Commands

```bash
# –£ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
docker-compose exec app python manage.py create_mock_system --quick

# –õ–æ–∫–∞–ª—å–Ω–æ (—è–∫—â–æ backend –∑–∞–ø—É—â–µ–Ω–∏–π –ª–æ–∫–∞–ª—å–Ω–æ)
cd backend
python manage.py create_mock_system --quick
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `--quick` - —à–≤–∏–¥–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è (5 –ø—Ä–æ–¥–∞–≤—Ü—ñ–≤, 20 –æ–≥–æ–ª–æ—à–µ–Ω—å)
- –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ - –ø–æ–≤–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ (15 –ø—Ä–æ–¥–∞–≤—Ü—ñ–≤, 50 –æ–≥–æ–ª–æ—à–µ–Ω—å)

### –©–æ –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è?

‚úÖ **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ**:
- –¢–µ—Å—Ç–æ–≤—ñ –ø—Ä–æ–¥–∞–≤—Ü—ñ (seller1@gmail.com, seller2@gmail.com, ...)
- –†—ñ–∑–Ω—ñ —Ç–∏–ø–∏ –∞–∫–∞—É–Ω—Ç—ñ–≤ (Basic, Premium)
- –í—Å—ñ –ø–∞—Ä–æ–ª—ñ: `12345678`

‚úÖ **–û–≥–æ–ª–æ—à–µ–Ω–Ω—è**:
- –†—ñ–∑–Ω—ñ –º–∞—Ä–∫–∏ —Ç–∞ –º–æ–¥–µ–ª—ñ –∞–≤—Ç–æ (BMW, Mercedes, Toyota, ...)
- –†–µ–∞–ª—å–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–ø—Ä–æ–±—ñ–≥, —Ä—ñ–∫ –≤–∏–ø—É—Å–∫—É, —Ü—ñ–Ω–∞)
- –î–æ 5 –∑–æ–±—Ä–∞–∂–µ–Ω—å –Ω–∞ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è
- –í–∏–ø–∞–¥–∫–æ–≤—ñ –ª–æ–∫–∞—Ü—ñ—ó –ø–æ –£–∫—Ä–∞—ó–Ω—ñ

‚úÖ **–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è** (–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –æ–±—Ä–∞–Ω–∏—Ö –æ–ø—Ü—ñ–π):
- **Real** - –∑ unsplash.com (–Ω–∞–π–±—ñ–ª—å—à —Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω—ñ)
- **AI Generated** - —á–µ—Ä–µ–∑ g4f API (—É–Ω—ñ–∫–∞–ª—å–Ω—ñ)
- **Placeholder** - —à–≤–∏–¥–∫—ñ –∑–∞–≥–ª—É—à–∫–∏ (–º–∏—Ç—Ç—î–≤–æ)

### –û—á–∏—â–µ–Ω–Ω—è –¢–µ—Å—Ç–æ–≤–∏—Ö –î–∞–Ω–∏—Ö

**–ß–µ—Ä–µ–∑ UI:**
1. –ù–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ AutoRia –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å —á–µ—Ä–≤–æ–Ω—É –∫–Ω–æ–ø–∫—É "–û—á–∏—Å—Ç–∏—Ç–∏ –í—Å–µ"
2. –ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –¥—ñ—é

**–ß–µ—Ä–µ–∑ Backend:**
```bash
# –í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ –∑ –ë–î
docker-compose exec app python manage.py flush --noinput

# –ó–∞–Ω–æ–≤–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó
docker-compose exec app python manage.py migrate

# –°—Ç–≤–æ—Ä–∏—Ç–∏ –±–∞–∑–æ–≤—ñ –¥–∞–Ω—ñ (–º–∞—Ä–∫–∏, –º–æ–¥–µ–ª—ñ, —Ä–µ–≥—ñ–æ–Ω–∏)
docker-compose exec app python manage.py init_project_data
```

> ‚ö†Ô∏è **–£–≤–∞–≥–∞**: –û—á–∏—â–µ–Ω–Ω—è –≤–∏–¥–∞–ª—è—î –í–°–Ü –¥–∞–Ω—ñ, –≤–∫–ª—é—á–Ω–æ –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è–º–∏!

---

## üîê –ë–ê–ì–ê–¢–û–†–Ü–í–ù–ï–í–ê –ê–í–¢–ï–ù–¢–ò–§–Ü–ö–ê–¶–Ü–Ø

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª—ñ–∑—É—î **—Ç—Ä–∏—Ä—ñ–≤–Ω–µ–≤—É —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó** –∑ –¥–≤–æ–º–∞ —Ä—ñ–∑–Ω–∏–º–∏ –ø—ñ–¥—Ö–æ–¥–∞–º–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å–µ–∫—Ü—ñ–π:

### üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—ñ–¥—Ö–æ–¥—ñ–≤

| –°–µ–∫—Ü—ñ—è | –†—ñ–≤–Ω—ñ–≤ –∑–∞—Ö–∏—Å—Ç—É | NextAuth | Backend —Ç–æ–∫–µ–Ω–∏ | Auto-Refresh | –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å |
|--------|---------------|----------|----------------|--------------|------------|
| **AutoRia** | 3 (Middleware + HOC + fetchWithAuth) | ‚úÖ | ‚úÖ –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ | ‚úÖ –¢–∞–∫ | –í–∏—Å–æ–∫–∞ |
| **Dummy** | 2 (Middleware + Error Handling) | ‚úÖ | ‚ö†Ô∏è –¢—ñ–ª—å–∫–∏ –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö | ‚ùå –ù—ñ | –ù–∏–∑—å–∫–∞ |

---

### üèóÔ∏è –†—ñ–≤–µ–Ω—å 1: Middleware (Next.js) - –ü–µ—Ä—à–∞ –ª—ñ–Ω—ñ—è –∑–∞—Ö–∏—Å—Ç—É

**–§–∞–π–ª:** `frontend/src/middleware.ts`

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ NextAuth —Å–µ—Å—Å—ñ—ó **–î–û** —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏

```typescript
// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–ª—è AutoRia —Å–µ–∫—Ü—ñ—ó
if (AUTORIA_PATHS.some(path => pathname.startsWith(path))) {
  const token = await getToken({ req, secret: process.env.NEXTAUTH_SECRET });
  
  if (!token || !token.email) {
    // ‚ùå –ù–µ–º–∞—î NextAuth —Å–µ—Å—Å—ñ—ó
    return NextResponse.redirect('/api/auth/signin?callbackUrl=...');
  }
  
  // ‚úÖ NextAuth —Å–µ—Å—Å—ñ—è –≤–∞–ª—ñ–¥–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ –¥–∞–ª—ñ
  return NextResponse.next();
}
```

**–î—ñ—ó –ø—Ä–∏ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó:**
- **–†–µ–¥–∏—Ä–µ–∫—Ç**: `/api/auth/signin?callbackUrl=<original_url>`
- **–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –û—Ç—Ä–∏–º–∞—Ç–∏ NextAuth OAuth —Å–µ—Å—Å—ñ—é (Google, Email)

---

### üèóÔ∏è –†—ñ–≤–µ–Ω—å 2: BackendTokenPresenceGate (HOC) - –î—Ä—É–≥–∞ –ª—ñ–Ω—ñ—è –∑–∞—Ö–∏—Å—Ç—É

**–§–∞–π–ª:** `frontend/src/components/AutoRia/Auth/BackendTokenPresenceGate.tsx`

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ **backend —Ç–æ–∫–µ–Ω—ñ–≤** –≤ Redis —á–µ—Ä–µ–∑ API –∑–∞–ø–∏—Ç

‚ö†Ô∏è **–í–ê–ñ–õ–ò–í–û**: 
- Backend —Ç–æ–∫–µ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ **Redis**, –∞ –Ω–µ –≤ localStorage
- Backend —Ç–æ–∫–µ–Ω–∏ –º–æ–∂—É—Ç—å —ñ—Å–Ω—É–≤–∞—Ç–∏ **–¢–Ü–õ–¨–ö–ò** –ø—Ä–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ NextAuth —Å–µ—Å—Å—ñ—ó
- Middleware (–†—ñ–≤–µ–Ω—å 1) –≤–∂–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏–≤ NextAuth —Å–µ—Å—Å—ñ—é

**–õ–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏:**

```typescript
// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ backend —Ç–æ–∫–µ–Ω—ñ–≤ –≤ Redis
const response = await fetch('/api/redis?key=backend_auth', { 
  cache: 'no-store' 
});

if (!response.ok || !data.exists || !data.value) {
  // ‚ùå –ù–µ–º–∞—î backend —Ç–æ–∫–µ–Ω—ñ–≤ –≤ Redis
  router.replace('/login?callbackUrl=...&error=backend_auth_required');
  return;
}

// ‚úÖ Backend —Ç–æ–∫–µ–Ω–∏ –∑–Ω–∞–π–¥–µ–Ω—ñ –≤ Redis
// –î–æ–∑–≤–æ–ª—è—î–º–æ –¥–æ—Å—Ç—É–ø –¥–æ AutoRia —Å–µ–∫—Ü—ñ—ó
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±–≥–æ—Ä—Ç–∞—î –≤—Å—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ AutoRia —á–µ—Ä–µ–∑ Layout
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î —Ç–æ–∫–µ–Ω–∏ **–ø—ñ—Å–ª—è** —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É (client-side)
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `redirectToAuth()` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç—ñ–≤

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** `withAutoRiaAuth()` HOC –¥–ª—è –æ–∫—Ä–µ–º–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î localStorage —è–∫ fallback)

---

### üèóÔ∏è –†—ñ–≤–µ–Ω—å 3: fetchWithAuth / API Routes - –¢—Ä–µ—Ç—è –ª—ñ–Ω—ñ—è –∑–∞—Ö–∏—Å—Ç—É

**–§–∞–π–ª:** `frontend/src/utils/fetchWithAuth.ts` —Ç–∞ API Routes (`frontend/src/app/api/*`)

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ —Ç–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ –ø—ñ–¥ —á–∞—Å API –∑–∞–ø–∏—Ç—ñ–≤

**–§—É–Ω–∫—Ü—ñ—ó:**
1. **Auto Refresh**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è access token –ø—Ä–∏ 401
2. **Retry Logic**: –ü–æ–≤—Ç–æ—Ä–Ω–∏–π –∑–∞–ø–∏—Ç –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞
3. **Token Management**: –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ –∑ Redis —á–µ—Ä–µ–∑ API (`/api/auth/token`)
4. **Error Handling**: –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login –ø—Ä–∏ –Ω–µ–≤–¥–∞—á—ñ

**–ö–ª—é—á–æ–≤–∞ –æ—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å:** –¢–æ–∫–µ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ **Redis**, –∞ –Ω–µ –≤ localStorage!

```typescript
export async function fetchWithAuth(url: string, options?: RequestInit) {
  // 1. –û—Ç—Ä–∏–º—É—î–º–æ —Ç–æ–∫–µ–Ω–∏ –∑ Redis —á–µ—Ä–µ–∑ API
  const tokenResponse = await fetch('/api/auth/token');
  const { access, refresh } = await tokenResponse.json();
  
  // 2. –î–æ–¥–∞—î–º–æ Authorization header
  const response = await fetch(url, {
    ...options,
    headers: {
      ...options?.headers,
      'Authorization': `Bearer ${access}`,
    },
  });
  
  // 3. –Ø–∫—â–æ 401 - —Ç–æ–∫–µ–Ω –∑–∞—Å—Ç–∞—Ä—ñ–≤, —Å–ø—Ä–æ–±–∞ –æ–Ω–æ–≤–∏—Ç–∏ —á–µ—Ä–µ–∑ refresh token
  if (response.status === 401) {
    const refreshResponse = await fetch('/api/auth/refresh', {
      method: 'POST',
    });
    
    if (refreshResponse.ok) {
      // ‚úÖ –¢–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–∏–π –≤ Redis, –ø–æ–≤—Ç–æ—Ä—é—î–º–æ –∑–∞–ø–∏—Ç
      const { access: newAccess } = await refreshResponse.json();
      
      return fetch(url, {
        ...options,
        headers: { ...options?.headers, 'Authorization': `Bearer ${newAccess}` },
      });
    } else {
      // ‚ùå Refresh token —Ç–∞–∫–æ–∂ –∑–∞—Å—Ç–∞—Ä—ñ–≤
      // API route –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å Redis —Ç–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ /login
      throw new Error('Authentication expired');
    }
  }
  
  return response;
}
```

**API Routes –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞–º–∏:**
- `GET /api/auth/token` - –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ –∑ Redis
- `POST /api/auth/token` - –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ –≤ Redis
- `POST /api/auth/refresh` - –û–Ω–æ–≤–ª–µ–Ω–Ω—è access token —á–µ—Ä–µ–∑ refresh token

---

### üîÑ –ü—Ä–æ—Ü–µ—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó: SIGNIN ‚Üí SIGNOUT

–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–ª—ñ–∑—É—î –¥–≤–æ–µ—Ç–∞–ø–Ω—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è–º UI –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏ (–±–µ–π–¥–∂–∞–º–∏) –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—á–∏–º–∏ —Å—Ç–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó.

---

#### üîê SIGNIN - –ü—Ä–æ—Ü–µ—Å –≤—Ö–æ–¥—É –≤ —Å–∏—Å—Ç–µ–º—É

–ü—Ä–æ—Ü–µ—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –¥–≤–æ—Ö –µ—Ç–∞–ø—ñ–≤:

##### –ï—Ç–∞–ø 1: NextAuth OAuth (–û–±–æ–≤'—è–∑–∫–æ–≤–∏–π)

**–ö–æ–ª–∏:** –ü—Ä–∏ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ NextAuth —Å–µ—Å—Å—ñ—ó (–ø–µ—Ä—à–∏–π –≤—ñ–∑–∏—Ç –∞–±–æ –ø—ñ—Å–ª—è –ø–æ–≤–Ω–æ–≥–æ –≤–∏—Ö–æ–¥—É)

**–®–ª—è—Ö:** 
```
Middleware –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ ‚Üí –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /api/auth/signin ‚Üí OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä (Google/Email)
```

**–ü—Ä–æ—Ü–µ—Å:**
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∑–∞—Ö–∏—â–µ–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (`/autoria/*`)
2. Middleware –ø–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å NextAuth —Å–µ—Å—Å—ñ—ó
3. –Ø–∫—â–æ —Å–µ—Å—Å—ñ—ó –Ω–µ–º–∞—î ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/api/auth/signin?callbackUrl=<original_url>`
4. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä (Google OAuth –∞–±–æ Email Magic Link)
5. –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó NextAuth —Å—Ç–≤–æ—Ä—é—î —Å–µ—Å—Å—ñ—é (HTTP-only cookie)
6. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login` –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è backend —Ç–æ–∫–µ–Ω—ñ–≤

**UI –∑–º—ñ–Ω–∏:**
- **–î–æ signin:** –û–±–∏–¥–≤–∞ –±–µ–π–¥–∂–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ (AuthBadge —Ç–∞ AutoRiaUserBadge –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è)
- **–ü—ñ—Å–ª—è signin (–µ—Ç–∞–ø 1):** –ó'—è–≤–ª—è—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ **AuthBadge** –∑ email –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

##### –ï—Ç–∞–ø 2: Backend JWT Tokens (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π)

**–ö–æ–ª–∏:** –ü—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è NextAuth —Å–µ—Å—Å—ñ—ó (–ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ AutoRia API)

**–®–ª—è—Ö:**
```
/login ‚Üí –í–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑—ñ —Å–ø–∏—Å–∫—É ‚Üí POST /api/auth/login ‚Üí –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ –≤ Redis
```

**–ü—Ä–æ—Ü–µ—Å:**
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ—Ç—Ä–∞–ø–ª—è—î –Ω–∞ `/login` (—á–µ—Ä–µ–∑ HOC –∞–±–æ –ø—Ä—è–º–µ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—è)
2. –í—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è —Ñ–æ—Ä–º–∞ –∑—ñ —Å–ø–∏—Å–∫–æ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (—è–∫—â–æ —î NextAuth —Å–µ—Å—Å—ñ—è)
3. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–∏—Ä–∞—î –∞–∫–∞—É–Ω—Ç —Ç–∞ –≤–≤–æ–¥–∏—Ç—å credentials
4. Frontend –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î POST –∑–∞–ø–∏—Ç –Ω–∞ `/api/auth/login` –∑ credentials
5. Backend –≤–∞–ª—ñ–¥—É—î credentials —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î JWT —Ç–æ–∫–µ–Ω–∏ (access + refresh)
6. –¢–æ–∫–µ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è:
   - **Redis** (–æ—Å–Ω–æ–≤–Ω–µ —Å—Ö–æ–≤–∏—â–µ): `backend_auth` –∫–ª—é—á
   - **localStorage** (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ): –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É (–º–æ–∂–µ –±—É—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–æ –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É)
7. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/autoria` –∞–±–æ `callbackUrl`

**UI –∑–º—ñ–Ω–∏:**
- **–ü—ñ—Å–ª—è signin (–µ—Ç–∞–ø 2):** –ó'—è–≤–ª—è—î—Ç—å—Å—è –¥—Ä—É–≥–∏–π –±–µ–π–¥–∂ **AutoRiaUserBadge** –∑ —ñ–º'—è–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- **–°—Ç–∞–Ω–∏ –±–µ–π–¥–∂—ñ–≤:**
  - ‚úÖ **AuthBadge** - –∑–∞–≤–∂–¥–∏ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è NextAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó (email –∑ —Å–µ—Å—Å—ñ—ó)
  - ‚úÖ **AutoRiaUserBadge** - –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ —î backend —Ç–æ–∫–µ–Ω–∏ –≤ Redis

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ UI:**
- `AuthBadge` (`frontend/src/components/All/AuthBadge/AuthBadge.tsx`)
  - –ü–æ–∫–∞–∑—É—î email –∑ NextAuth —Å–µ—Å—Å—ñ—ó
  - –°—Ö–æ–≤–∞–Ω–∏–π –ø—Ä–∏ `status === 'unauthenticated' || !session`
  - –í—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –≤ –ø—Ä–∞–≤–æ–º—É –≤–µ—Ä—Ö–Ω—å–æ–º—É –∫—É—Ç—ñ (top: 60px, right: 50px)
  
- `AutoRiaUserBadge` (`frontend/src/components/AutoRia/Layout/AutoRiaUserBadge.tsx`)
  - –ü–æ–∫–∞–∑—É—î —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ backend –ø—Ä–æ—Ñ—ñ–ª—é
  - –°—Ö–æ–≤–∞–Ω–∏–π —è–∫—â–æ `!session || hasBackendTokens !== true`
  - –í—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –ø—ñ–¥ AuthBadge –∑ –≤—ñ–¥—Å—Ç—É–ø–æ–º
  - –í–∫–ª—é—á–∞—î tooltip –∑ –¥–µ—Ç–∞–ª—å–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ —Ä–æ–ª—ñ

---

#### üö™ SIGNOUT - –ü–æ–≤–Ω–∏–π –≤–∏—Ö—ñ–¥ –∑ —Å–∏—Å—Ç–µ–º–∏

**–§—É–Ω–∫—Ü—ñ—è:** `cleanupAuth(redirectUrl?: string)`  
**–§–∞–π–ª:** `frontend/src/lib/auth/cleanupAuth.ts`  
**–í–∏–∫–ª–∏–∫:** –ö–Ω–æ–ø–∫–∞ "Sign Out" (—Å—Ç—Ä—ñ–ª–∫–∞) –≤ –≥–æ–ª–æ–≤–Ω–æ–º—É –º–µ–Ω—é

**–ü–æ–≤–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –æ—á–∏—Å—Ç–∫–∏:**

```typescript
export async function cleanupAuth(redirectUrl?: string) {
  // 1. –ë—ç–∫–µ–Ω–¥-–æ—á–∏—Å—Ç–∫–∞: Redis —Ç–æ–∫–µ–Ω—ã + —Å–µ—Å—Å–∏–æ–Ω–Ω—ã–µ cookies
  await fetch('/api/auth/logout', {
    method: 'POST',
    credentials: 'include',
    cache: 'no-store',
  });
  
  // 2. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è NextAuth —Å–µ—Å—Å–∏–∏ (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Å—Ç–æ—Ä–æ–Ω–∞)
  await signOut({ redirect: false });
  
  // 3. –û—á–∏—Å—Ç–∫–∞ localStorage (—Å–æ—Ö—Ä–∞–Ω—è—è theme/language)
  const theme = localStorage.getItem('theme');
  const language = localStorage.getItem('language');
  localStorage.clear();
  if (theme) localStorage.setItem('theme', theme);
  if (language) localStorage.setItem('language', language);
  
  // 4. –û—á–∏—Å—Ç–∫–∞ sessionStorage
  sessionStorage.clear();
  
  // 5. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è auth:signout –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ React Query –∫–µ—à–∞
  setTimeout(() => {
    window.dispatchEvent(new CustomEvent('auth:signout', { 
      detail: { clearCache: true } 
    }));
  }, 50);
  
  // 6. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
  setTimeout(() => {
    window.location.href = redirectUrl || '/api/auth/signin';
  }, 200); // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
}
```

**–©–æ –æ—á–∏—â—É—î—Ç—å—Å—è:**

1. **Redis (—Å–µ—Ä–≤–µ—Ä–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–∞):**
   - `backend_auth` - JWT —Ç–æ–∫–µ–Ω–∏
   - `dummy_auth` - —Ç–µ—Å—Ç–æ–≤—ñ —Ç–æ–∫–µ–Ω–∏ (—è–∫—â–æ —î)
   - `auth_provider` - —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
   - Cookies —Å–µ—Å—Å—ñ—ó NextAuth

2. **NextAuth (–∫–ª—ñ—î–Ω—Ç—Å—å–∫–∞ —Å—Ç–æ—Ä–æ–Ω–∞):**
   - HTTP-only cookie –∑ —Å–µ—Å—Å—ñ—î—é
   - –ö–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π —Å—Ç–∞–Ω NextAuth

3. **localStorage:**
   - –í—Å—ñ –¥–∞–Ω—ñ –æ—á–∏—â–∞—é—Ç—å—Å—è, **–∫—Ä—ñ–º:**
     - `theme` (—Ç–µ–º–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É)
     - `language` (–æ–±—Ä–∞–Ω–∞ –º–æ–≤–∞)

4. **sessionStorage:**
   - –ü–æ–≤–Ω–∞ –æ—á–∏—Å—Ç–∫–∞

5. **React Query –∫–µ—à:**
   - –û—á–∏—â—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ —Å–ª—É—Ö–∞—á–∞ –ø–æ–¥—ñ—ó `auth:signout` –≤ `RootProvider`
   - –í—Å—ñ –∑–∞–ø–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —ñ–Ω–≤–∞–ª—ñ–¥—É—é—Ç—å—Å—è

6. **React State:**
   - `useUserProfileData` - –æ—á–∏—â—É—î —Å—Ç–∞–Ω —á–µ—Ä–µ–∑ —Å–ª—É—Ö–∞—á–∞ `auth:signout`
   - `useAutoRiaAuth` - –æ—á–∏—â—É—î —Å—Ç–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
   - `AuthProvider` - –æ—á–∏—â—É—î `user` —Ç–∞ `isAuthenticated`

**UI –∑–º—ñ–Ω–∏ –ø—ñ–¥ —á–∞—Å signout:**

1. **–ú–∏—Ç—Ç—î–≤—ñ –∑–º—ñ–Ω–∏ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ):**
   - React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –æ—Ç—Ä–∏–º—É—é—Ç—å –æ–Ω–æ–≤–ª–µ–Ω–∏–π —Å—Ç–∞–Ω —Å–µ—Å—Å—ñ—ó —á–µ—Ä–µ–∑ `useSession()`
   - `status` –∑–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ `'unauthenticated'`
   - `session` —Å—Ç–∞—î `null`

2. **–û—á–∏—Å—Ç–∫–∞ –±–µ–π–¥–∂—ñ–≤ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ —á–µ—Ä–µ–∑ –ø–æ–¥—ñ—ó):**
   - **AuthBadge** - –∑–Ω–∏–∫–∞—î –æ–¥—Ä–∞–∑—É (–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ `status === 'unauthenticated'`)
   - **AutoRiaUserBadge** - –∑–Ω–∏–∫–∞—î –ø—ñ—Å–ª—è –æ—á–∏—Å—Ç–∫–∏ `hasBackendTokens` –≤ `useAutoRiaAuth`

3. **–ü—ñ—Å–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç—É:**
   - –ü–æ–≤–Ω–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –Ω–∞ `/api/auth/signin`
   - –í—Å—ñ –±–µ–π–¥–∂–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ
   - –ü–æ–∫–∞–∑—É—î—Ç—å—Å—è —Ñ–æ—Ä–º–∞ OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

**–ü–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –ø–æ–¥—ñ–π:**

```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î "Sign Out"
    ‚Üì
cleanupAuth() –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
    ‚Üì
1. POST /api/auth/logout (–æ—á–∏—Å—Ç–∫–∞ Redis + cookies)
    ‚Üì
2. signOut({ redirect: false }) (–æ—á–∏—Å—Ç–∫–∞ NextAuth)
    ‚Üì
3. localStorage.clear() (–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è theme/language)
    ‚Üì
4. sessionStorage.clear()
    ‚Üì
5. dispatchEvent('auth:signout') (—á–µ—Ä–µ–∑ 50ms)
    ‚Üì
   ‚îú‚Üí CacheCleanupHandler –æ—á–∏—â–∞—î React Query
    ‚îú‚Üí useUserProfileData –æ—á–∏—â–∞—î –ø—Ä–æ—Ñ—ñ–ª—å
    ‚îî‚Üí useAutoRiaAuth –æ—á–∏—â–∞—î —Å—Ç–∞–Ω
    ‚Üì
6. window.location.href = '/api/auth/signin' (—á–µ—Ä–µ–∑ 200ms)
    ‚Üì
–ü–æ–≤–Ω–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∏, –≤—Å—ñ –±–µ–π–¥–∂–∏ –∑–Ω–∏–∫–ª–∏
```

**–†–µ–¥–∏—Ä–µ–∫—Ç:** `/api/auth/signin` (–ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–æ–≤—É –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è —á–µ—Ä–µ–∑ OAuth)

---

#### üîÑ LOGOUT - –ß–∞—Å—Ç–∫–æ–≤–µ –æ—á–∏—â–µ–Ω–Ω—è (—Ç—ñ–ª—å–∫–∏ backend —Ç–æ–∫–µ–Ω–∏)

**–§—É–Ω–∫—Ü—ñ—è:** `cleanupBackendTokens()`  
**–§–∞–π–ª:** `frontend/src/lib/auth/cleanupAuth.ts`  
**–í–∏–∫–ª–∏–∫:** –ö–Ω–æ–ø–∫–∞ "Logout (Redis)" –≤ tooltip AutoRiaUserBadge

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

```typescript
export async function cleanupBackendTokens() {
  // 1. –û—á–∏—Å—Ç–∫–∞ Redis (backend —Ç–æ–∫–µ–Ω–∏)
  await fetch('/api/auth/cleanup', { method: 'POST' });
  
  // 2. –û—á–∏—Å—Ç–∫–∞ localStorage backend —Ç–æ–∫–µ–Ω—ñ–≤
  localStorage.removeItem('backend_auth');
  localStorage.removeItem('accessToken');
  localStorage.removeItem('refreshToken');
  sessionStorage.removeItem('backend_auth');
  
  // ‚ö†Ô∏è NextAuth —Å–µ—Å—Å—ñ—è –ó–ê–õ–ò–®–ê–Ñ–¢–¨–°–Ø –∞–∫—Ç–∏–≤–Ω–æ—é!
}
```

**–©–æ –æ—á–∏—â—É—î—Ç—å—Å—è:**
- ‚úÖ Redis: `backend_auth`, `auth_provider`
- ‚úÖ localStorage: backend —Ç–æ–∫–µ–Ω–∏
- ‚úÖ sessionStorage: backend —Ç–æ–∫–µ–Ω–∏
- ‚ùå **NextAuth —Å–µ—Å—Å—ñ—è –ù–ï –æ—á–∏—â–∞—î—Ç—å—Å—è**

**UI –∑–º—ñ–Ω–∏:**
- **AuthBadge** - **–∑–∞–ª–∏—à–∞—î—Ç—å—Å—è** –≤–∏–¥–∏–º–∏–º (NextAuth —Å–µ—Å—Å—ñ—è –∞–∫—Ç–∏–≤–Ω–∞)
- **AutoRiaUserBadge** - **–∑–Ω–∏–∫–∞—î** (–Ω–µ–º–∞—î backend —Ç–æ–∫–µ–Ω—ñ–≤)
- –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login` –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–±–æ—Ä—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è:**
- –ö–Ω–æ–ø–∫–∞ "Logout (Redis)" –≤ tooltip AutoRiaUserBadge
- –û—á–∏—Å—Ç–∫–∞ backend —Ç–æ–∫–µ–Ω—ñ–≤ –±–µ–∑ –≤–∏—Ö–æ–¥—É –∑ NextAuth
- **–†–µ–¥–∏—Ä–µ–∫—Ç:** `/login` (NextAuth —Å–µ—Å—Å—ñ—è —â–µ –∞–∫—Ç–∏–≤–Ω–∞, –ø—Ä–æ—Å—Ç–æ –≤–∏–±—Ä–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑—ñ —Å–ø–∏—Å–∫—É)

---

### üîë –¢–∏–ø–∏ —Ç–æ–∫–µ–Ω—ñ–≤

#### ‚ö†Ô∏è –ü—Ä–∞–≤–∏–ª–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Ç–æ–∫–µ–Ω—ñ–≤

**–ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–õ–ò–í–û**: Backend —Ç–æ–∫–µ–Ω–∏ –Ω–µ –º–æ–∂—É—Ç—å —ñ—Å–Ω—É–≤–∞—Ç–∏ –±–µ–∑ NextAuth —Å–µ—Å—Å—ñ—ó!

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  NextAuth Session (–û–±–æ–≤'—è–∑–∫–æ–≤–æ)                 ‚îÇ
‚îÇ  ‚Üì                                               ‚îÇ
‚îÇ  ‚îî‚Üí Backend Tokens (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, –∞–ª–µ –∑–∞–ª–µ–∂–∞—Ç—å)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ú–æ–∂–ª–∏–≤—ñ —Å—Ç–∞–Ω–∏:**
- ‚úÖ NextAuth —Å–µ—Å—Å—ñ—è: –Ñ ‚Üí Backend —Ç–æ–∫–µ–Ω–∏: –ù–µ–º–∞—î (–ø–æ–∫–∞–∑–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ email badge)
- ‚úÖ NextAuth —Å–µ—Å—Å—ñ—è: –Ñ ‚Üí Backend —Ç–æ–∫–µ–Ω–∏: –Ñ (–ø–æ–∫–∞–∑–∞—Ç–∏ –æ–±–∏–¥–≤–∞ badges)
- ‚ùå NextAuth —Å–µ—Å—Å—ñ—è: –ù–µ–º–∞—î ‚Üí Backend —Ç–æ–∫–µ–Ω–∏: –Ñ (**–ù–ï–ú–û–ñ–õ–ò–í–û!**)

#### NextAuth Session (OAuth)

**–ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è:** HTTP-only cookie (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ NextAuth)  
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ Next.js  
**–û—Ç—Ä–∏–º–∞–Ω–Ω—è:** `/api/auth/signin` (Google OAuth, Email Magic Link)  
**Lifetime:** 30 –¥–Ω—ñ–≤

#### Backend Tokens (Django JWT)

**–ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è:** **Redis** (–æ—Å–Ω–æ–≤–Ω–µ —Å—Ö–æ–≤–∏—â–µ, –∫–ª—é—á `backend_auth`)  
**‚ö†Ô∏è –í–ê–ñ–õ–ò–í–û:** –¢–æ–∫–µ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –≤ Redis, –ù–ï –≤ localStorage!

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ Redis:**
```json
{
  "access": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "refresh": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "refreshAttempts": 0
}
```

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ Django API  
**–û—Ç—Ä–∏–º–∞–Ω–Ω—è:** `/login` (–≤–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑—ñ —Å–ø–∏—Å–∫—É) ‚Üí –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ `/api/auth/token`  
**Lifetime:**
- Access token: 15 —Ö–≤–∏–ª–∏–Ω
- Refresh token: 7 –¥–Ω—ñ–≤

**–î–æ—Å—Ç—É–ø –¥–æ —Ç–æ–∫–µ–Ω—ñ–≤:**
- **Server-side:** –ü—Ä—è–º–∏–π –¥–æ—Å—Ç—É–ø –¥–æ Redis —á–µ—Ä–µ–∑ API routes (`/api/auth/token`)
- **Client-side:** –û—Ç—Ä–∏–º–∞–Ω–Ω—è —á–µ—Ä–µ–∑ `GET /api/auth/token` –ø–µ—Ä–µ–¥ –∫–æ–∂–Ω–∏–º –∑–∞–ø–∏—Ç–æ–º
- **Auto-refresh:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ `POST /api/auth/refresh` –ø—Ä–∏ 401 –ø–æ–º–∏–ª—Ü—ñ

**‚ö†Ô∏è –ó–∞–ª–µ–∂–Ω—ñ—Å—Ç—å:** –ü–æ—Ç—Ä–µ–±—É—î –∞–∫—Ç–∏–≤–Ω—É NextAuth —Å–µ—Å—Å—ñ—é (–Ω–µ–º–æ–∂–ª–∏–≤–æ –º–∞—Ç–∏ backend —Ç–æ–∫–µ–Ω–∏ –±–µ–∑ NextAuth)

---

### üìç –†–µ–¥–∏—Ä–µ–∫—Ç–∏ —Ç–∞ —ó—Ö –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è

| –†–µ–¥–∏—Ä–µ–∫—Ç | –ö–æ–ª–∏ | –ü—Ä–∏—á–∏–Ω–∞ | –ù–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫ |
|----------|------|---------|----------------|
| `/api/auth/signin` | Middleware | –ù–µ–º–∞—î NextAuth —Å–µ—Å—Å—ñ—ó | OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è |
| `/login` | HOC –∞–±–æ fetchWithAuth | –ù–µ–º–∞—î backend —Ç–æ–∫–µ–Ω—ñ–≤ | –í–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ |
| `/autoria` | –ü—ñ—Å–ª—è login | Backend —Ç–æ–∫–µ–Ω–∏ –æ—Ç—Ä–∏–º–∞–Ω—ñ | –î–æ—Å—Ç—É–ø –¥–æ AutoRia |

---

### üÜö –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —è–∫–∏–π –ø—ñ–¥—Ö—ñ–¥?

**–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ AutoRia (–¢—Ä–∏—Ä—ñ–≤–Ω–µ–≤–∏–π):**
- ‚úÖ –ö—Ä–∏—Ç–∏—á–Ω–∞ —Å–µ–∫—Ü—ñ—è –∑ —á—É—Ç–ª–∏–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏
- ‚úÖ –°–∫–ª–∞–¥–Ω–∞ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ –∑ –±–∞–≥–∞—Ç—å–º–∞ API –∑–∞–ø–∏—Ç–∞–º–∏
- ‚úÖ –ü–æ—Ç—Ä—ñ–±–µ–Ω auto-refresh —Ç–æ–∫–µ–Ω—ñ–≤
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –±–µ–∑–ø–µ–∫–∞ –≤–∞–∂–ª–∏–≤—ñ—à–∞ –∑–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É

**–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Dummy (–î–≤–æ—Ä—ñ–≤–Ω–µ–≤–∏–π):**
- ‚úÖ –ü—Ä–æ—Ç–æ—Ç–∏–ø—É–≤–∞–Ω–Ω—è —Ç–∞ —à–≤–∏–¥–∫–∞ —Ä–æ–∑—Ä–æ–±–∫–∞
- ‚úÖ –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ñ –¥–∞–Ω—ñ (–¥–µ–º–æ, —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ)
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –≤–∞–∂–ª–∏–≤—ñ—à–∞ –∑–∞ –±–µ–∑–ø–µ–∫—É
- ‚úÖ –ú–µ–Ω—à–µ –∫–æ–¥—É –¥–ª—è –ø—Ä–æ—Å—Ç–∏—Ö –∑–∞–¥–∞—á

> üìñ **–î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:** [docs/MULTI_LEVEL_AUTH_ARCHITECTURE.md](docs/MULTI_LEVEL_AUTH_ARCHITECTURE.md)

---

## ‚öôÔ∏è –ó–ú–Ü–ù–ù–Ü –û–¢–û–ß–ï–ù–ù–Ø –¢–ê –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø

### üìã –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

–ü—Ä–æ–µ–∫—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω—É —Å–∏—Å—Ç–µ–º—É** —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏–º–∏ –æ—Ç–æ—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –ø–∞–ø–∫—É `env-config/`.

> **üéì –í–ê–ñ–õ–ò–í–û**: –¶–µ –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –ø—Ä–æ–µ–∫—Ç! –£—Å—ñ .env —Ñ–∞–π–ª–∏ –≤–∫–ª—é—á–µ–Ω—ñ –≤ Git –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è.  
> **–£ production –ù–Ü–ö–û–õ–ò –Ω–µ –∑–±–µ—Ä—ñ–≥–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç–∏ –≤ Git!**

---

### üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ env-config/

```
env-config/
‚îú‚îÄ‚îÄ .env.base       # –ë–∞–∑–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (–ø–æ—Ä—Ç–∏, —Ö–æ—Å—Ç–∏, —ñ–º–µ–Ω–∞ –ë–î)
‚îú‚îÄ‚îÄ .env.secrets    # API –∫–ª—é—á—ñ, –ø–∞—Ä–æ–ª—ñ (–Ω–∞–≤—á–∞–ª—å–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è)
‚îú‚îÄ‚îÄ .env.docker     # Docker-specific –ø–µ—Ä–µ–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è (—Ö–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤)
‚îú‚îÄ‚îÄ .env.local      # –õ–æ–∫–∞–ª—å–Ω—ñ –ø–µ—Ä–µ–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
‚îî‚îÄ‚îÄ load-env.py     # –£—Ç–∏–ª—ñ—Ç–∞ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö
```

**‚ö†Ô∏è –í–ê–ñ–õ–ò–í–û**: –§–∞–π–ª–∏ `.env.*` –≤ `env-config/` –ù–ï –≤–∫–ª—é—á–µ–Ω—ñ –≤ Git (–∫—Ä—ñ–º `.env.example` —è–∫—â–æ —î). –°—Ç–≤–æ—Ä—ñ—Ç—å —ó—Ö –Ω–∞ –æ—Å–Ω–æ–≤—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó.

**–ü–æ—Ä—è–¥–æ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è** –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:

**Docker:**
```
.env.base ‚Üí .env.secrets ‚Üí .env.docker
```

**–õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞ (Backend):**
```
.env.base ‚Üí .env.secrets ‚Üí .env.local ‚Üí backend/.env
```

**–õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞ (Frontend):**
```
.env.base ‚Üí .env.secrets ‚Üí .env.local ‚Üí .env.development
```

---

### üì¶ –©–æ –º—ñ—Å—Ç–∏—Ç—å –∫–æ–∂–µ–Ω —Ñ–∞–π–ª

#### `.env.base` - –ë–∞–∑–æ–≤–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

```bash
# –û—Å–Ω–æ–≤–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
DEBUG=True
SECRET_KEY=django-insecure-development-key

# –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö
POSTGRES_DB=autoria_db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_HOST=localhost  # –õ–æ–∫–∞–ª—å–Ω–æ
POSTGRES_PORT=5432

# Redis
REDIS_HOST=localhost     # –õ–æ–∫–∞–ª—å–Ω–æ
REDIS_PORT=6379

# RabbitMQ
RABBITMQ_HOST=localhost  # –õ–æ–∫–∞–ª—å–Ω–æ
RABBITMQ_PORT=5672
RABBITMQ_USER=guest
RABBITMQ_PASSWORD=guest

# –ü–æ—Ä—Ç–∏ —Å–µ—Ä–≤—ñ—Å—ñ–≤
BACKEND_PORT=8000
FRONTEND_PORT=3000
FLOWER_PORT=5555
REDIS_INSIGHT_PORT=5540

# –°–∏–¥—ñ–Ω–≥
RUN_SEEDS=true
FORCE_RESEED=false
GENERATE_TEST_ADS_WITH_IMAGES=true
```

#### `.env.secrets` - API –∫–ª—é—á—ñ —Ç–∞ –ø–∞—Ä–æ–ª—ñ

```bash
# Google OAuth (NextAuth)
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# NextAuth
NEXTAUTH_SECRET=your-nextauth-secret-key

# Google Maps API
GOOGLE_MAPS_API_KEY=your-google-maps-key

# Email (SMTP)
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password

# AI Services (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
OPENAI_API_KEY=your-openai-key
ANTHROPIC_API_KEY=your-anthropic-key
```

#### `.env.docker` - Docker –ø–µ—Ä–µ–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è

```bash
# Docker-specific —Ö–æ—Å—Ç–∏ (—ñ–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ –∑–∞–º—ñ—Å—Ç—å localhost)
POSTGRES_HOST=pg          # –Ü–º'—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ PostgreSQL
REDIS_HOST=redis          # –Ü–º'—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Redis
RABBITMQ_HOST=rabbitmq    # –Ü–º'—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ RabbitMQ

# Backend URL –¥–ª—è Docker –º–µ—Ä–µ–∂—ñ
BACKEND_URL=http://app:8000
FRONTEND_URL=http://frontend:3000

# CORS –¥–ª—è Docker
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://frontend:3000
CSRF_TRUSTED_ORIGINS=http://localhost:3000,http://frontend:3000

# Docker environment flag
IS_DOCKER=true
```

---

### üîÑ –Ø–∫ –ø—Ä–∞—Ü—é—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

#### Docker —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

```yaml
# docker-compose.yml
services:
  app:
    env_file:
      - ./env-config/.env.base       # 1Ô∏è‚É£ –ë–∞–∑–∞
      - ./env-config/.env.secrets    # 2Ô∏è‚É£ –°–µ–∫—Ä–µ—Ç–∏
      - ./env-config/.env.docker     # 3Ô∏è‚É£ Docker overrides
```

**–ü—Ä–∏–∫–ª–∞–¥ –ø–µ—Ä–µ–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è:**
```
.env.base:    POSTGRES_HOST=localhost     # –õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞
.env.docker:  POSTGRES_HOST=pg           # Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                                          ‚Üì
–†–µ–∑—É–ª—å—Ç–∞—Ç:    POSTGRES_HOST=pg           # Docker –º–∞—î –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
```

#### –õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞ (–±–µ–∑ Docker)

**Backend (Django):**
Backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –∑–º—ñ–Ω–Ω—ñ –≤ `backend/config/settings.py`:

```python
# –í–∏–∑–Ω–∞—á–∞—î–º–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
is_docker = os.environ.get("IS_DOCKER", "false").lower() == "true"

# –ü–æ—Ä—è–¥–æ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:
env_files = [
    root_dir / "env-config" / ".env.base",      # 1. –ë–∞–∑–æ–≤—ñ –∑–º—ñ–Ω–Ω—ñ
    root_dir / "env-config" / ".env.secrets",   # 2. –°–µ–∫—Ä–µ—Ç–∏
]

# –î–æ–¥–∞—î–º–æ —Ñ–∞–π–ª –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
if is_docker:
    env_files.append(root_dir / "env-config" / ".env.docker")  # 3. Docker
else:
    env_files.append(root_dir / "env-config" / ".env.local")  # 3. –õ–æ–∫–∞–ª—å–Ω–∏–π

env_files.append(base_dir / ".env")  # 4. Backend-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ

# –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –≤—Å—ñ —Ñ–∞–π–ª–∏
for env_file in env_files:
    if env_file.exists():
        load_dotenv(env_file, override=True)
```

**Frontend (Next.js):**
Frontend –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –∑–º—ñ–Ω–Ω—ñ —á–µ—Ä–µ–∑ `frontend/next.config.js`:

```javascript
// –ü–æ—Ä—è–¥–æ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:
const baseEnv = loadEnvFile(path.join(envConfigDir, '.env.base'));
const secretsEnv = loadEnvFile(path.join(envConfigDir, '.env.secrets'));
const localEnv = loadEnvFile(path.join(envConfigDir, '.env.local'));
const developmentEnv = loadEnvFile(path.join(envConfigDir, '.env.development'));

// –û–±'—î–¥–Ω—É—î–º–æ (–ø—ñ–∑–Ω—ñ—à—ñ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—é—Ç—å —Ä–∞–Ω–Ω—ñ)
const allEnv = { ...baseEnv, ...secretsEnv, ...localEnv, ...developmentEnv };
```

**‚ö†Ô∏è –£–í–ê–ì–ê**: Next.js —Ç–∞–∫–æ–∂ —à—É–∫–∞—î `.env.local` –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó `frontend/`, –∞–ª–µ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤—Å—ñ –∑–º—ñ–Ω–Ω—ñ –∫—Ä–∞—â–µ —Ç—Ä–∏–º–∞—Ç–∏ –≤ `env-config/`.

---

### üèóÔ∏è Service-specific –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

#### 1. Backend (Django/DRF)

**Docker:**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `env-config/` —á–µ—Ä–µ–∑ `docker-compose.yml`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –≤—Å—ñ —Ç—Ä–∏ —Ñ–∞–π–ª–∏

**–õ–æ–∫–∞–ª—å–Ω–æ:**
- –ú–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `.env` —É –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É
- –ê–±–æ –ø—Ä—è–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –∑ `env-config/` —á–µ—Ä–µ–∑ `load-env.py`

```python
# backend/config/settings.py
from pathlib import Path
import os

# Django –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î .env –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ python-decouple –∞–±–æ django-environ
BASE_DIR = Path(__file__).resolve().parent.parent
```

---

#### 2. Frontend (Next.js)

**–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:**
- ‚úÖ –í—Å—ñ –∑–º—ñ–Ω–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `env-config/` (—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–æ)
- ‚úÖ Next.js –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î —á–µ—Ä–µ–∑ `next.config.js` –Ω–∞ –µ—Ç–∞–ø—ñ –∑–±—ñ—Ä–∫–∏
- ‚úÖ –ü–æ—Ä—è–¥–æ–∫: `.env.base` ‚Üí `.env.secrets` ‚Üí `.env.local` ‚Üí `.env.development`
- ‚úÖ –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó —Ä–æ–∑—Ä–æ–±–∫–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–æ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `frontend/.env.local` (–±—É–¥–µ –º–∞—Ç–∏ –≤–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç)

**–ö–ª—é—á–æ–≤—ñ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è Frontend:**
```bash
# env-config/.env.local (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó —Ä–æ–∑—Ä–æ–±–∫–∏)
NEXT_PUBLIC_BACKEND_URL=http://localhost:8000  # –î–ª—è –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤
BACKEND_URL=http://localhost:8000               # –î–ª—è SSR —Ç–∞ API routes
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-secret                     # –ó .env.secrets
GOOGLE_CLIENT_ID=your-id                        # –ó .env.secrets
GOOGLE_CLIENT_SECRET=your-secret                # –ó .env.secrets
REDIS_URL=redis://localhost:6379/0
IS_DOCKER=false
NEXT_PUBLIC_IS_DOCKER=false
```

**Docker (–∑–∞–∫–æ–º–µ–Ω—Ç–æ–≤–∞–Ω–æ –≤ docker-compose.yml):**
- Frontend —Å–µ—Ä–≤—ñ—Å –∑–∞–∫–æ–º–µ–Ω—Ç–æ–≤–∞–Ω–∏–π –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
- –î–ª—è –ø–æ–≤–Ω–æ–≥–æ Docker —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —Ä–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ —Å–µ–∫—Ü—ñ—é `frontend:` –≤ `docker-compose.yml`
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ç—ñ –∂ —Ñ–∞–π–ª–∏ –∑ `env-config/`, –∞–ª–µ –∑ `IS_DOCKER=true`

---

#### 3. Redis

**Docker + —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è:**
```bash
# redis/.env - Redis-specific –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
REDIS_MAXMEMORY=256mb
REDIS_MAXMEMORY_POLICY=allkeys-lru
```

**–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª:**
```bash
# redis/redis.conf
maxmemory 256mb
maxmemory-policy allkeys-lru
requirepass your-redis-password  # –ó .env.secrets
```

---

#### 4. PostgreSQL, Celery, RabbitMQ, Nginx

**–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Ç—ñ–ª—å–∫–∏ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π `env-config/`:**
- –ë–µ–∑ –≤–ª–∞—Å–Ω–∏—Ö `.env` —Ñ–∞–π–ª—ñ–≤
- –í—Å—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑ `docker-compose.yml` ‚Üí `env-config/`

---

### üîÄ –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∏ —Ç–∞ –ø–µ—Ä–µ–∑–∞–ø–∏—Å

**–Ü—î—Ä–∞—Ä—Ö—ñ—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É –∑–º—ñ–Ω–Ω–∏—Ö (–≤—ñ–¥ –Ω–∞–π–Ω–∏–∂—á–æ–≥–æ –¥–æ –Ω–∞–π–≤–∏—â–æ–≥–æ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É):**

```
1. .env.base              # –ë–∞–∑–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è
   ‚Üì
2. .env.secrets           # –î–æ–¥–∞—î —Å–µ–∫—Ä–µ—Ç–∏, –ø–µ—Ä–µ–≤–∏–∑–Ω–∞—á–∞—î —è–∫—â–æ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç
   ‚Üì
3. .env.docker            # Docker overrides (–Ω–∞–π–≤–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –≤ Docker)
   ‚Üì
4. docker-compose.yml     # –ú–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤–∏–∑–Ω–∞—á–∏—Ç–∏ —á–µ—Ä–µ–∑ environment:
   ‚Üì
5. –°–∏—Å—Ç–µ–º–Ω—ñ –∑–º—ñ–Ω–Ω—ñ        # export VAR=value (–Ω–∞–π–≤–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç)
```

**–ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É:**

```bash
# .env.base
DEBUG=True
POSTGRES_HOST=localhost

# .env.docker
POSTGRES_HOST=pg

# docker-compose.yml
environment:
  - DEBUG=False

# –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ:
DEBUG=False           # –ó docker-compose.yml
POSTGRES_HOST=pg      # –ó .env.docker
```

---

### üöÄ –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

#### –õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞ Backend + Dockerized services

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏
docker-compose up -d pg redis rabbitmq

# 2. Backend –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ localhost –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
cd backend
python manage.py runserver

# 3. Frontend –ª–æ–∫–∞–ª—å–Ω–æ
cd frontend
npm run dev
```

**–ó–º—ñ–Ω–Ω—ñ –¥–ª—è —Ü—å–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä—ñ—é:**
```bash
# .env (–≤ –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É –¥–ª—è Django)
POSTGRES_HOST=localhost   # –ù–µ pg!
REDIS_HOST=localhost      # –ù–µ redis!
RABBITMQ_HOST=localhost   # –ù–µ rabbitmq!
```

---

#### –ü–æ–≤–Ω–∏–π Docker —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

```bash
# –í—Å–µ –≤ Docker
docker-compose up -d
```

**–ó–º—ñ–Ω–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑ `.env.docker`:**
```bash
POSTGRES_HOST=pg
REDIS_HOST=redis
RABBITMQ_HOST=rabbitmq
```

---

### üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â

#### Development (–ª–æ–∫–∞–ª—å–Ω–æ)

```bash
# .env
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1
CORS_ALLOWED_ORIGINS=http://localhost:3000
```

#### Testing

```bash
# .env.testing
DEBUG=True
POSTGRES_DB=autoria_test_db
RUN_SEEDS=false
```

#### Production

```bash
# .env.production
DEBUG=False
SECRET_KEY=<secure-random-key>
ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com
POSTGRES_PASSWORD=<strong-password>
REDIS_PASSWORD=<strong-password>
```

---

### üõ†Ô∏è –ö–æ–º–∞–Ω–¥–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—î—é

#### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–º—ñ–Ω–Ω–∏—Ö

```bash
# Backend - –ø–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ –∑–º—ñ–Ω–Ω—ñ Django
docker-compose exec app python manage.py diffsettings

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –∑–º—ñ–Ω–Ω—É
docker-compose exec app python -c "import os; print(os.getenv('POSTGRES_HOST'))"

# Frontend - –ø–æ–∫–∞–∑–∞—Ç–∏ NEXT_PUBLIC_ –∑–º—ñ–Ω–Ω—ñ
cd frontend
npm run env
```

#### –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏

```bash
# Docker - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å
docker-compose restart app

# –ê–±–æ –ø–æ–≤–Ω–∞ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —è–∫—â–æ –∑–º—ñ–Ω–∏–ª–∏ Dockerfile
docker-compose up -d --build app

# –õ–æ–∫–∞–ª—å–Ω–æ - –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å
# Ctrl+C —Ç–∞ –∑–Ω–æ–≤—É python manage.py runserver
```

---

### ‚ö†Ô∏è –í–∞–∂–ª–∏–≤—ñ –ø—Ä–∏–º—ñ—Ç–∫–∏

1. **–ù—ñ–∫–æ–ª–∏ –Ω–µ –∫–æ–º—ñ—Ç—å—Ç–µ —Å–µ–∫—Ä–µ—Ç–∏ –≤ production:**
   ```bash
   # .gitignore
   .env.secrets
   .env.local
   .env.production
   ```

2. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∏ —Å–µ–∫—Ä–µ—Ç—ñ–≤ –¥–ª—è production:**
   - AWS Secrets Manager
   - HashiCorp Vault
   - Kubernetes Secrets
   - GitHub Secrets (–¥–ª—è CI/CD)

3. **–ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –æ–±–æ–≤'—è–∑–∫–æ–≤–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö:**
   ```python
   # backend/config/settings.py
   from django.core.exceptions import ImproperlyConfigured
   
   def get_env_variable(var_name):
       try:
           return os.environ[var_name]
       except KeyError:
           raise ImproperlyConfigured(f'Set the {var_name} environment variable')
   ```

4. **–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó —Ä–æ–∑—Ä–æ–±–∫–∏ –∑–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `.env.local`:**
   - –ù–µ –∫–æ–º—ñ—Ç—å—Ç–µ –π–æ–≥–æ –≤ Git
   - –ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ –ø—Ä–∏–∫–ª–∞–¥ —è–∫ `.env.local.example`

5. **üîê –ö—Ä–∏–ø—Ç–æ–∑–∞—Ö–∏—Å—Ç OAuth –∫–ª—é—á—ñ–≤ (—É–Ω—ñ–∫–∞–ª—å–Ω–∞ —Ñ—ñ—á–∞ –ø—Ä–æ–µ–∫—Ç—É):**
   
   –ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞—î –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ä—ñ–≤–µ–Ω—å –±–µ–∑–ø–µ–∫–∏ - **—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è NextAuth OAuth –∫–ª—é—á—ñ–≤** —á–µ—Ä–µ–∑ Fernet (—Å–∏–º–µ—Ç—Ä–∏—á–Ω–µ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è):
   
   ```bash
   # –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∫–ª—é—á—ñ–≤ –ø–µ—Ä–µ–¥ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º
   node frontend/scripts/encrypt_nextjs_oauth_keys.cjs
   ```
   
   **–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**
   ```javascript
   // 1. –ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è Fernet –∫–ª—é—á (–æ–¥–∏–Ω —Ä–∞–∑)
   const key = generateKey();  // 32-byte –∫–ª—é—á
   
   // 2. –®–∏—Ñ—Ä—É—é—Ç—å—Å—è —á—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ
   const encryptedClientId = encrypt(GOOGLE_CLIENT_ID, key);
   const encryptedClientSecret = encrypt(GOOGLE_CLIENT_SECRET, key);
   
   // 3. –ó–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ .env.local
   GOOGLE_CLIENT_ID=gAAAAABh...  // –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ
   GOOGLE_CLIENT_SECRET=gAAAAABh...  // –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ
   FERNET_KEY=base64_encoded_key  // –ö–ª—é—á —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è
   
   // 4. –†–æ–∑—à–∏—Ñ—Ä–æ–≤—É—é—Ç—å—Å—è –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ (runtime)
   const clientId = decrypt(process.env.GOOGLE_CLIENT_ID, process.env.FERNET_KEY);
   ```
   
   **–ü–µ—Ä–µ–≤–∞–≥–∏:**
   - ‚úÖ –î–æ–¥–∞—Ç–∫–æ–≤–∏–π –∑–∞—Ö–∏—Å—Ç –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ .env.local –ø–æ—Ç—Ä–∞–ø–∏—Ç—å —É –Ω–µ–¥–±–∞–ª—ñ —Ä—É–∫–∏
   - ‚úÖ –ö–ª—é—á—ñ –Ω–µ —á–∏—Ç–∞–±–µ–ª—å–Ω—ñ –≤ plain text
   - ‚úÖ Fernet –∑–∞–±–µ–∑–ø–µ—á—É—î –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é —Ç–∞ —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö
   - ‚úÖ –õ–µ–≥–∫–æ —Ä–æ—Ç—É–≤–∞—Ç–∏ –∫–ª—é—á—ñ –±–µ–∑ –∑–º—ñ–Ω–∏ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏
   
   **–í–∞–∂–ª–∏–≤–æ:**
   - –ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ `FERNET_KEY` –æ–∫—Ä–µ–º–æ –≤—ñ–¥ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö
   - –î–ª—è production –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Hardware Security Modules (HSM)
   - –†–æ—Ç—É–π—Ç–µ –∫–ª—é—á—ñ —Ä–µ–≥—É–ª—è—Ä–Ω–æ (–∫–æ–∂–Ω—ñ 90 –¥–Ω—ñ–≤)

---

### üéØ –ü–†–ê–ö–¢–ò–ß–ù–Ü –°–¶–ï–ù–ê–†–Ü–á –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–á

#### üè† –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –ü–æ–≤–Ω—ñ—Å—Ç—é –ª–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞ (–±–µ–∑ Docker)

**–ú–µ—Ç–∞:** –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –≤–∞—à—ñ–π –º–∞—à–∏–Ω—ñ.

**–ö—Ä–æ–∫ 1: –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å —Å–µ—Ä–≤—ñ—Å–∏ –ª–æ–∫–∞–ª—å–Ω–æ**
```bash
# PostgreSQL (–ø—Ä–∏–∫–ª–∞–¥ –¥–ª—è macOS)
brew install postgresql@15
brew services start postgresql@15

# Redis
brew install redis
brew services start redis

# RabbitMQ
brew install rabbitmq
brew services start rabbitmq
```

**–ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä—ñ—Ç—å `.env` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó —Ä–æ–∑—Ä–æ–±–∫–∏**
```bash
# .env (–≤ –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É)
DEBUG=True
SECRET_KEY=local-development-secret-key

# –õ–æ–∫–∞–ª—å–Ω—ñ —Ö–æ—Å—Ç–∏ (–ù–ï Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏!)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=autoria_local_dev
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres

REDIS_HOST=localhost
REDIS_PORT=6379

RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_USER=guest
RABBITMQ_PASSWORD=guest

# URLs
BACKEND_URL=http://localhost:8000
FRONTEND_URL=http://localhost:3000
NEXTAUTH_URL=http://localhost:3000

# CORS - –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ñ –∑–∞–ø–∏—Ç–∏
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
CSRF_TRUSTED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# –ü—Ä–∞–ø–æ—Ä–µ—Ü—å —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
IS_DOCKER=false
```

**–ö—Ä–æ–∫ 3: –ù–∞–ª–∞—à—Ç—É–π—Ç–µ Frontend**
```bash
# frontend/.env.local
NEXT_PUBLIC_BACKEND_URL=http://localhost:8000
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-local-dev-secret

GOOGLE_CLIENT_ID=your-google-id
GOOGLE_CLIENT_SECRET=your-google-secret
```

**–ö—Ä–æ–∫ 4: –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤—ñ—Å–∏**
```bash
# Backend
cd backend
python manage.py runserver

# Frontend (–≤ —ñ–Ω—à–æ–º—É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ)
cd frontend
npm run dev

# Celery Worker (–≤ —ñ–Ω—à–æ–º—É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ)
cd backend
celery -A config worker -l info

# Celery Beat (–≤ —ñ–Ω—à–æ–º—É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ)
cd backend
celery -A config beat -l info
```

---

#### üê≥ –°—Ü–µ–Ω–∞—Ä—ñ–π 2: Hybrid - Backend –ª–æ–∫–∞–ª—å–Ω–æ + Infrastructure –≤ Docker

**–ú–µ—Ç–∞:** –†–æ–∑—Ä–æ–±–ª—è—Ç–∏ backend –∫–æ–¥ –ª–æ–∫–∞–ª—å–Ω–æ, –∞–ª–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Dockerized –ë–î —Ç–∞ —á–µ—Ä–≥–∏.

**–ö—Ä–æ–∫ 1: –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Ç—ñ–ª—å–∫–∏ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ Docker**
```bash
# docker-compose.override.yml (—Å—Ç–≤–æ—Ä—ñ—Ç—å —Ü–µ–π —Ñ–∞–π–ª)
version: '3.8'

services:
  # –í–∏–º–∫–Ω—É—Ç–∏ backend —Ç–∞ frontend
  app:
    profiles: ['disabled']
  
  frontend:
    profiles: ['disabled']
  
  celery-worker:
    profiles: ['disabled']
  
  celery-beat:
    profiles: ['disabled']
  
  flower:
    profiles: ['disabled']
  
  mailing:
    profiles: ['disabled']
  
  nginx:
    profiles: ['disabled']
```

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
docker-compose up -d pg redis redis-insight rabbitmq
```

**–ö—Ä–æ–∫ 2: –ù–∞–ª–∞—à—Ç—É–π—Ç–µ `.env` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ backend**
```bash
# .env (–≤ –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É)
DEBUG=True

# Docker —Å–µ—Ä–≤—ñ—Å–∏ –Ω–∞ localhost –ø–æ—Ä—Ç–∞—Ö
POSTGRES_HOST=localhost    # Docker –ø—Ä–æ–∫–∏–¥–∞—î –ø–æ—Ä—Ç 5432
POSTGRES_PORT=5432
POSTGRES_DB=autoria_db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres

REDIS_HOST=localhost       # Docker –ø—Ä–æ–∫–∏–¥–∞—î –ø–æ—Ä—Ç 6379
REDIS_PORT=6379

RABBITMQ_HOST=localhost    # Docker –ø—Ä–æ–∫–∏–¥—É—î –ø–æ—Ä—Ç 5672
RABBITMQ_PORT=5672
RABBITMQ_USER=guest
RABBITMQ_PASSWORD=guest

# Backend –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
BACKEND_URL=http://localhost:8000
IS_DOCKER=false
```

**–ö—Ä–æ–∫ 3: –ó–∞–ø—É—Å—Ç—ñ—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ backend —Ç–∞ frontend**
```bash
# Backend –ª–æ–∫–∞–ª—å–Ω–æ
cd backend
python manage.py runserver

# Frontend –ª–æ–∫–∞–ª—å–Ω–æ
cd frontend
npm run dev
```

**–ü–µ—Ä–µ–≤–∞–≥–∏ —Ü—å–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É:**
- ‚úÖ –®–≤–∏–¥–∫–∞ —Ä–æ–∑—Ä–æ–±–∫–∞ backend (–±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ Docker)
- ‚úÖ –õ–µ–≥–∫–µ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è (breakpoints –ø—Ä–∞—Ü—é—é—Ç—å)
- ‚úÖ –Ü–∑–æ–ª—å–æ–≤–∞–Ω–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ë–î, Redis –≤ Docker)
- ‚úÖ –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ PostgreSQL/Redis –ª–æ–∫–∞–ª—å–Ω–æ

---

#### üè¢ –°—Ü–µ–Ω–∞—Ä—ñ–π 3: Staging —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ (–ø–æ–¥—ñ–±–Ω–µ –¥–æ production)

**–ú–µ—Ç–∞:** –¢–µ—Å—Ç—É–≤–∞—Ç–∏ –ø–µ—Ä–µ–¥ production –≤ —É–º–æ–≤–∞—Ö, –±–ª–∏–∑—å–∫–∏—Ö –¥–æ —Ä–µ–∞–ª—å–Ω–∏—Ö.

**–ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä—ñ—Ç—å `.env.staging`**
```bash
# env-config/.env.staging
DEBUG=False
SECRET_KEY=<strong-staging-secret>

# Staging domain
ALLOWED_HOSTS=staging.autoria.com,*.autoria.com
CORS_ALLOWED_ORIGINS=https://staging.autoria.com
CSRF_TRUSTED_ORIGINS=https://staging.autoria.com

# Staging database
POSTGRES_HOST=staging-db.example.com
POSTGRES_PORT=5432
POSTGRES_DB=autoria_staging
POSTGRES_USER=autoria_staging_user
POSTGRES_PASSWORD=<strong-staging-password>

# Redis cluster
REDIS_HOST=staging-redis.example.com
REDIS_PORT=6379
REDIS_PASSWORD=<strong-redis-password>

# RabbitMQ cluster
RABBITMQ_HOST=staging-rabbitmq.example.com
RABBITMQ_PORT=5672
RABBITMQ_USER=staging_user
RABBITMQ_PASSWORD=<strong-rabbitmq-password>

# URLs
BACKEND_URL=https://api-staging.autoria.com
FRONTEND_URL=https://staging.autoria.com
NEXTAUTH_URL=https://staging.autoria.com

# Logging
LOG_LEVEL=INFO
SENTRY_DSN=https://your-sentry-dsn

# Performance
CELERY_TASK_ALWAYS_EAGER=False
CELERY_WORKER_CONCURRENCY=4

# –°–∏–¥—ñ–Ω–≥ (–≤–∏–º–∫–Ω—É—Ç–∏ –¥–ª—è staging)
RUN_SEEDS=false
FORCE_RESEED=false
```

**–ö—Ä–æ–∫ 2: –ú–æ–¥–∏—Ñ—ñ–∫—É–π—Ç–µ `docker-compose.yml` –¥–ª—è staging**
```yaml
# docker-compose.staging.yml
services:
  app:
    env_file:
      - ./env-config/.env.base
      - ./env-config/.env.staging    # –ó–∞–º—ñ—Å—Ç—å .env.docker
    environment:
      - IS_DOCKER=true
    deploy:
      replicas: 2
      resources:
        limits:
          cpus: '1'
          memory: 2G
```

**–ö—Ä–æ–∫ 3: –ó–∞–ø—É—Å—Ç—ñ—Ç—å staging**
```bash
# –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ staging –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
docker-compose -f docker-compose.yml -f docker-compose.staging.yml up -d
```

---

#### üöÄ –°—Ü–µ–Ω–∞—Ä—ñ–π 4: Production –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

**–ú–µ—Ç–∞:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –±–µ–∑–ø–µ–∫–∞ —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å.

**–ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä—ñ—Ç—å `.env.production` (–ù–Ü–ö–û–õ–ò –ù–ï –ö–û–ú–Ü–¢–¨–¢–ï –í GIT!)**
```bash
# env-config/.env.production
DEBUG=False
SECRET_KEY=<ultra-strong-production-secret-64-chars>

# Production domains
ALLOWED_HOSTS=autoria.com,www.autoria.com,api.autoria.com
CORS_ALLOWED_ORIGINS=https://autoria.com,https://www.autoria.com
CSRF_TRUSTED_ORIGINS=https://autoria.com,https://www.autoria.com

# Production database (managed service)
POSTGRES_HOST=prod-db-master.region.rds.amazonaws.com
POSTGRES_PORT=5432
POSTGRES_DB=autoria_production
POSTGRES_USER=autoria_prod_user
POSTGRES_PASSWORD=<aws-secrets-manager-reference>

# Redis cluster (managed service)
REDIS_HOST=prod-redis.region.cache.amazonaws.com
REDIS_PORT=6379
REDIS_PASSWORD=<aws-secrets-manager-reference>
REDIS_SSL=True

# RabbitMQ cluster
RABBITMQ_HOST=prod-rabbitmq.region.mq.amazonaws.com
RABBITMQ_PORT=5671
RABBITMQ_SSL=True
RABBITMQ_USER=prod_user
RABBITMQ_PASSWORD=<aws-secrets-manager-reference>

# CDN URLs
STATIC_URL=https://cdn.autoria.com/static/
MEDIA_URL=https://cdn.autoria.com/media/

# External services
BACKEND_URL=https://api.autoria.com
FRONTEND_URL=https://autoria.com
NEXTAUTH_URL=https://autoria.com

# Security
SECURE_SSL_REDIRECT=True
SESSION_COOKIE_SECURE=True
CSRF_COOKIE_SECURE=True
SECURE_HSTS_SECONDS=31536000

# Monitoring
SENTRY_DSN=<production-sentry-dsn>
SENTRY_ENVIRONMENT=production
LOG_LEVEL=WARNING

# Performance
CELERY_TASK_ALWAYS_EAGER=False
CELERY_WORKER_CONCURRENCY=8
CELERY_WORKER_PREFETCH_MULTIPLIER=4

# Disable seeding
RUN_SEEDS=false
FORCE_RESEED=false
GENERATE_TEST_ADS_WITH_IMAGES=false

# Email (production SMTP)
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.sendgrid.net
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=apikey
EMAIL_HOST_PASSWORD=<sendgrid-api-key>
```

**–ö—Ä–æ–∫ 2: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ Secrets Manager**
```python
# backend/config/settings_prod.py
import boto3
import json

def get_secret(secret_name):
    """–û—Ç—Ä–∏–º–∞—Ç–∏ —Å–µ–∫—Ä–µ—Ç –∑ AWS Secrets Manager"""
    client = boto3.client('secretsmanager', region_name='us-east-1')
    response = client.get_secret_value(SecretId=secret_name)
    return json.loads(response['SecretString'])

# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–µ–∫—Ä–µ—Ç–∏
secrets = get_secret('prod/autoria/database')
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': secrets['dbname'],
        'USER': secrets['username'],
        'PASSWORD': secrets['password'],
        'HOST': secrets['host'],
        'PORT': secrets['port'],
    }
}
```

---

#### üß™ –°—Ü–µ–Ω–∞—Ä—ñ–π 5: Testing/CI —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ

**–ú–µ—Ç–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤ CI/CD pipeline.

**–ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä—ñ—Ç—å `.env.testing`**
```bash
# env-config/.env.testing
DEBUG=True
SECRET_KEY=test-secret-key-not-for-production

# Test database (in-memory –∞–±–æ –æ–∫—Ä–µ–º–∞ —Ç–µ—Å—Ç–æ–≤–∞ –ë–î)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=autoria_test_db
POSTGRES_USER=test_user
POSTGRES_PASSWORD=test_password

# Test Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# –®–≤–∏–¥–∫–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –±–µ–∑ —Ä–µ–∞–ª—å–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
CELERY_TASK_ALWAYS_EAGER=True  # –í–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend

# –í–∏–º–∫–Ω—É—Ç–∏ —Å–∏–¥—ñ–Ω–≥
RUN_SEEDS=false

# –¢–µ—Å—Ç–æ–≤—ñ API –∫–ª—é—á—ñ
GOOGLE_CLIENT_ID=test-client-id
GOOGLE_CLIENT_SECRET=test-client-secret
OPENAI_API_KEY=test-openai-key

# Logging –¥–ª—è —Ç–µ—Å—Ç—ñ–≤
LOG_LEVEL=ERROR
```

**–ö—Ä–æ–∫ 2: GitHub Actions CI/CD**
```yaml
# .github/workflows/test.yml
name: Run Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_DB: autoria_test_db
          POSTGRES_USER: test_user
          POSTGRES_PASSWORD: test_password
        ports:
          - 5432:5432
      
      redis:
        image: redis:7
        ports:
          - 6379:6379
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          cd backend
          pip install -e ".[test]"
      
      - name: Run tests
        env:
          # –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ .env.testing
          ENV_FILE: .env.testing
        run: |
          cd backend
          pytest --cov
```

---

#### üîÑ –°—Ü–µ–Ω–∞—Ä—ñ–π 6: –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º—ñ–∂ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞–º–∏

**–ú–µ—Ç–∞:** –®–≤–∏–¥–∫–æ –ø–µ—Ä–µ–º–∏–∫–∞—Ç–∏—Å—è –º—ñ–∂ dev/staging/prod.

**–°–ø–æ—Å—ñ–± 1: Symlinks (Linux/Mac)**
```bash
#!/bin/bash
# scripts/switch-env.sh

ENV=$1

if [ -z "$ENV" ]; then
    echo "Usage: ./switch-env.sh [dev|staging|prod]"
    exit 1
fi

# –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è backend env
ln -sf env-config/.env.$ENV .env
echo "‚úÖ Switched to $ENV environment"

# –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è frontend env
ln -sf .env.$ENV.local frontend/.env.local
echo "‚úÖ Frontend switched to $ENV"

# –ü–æ–∫–∞–∑–∞—Ç–∏ –∞–∫—Ç–∏–≤–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ
echo "üìã Current configuration:"
grep "^POSTGRES_HOST" .env
grep "^DEBUG" .env
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```bash
./scripts/switch-env.sh dev      # –õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞
./scripts/switch-env.sh staging  # Staging —Ç–µ—Å—Ç–∏
./scripts/switch-env.sh prod     # Production (–æ–±–µ—Ä–µ–∂–Ω–æ!)
```

**–°–ø–æ—Å—ñ–± 2: Docker Compose Profiles**
```yaml
# docker-compose.yml
services:
  app:
    env_file:
      - ./env-config/.env.base
      - ./env-config/.env.${ENV:-dev}  # –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ ENV –∑–º—ñ–Ω–Ω—É
```

```bash
# –ó–∞–ø—É—Å–∫ –∑ —Ä—ñ–∑–Ω–∏–º–∏ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞–º–∏
ENV=dev docker-compose up -d       # Development
ENV=staging docker-compose up -d    # Staging
ENV=prod docker-compose up -d      # Production
```

**–°–ø–æ—Å—ñ–± 3: –ó–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏**
```bash
# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ
export APP_ENV=staging

# docker-compose.yml —á–∏—Ç–∞—î APP_ENV
services:
  app:
    env_file:
      - ./env-config/.env.base
      - ./env-config/.env.${APP_ENV:-dev}
```

---

### üìä –ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∞ —Ç–∞–±–ª–∏—Ü—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Development | Staging | Production |
|----------|------------|---------|------------|
| **DEBUG** | `True` | `False` | `False` |
| **ALLOWED_HOSTS** | `*` –∞–±–æ `localhost` | Staging domain | Production domains |
| **POSTGRES_HOST** | `localhost` –∞–±–æ `pg` | Managed DB host | Managed DB host |
| **SECRET_KEY** | –ü—Ä–æ—Å—Ç–∏–π | –°–∫–ª–∞–¥–Ω–∏–π | –£–ª—å—Ç—Ä–∞-—Å–∫–ª–∞–¥–Ω–∏–π |
| **CORS_ORIGINS** | `localhost:3000` | Staging URL | Production URLs |
| **SSL/TLS** | ‚ùå –í–∏–º–∫–Ω–µ–Ω–æ | ‚úÖ –£–≤—ñ–º–∫–Ω–µ–Ω–æ | ‚úÖ –û–±–æ–≤'—è–∑–∫–æ–≤–æ |
| **SENTRY** | ‚ùå –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ | ‚úÖ –£–≤—ñ–º–∫–Ω–µ–Ω–æ | ‚úÖ –û–±–æ–≤'—è–∑–∫–æ–≤–æ |
| **LOG_LEVEL** | `DEBUG` | `INFO` | `WARNING` |
| **RUN_SEEDS** | `true` | `false` | `false` |
| **CELERY_EAGER** | `True` (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ) | `False` | `False` |
| **Email Backend** | Console | SMTP | Production SMTP |
| **Backup Frequency** | –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ | –©–æ–¥–Ω—è | –ö–æ–∂–Ω—ñ 6 –≥–æ–¥–∏–Ω |

---

### üéØ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ production

- [ ] **–ó–º—ñ–Ω–∏—Ç–∏ –≤—Å—ñ –ø–∞—Ä–æ–ª—ñ** –Ω–∞ —Å–∫–ª–∞–¥–Ω—ñ (–º—ñ–Ω—ñ–º—É–º 32 —Å–∏–º–≤–æ–ª–∏)
- [ ] **–í–∏–º–∫–Ω—É—Ç–∏ DEBUG** (`DEBUG=False`)
- [ ] **–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ ALLOWED_HOSTS** (—Ç—ñ–ª—å–∫–∏ –≤–∞—à—ñ –¥–æ–º–µ–Ω–∏)
- [ ] **–£–≤—ñ–º–∫–Ω—É—Ç–∏ HTTPS** (SSL —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏)
- [ ] **–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ CORS** (—Ç—ñ–ª—å–∫–∏ –¥–æ–≤—ñ—Ä–µ–Ω—ñ origins)
- [ ] **–í–∏–º–∫–Ω—É—Ç–∏ RUN_SEEDS** (`RUN_SEEDS=false`)
- [ ] **–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥** (Sentry, CloudWatch)
- [ ] **–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è** (—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ª–æ–≥–∏)
- [ ] **–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –±–µ–∫–∞–ø–∏** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —â–æ–¥–µ–Ω–Ω—ñ)
- [ ] **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ CSRF/XSS** –∑–∞—Ö–∏—Å—Ç
- [ ] **–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ rate limiting**
- [ ] **–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ Secrets Manager** (AWS/Vault)
- [ ] **–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ CDN** –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏
- [ ] **Load balancer** –¥–ª—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
- [ ] **Database read replicas**

> üìñ **–î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:** [docs/ENV_ARCHITECTURE.md](docs/ENV_ARCHITECTURE.md)

---

## üõ† –†–æ–∑—Ä–æ–±–∫–∞

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

1. **Backend (Python/Django)**:
   ```bash
   cd backend
   python -m venv .venv
   source .venv/bin/activate  # Linux/macOS
   .venv\Scripts\activate     # Windows
   pip install -e ".[dev]"
   ```

2. **Frontend (Next.js)**:
   ```bash
   cd frontend
   npm install
   ```

### –ó–∞–ø—É—Å–∫ –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏

1. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤—ñ—Å–∏ —á–µ—Ä–µ–∑ Docker**:
   ```bash
   # –£ –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É
   docker-compose up -d postgres redis rabbitmq
   ```

2. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å –±–µ–∫–µ–Ω–¥**:
   ```bash
   cd backend
   python manage.py runserver
   ```

3. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥**:
   ```bash
   cd frontend
   npm run dev
   ```

4. **–î–æ–¥–∞—Ç–∫–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏ (–∑–∞ –ø–æ—Ç—Ä–µ–±–∏)**:
   ```bash
   # Celery worker
   celery -A config worker -l info
   
   # Celery beat (–ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è)
   celery -A config beat -l info
   ```

## üõ† –ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏

### –†–æ–±–æ—Ç–∞ –∑ Docker
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
make up

# –ó—É–ø–∏–Ω–∫–∞ –≤—Å—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
make down

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–µ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤—ñ—Å—É
docker-compose restart <service_name>

# –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤
docker-compose logs -f <service_name>
```

### –†–æ–±–æ—Ç–∞ –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö
```bash
# –ó–∞–ø—É—Å–∫ –º—ñ–≥—Ä–∞—Ü—ñ–π
docker-compose exec app python manage.py migrate

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π
docker-compose exec app python manage.py makemigrations

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—É–ø–µ—Ä–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
docker-compose exec app python manage.py createsuperuser

# –ó–∞–ø—É—Å–∫ shell –∑ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º –¥–æ –ë–î
docker-compose exec db psql -U postgres
```

### –†–æ–∑—Ä–æ–±–∫–∞ Frontend
```bash
# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
cd frontend
npm install

# –ó–∞–ø—É—Å–∫ —É —Ä–µ–∂–∏–º—ñ —Ä–æ–∑—Ä–æ–±–∫–∏
npm run dev

# –ó–±—ñ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
npm run build
```

## ü§ù –í–Ω–µ—Å–µ–Ω–Ω—è –∑–º—ñ–Ω

1. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤—É –≥—ñ–ª–∫—É –¥–ª—è –≤–∞—à–æ—ó —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ:
   ```bash
   git checkout -b feature/your-feature-name
   ```

2. –ó—Ä–æ–±—ñ—Ç—å –∫–æ–º—ñ—Ç –∑–º—ñ–Ω:
   ```bash
   git add .
   git commit -m "–î–æ–¥–∞–Ω–æ –Ω–æ–≤—É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å"
   ```

3. –ó–∞–ø—É—à—ñ—Ç—å –∑–º—ñ–Ω–∏ —É –≤—ñ–¥–¥–∞–ª–µ–Ω–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:
   ```bash
   git push origin feature/your-feature-name
   ```

4. –°—Ç–≤–æ—Ä—ñ—Ç—å Pull Request —É –≥—ñ–ª–∫—É `main`.

## üìÑ –õ—ñ—Ü–µ–Ω–∑—ñ—è

–¶–µ–π –ø—Ä–æ–µ–∫—Ç –ø–æ—à–∏—Ä—é—î—Ç—å—Å—è –ø—ñ–¥ –ª—ñ—Ü–µ–Ω–∑—ñ—î—é MIT. –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ –¥–∏–≤—ñ—Ç—å—Å—è —Ñ–∞–π–ª [LICENSE](LICENSE).

---

<div align="center">
  <p>–†–æ–∑—Ä–æ–±–ª–µ–Ω–æ –¥–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö —Ü—ñ–ª–µ–π</p>
  <p>¬© 2024 AutoRia Clone Team</p>
</div>


3. **–ì–æ—Ç–æ–≤–æ!** üéâ

–ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑–∞ –∞–¥—Ä–µ—Å–∞–º–∏:
- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:8000
- **API Docs**: http://localhost:3000/docs
- **Admin**: http://localhost:8000/admin

## üìä –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ï –ù–ê–ü–û–í–ù–ï–ù–ù–Ø –ë–ê–ó–ò –î–ê–ù–ò–• (–°–∏–¥—ñ–Ω–≥)

–°–∏–¥—ñ–Ω–≥ (–Ω–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏) –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–µ–∫—Ç—É —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `init_project_data`.

### üéØ –©–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —ñ –¥–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è:

#### 1. üë• **–¢–ï–°–¢–û–í–Ü –ö–û–†–ò–°–¢–£–í–ê–ß–Ü**
**–ö–æ–º–∞–Ω–¥–∞:** `python manage.py create_test_users`  
**–§–∞–π–ª:** `backend/apps/users/management/commands/create_test_users.py`

**–°—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏:**

- **üëë –°—É–ø–µ—Ä–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏ (–ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø):**
  - `admin@autoria.com` / –ø–∞—Ä–æ–ª—å: `12345678`
  - `pvs.versia@gmail.com` / –ø–∞—Ä–æ–ª—å: `12345678`

- **üëî –°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏ (Staff):**
  - `manager@autoria.com` - –ú–µ–Ω–µ–¥–∂–µ—Ä –∑ –ø—Ä–æ–¥–∞–∂—É
  - `moderator@autoria.com` - –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä –æ–≥–æ–ª–æ—à–µ–Ω—å
  - `support@autoria.com` - –°–ª—É–∂–±–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏

- **üë§ –ó–≤–∏—á–∞–π–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ (–ü–æ–∫—É–ø—Ü—ñ):**
  - `buyer1@gmail.com`, `buyer2@ukr.net`, `buyer3@i.ua`
  - `test.user@example.com`

- **üè™ –ü—Ä–æ–¥–∞–≤—Ü—ñ –∑ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏:**
  - `seller1@gmail.com` - –ü—Ä–∏–≤–∞—Ç–Ω–∏–π –ø—Ä–æ–¥–∞–≤–µ—Ü—å (BASIC)
  - `dealer@autohouse.com` - –ü—Ä–µ–º—ñ—É–º –¥–∏–ª–µ—Ä (PREMIUM)
  - `salon@carsalon.ua` - –ê–≤—Ç–æ—Å–∞–ª–æ–Ω (PREMIUM)

**–í—Å—ñ –ø–∞—Ä–æ–ª—ñ:** `12345678`  
**–¢–∞–±–ª–∏—Ü—ñ –ë–î:** `auth_user`, `users_profile`, `accounts_addsaccount`

---

#### 2. üó∫Ô∏è **–ì–ï–û–ì–†–ê–§–Ü–Ø –£–ö–†–ê–á–ù–ò**
**–ö–æ–º–∞–Ω–¥–∞:** `python manage.py populate_ukraine_geography`  
**–§–∞–π–ª:** `backend/apps/ads/management/commands/populate_ukraine_geography.py`

**–°—Ç–≤–æ—Ä—é—é—Ç—å—Å—è:**
- **üìç 26 —Ä–µ–≥—ñ–æ–Ω—ñ–≤:**
  - –í—Å—ñ 24 –æ–±–ª–∞—Å—Ç—ñ –£–∫—Ä–∞—ó–Ω–∏
  - –ê–† –ö—Ä–∏–º
  - –º. –ö–∏—ó–≤, –º. –°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å
  - **–¢–∞–±–ª–∏—Ü—è –ë–î:** `ads_regions`

- **üèôÔ∏è 200+ –º—ñ—Å—Ç:**
  - –°—Ç–æ–ª–∏—Ü—è (–ö–∏—ó–≤)
  - –í—Å—ñ –æ–±–ª–∞—Å–Ω—ñ —Ü–µ–Ω—Ç—Ä–∏ (24 —à—Ç)
  - –†–∞–π–æ–Ω–Ω—ñ —Ü–µ–Ω—Ç—Ä–∏
  - –ú—ñ—Å—Ç–∞ –æ–±–ª–∞—Å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è
  - **–¢–∞–±–ª–∏—Ü—è –ë–î:** `ads_cities`

---

#### 3. üìö **–î–û–í–Ü–î–ù–ò–ö–ò –ê–í–¢–û–ú–û–ë–Ü–õ–Ü–í**
**–ö–æ–º–∞–Ω–¥–∞:** `python manage.py auto_populate_references`  
**–§–∞–π–ª:** `backend/apps/ads/management/commands/auto_populate_references.py`

**–°—Ç–≤–æ—Ä—é—é—Ç—å—Å—è:**
- **üè≠ –ú–∞—Ä–∫–∏ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤:** Toyota, BMW, Mercedes-Benz, Audi, Volkswagen, Ford, Honda, Nissan, Hyundai, Kia —Ç–∞ —ñ–Ω. (10+ –º–∞—Ä–æ–∫)
  - **–¢–∞–±–ª–∏—Ü—è –ë–î:** `ads_car_marks`

- **üöô –ú–æ–¥–µ–ª—ñ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤:** Camry, Corolla –¥–ª—è Toyota; 3 Series, 5 Series –¥–ª—è BMW —Ç–æ—â–æ (100+ –º–æ–¥–µ–ª–µ–π)
  - **–¢–∞–±–ª–∏—Ü—è –ë–î:** `ads_car_models`

- **üé® –ö–æ–ª—å–æ—Ä–∏:** –ë—ñ–ª–∏–π, –ß–æ—Ä–Ω–∏–π, –°—ñ—Ä–∏–π, –ß–µ—Ä–≤–æ–Ω–∏–π, –°–∏–Ω—ñ–π, –ó–µ–ª–µ–Ω–∏–π —Ç–∞ —ñ–Ω. (20+ –∫–æ–ª—å–æ—Ä—ñ–≤)
  - **–¢–∞–±–ª–∏—Ü—è –ë–î:** `ads_car_colors`

- **üöõ –¢–∏–ø–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É:** –õ–µ–≥–∫–æ–≤—ñ, –í–∞–Ω—Ç–∞–∂–Ω—ñ, –ê–≤—Ç–æ–±—É—Å–∏, –ú–æ—Ç–æ—Ü–∏–∫–ª–∏
  - **–¢–∞–±–ª–∏—Ü—è –ë–î:** `ads_vehicle_types`

- **üîß –ü–æ–∫–æ–ª—ñ–Ω–Ω—è –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤:** –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π (50+ –ø–æ–∫–æ–ª—ñ–Ω—å)
  - **–¢–∞–±–ª–∏—Ü—è –ë–î:** `ads_car_generations`

- **‚öôÔ∏è –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:** —Ä—ñ–∑–Ω—ñ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—ó —Ç–∞ –¥–≤–∏–≥—É–Ω–∏ (100+ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ–π)
  - **–¢–∞–±–ª–∏—Ü—è –ë–î:** `ads_car_modifications`

---

#### 4. üöó **–û–ì–û–õ–û–®–ï–ù–ù–Ø –ü–†–û –ü–†–û–î–ê–ñ**
**–ö–æ–º–∞–Ω–¥–∞:** `python manage.py seed_car_ads --count=100`  
**–§–∞–π–ª–∏:** `backend/apps/ads/management/commands/seed_car_ads.py` –∞–±–æ `generate_test_ads_with_images.py`

**–°—Ç–≤–æ—Ä—é—é—Ç—å—Å—è 10-100 —Ç–µ—Å—Ç–æ–≤–∏—Ö –æ–≥–æ–ª–æ—à–µ–Ω—å –∑:**
- –ù–∞–∑–≤–∞, –¥–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å
- –ú–∞—Ä–∫–∞, –º–æ–¥–µ–ª—å, —Ä—ñ–∫ –≤–∏–ø—É—Å–∫—É (2010-2024)
- –ü—Ä–æ–±—ñ–≥, —Ü—ñ–Ω–∞ (–≤ UAH)
- –†–µ–≥—ñ–æ–Ω, –º—ñ—Å—Ç–æ
- –î–∏–Ω–∞–º—ñ—á–Ω—ñ –ø–æ–ª—è (–æ–±'—î–º –¥–≤–∏–≥—É–Ω–∞, —Ç–∏–ø –ø–∞–ª–∏–≤–∞, –∫–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á, —Ç–∏–ø –∫—É–∑–æ–≤–∞, –∫–æ–ª—ñ—Ä, —Å—Ç–∞–Ω)
- VIN-–∫–æ–¥ (70% –æ–≥–æ–ª–æ—à–µ–Ω—å)
- –†—ñ–∑–Ω—ñ —Å—Ç–∞—Ç—É—Å–∏ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –º–æ–¥–µ—Ä–∞—Ü—ñ—ó:
  - 50% - –∞–∫—Ç–∏–≤–Ω—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è
  - 20% - –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü—ñ—ó
  - 15% - —á–µ—Ä–Ω–µ—Ç–∫–∏
  - 10% - –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
  - 5% - –≤—ñ–¥—Ö–∏–ª–µ–Ω—ñ

**–¢–∞–±–ª–∏—Ü—è –ë–î:** `ads_carad`

---

#### 5. üñºÔ∏è **–ó–û–ë–†–ê–ñ–ï–ù–ù–Ø –ê–í–¢–û–ú–û–ë–Ü–õ–Ü–í**
**–ö–æ–º–∞–Ω–¥–∞:** `python manage.py generate_test_ads_with_images --count=10 --with-images`  
**–§–∞–π–ª:** `backend/apps/ads/management/commands/generate_test_ads_with_images.py`

**–°—Ç–≤–æ—Ä—é—é—Ç—å—Å—è:**
- AI-–∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ Flux Schnell –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∞–≤—Ç–æ
- –ê–±–æ placeholder –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (—è–∫—â–æ AI –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π)
- –ü–æ 1-3 —Ñ–æ—Ç–æ –Ω–∞ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è

**–¢–∞–±–ª–∏—Ü—è –ë–î:** `ads_images`

---

#### 6. üìç **–ê–î–†–ï–°–ò –ê–ö–ö–ê–£–ù–¢–Ü–í**
**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

**–°—Ç–≤–æ—Ä—é—é—Ç—å—Å—è:**
- –°–∏—Ä—ñ –∞–¥—Ä–µ—Å–∏ (–≤—É–ª–∏—Ü—è, –±—É–¥–∏–Ω–æ–∫, –º—ñ—Å—Ç–æ, —Ä–µ–≥—ñ–æ–Ω)
- –§–æ—Ä–º–∞—Ç–æ–≤–∞–Ω—ñ –∞–¥—Ä–µ—Å–∏ –∑ –≥–µ–æ–∫–æ–¥—É–≤–∞–Ω–Ω—è–º (—è–∫—â–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ Google Maps API)

**–¢–∞–±–ª–∏—Ü—ñ –ë–î:** `accounts_rawaddress`, `accounts_formattedaddress`

---

### üîÑ –ü—Ä–æ—Ü–µ—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ —Å–∏–¥—ñ–Ω–≥—É:

**–ì–æ–ª–æ–≤–Ω–∞ –∫–æ–º–∞–Ω–¥–∞:** `python manage.py init_project_data`  
**–§–∞–π–ª:** `backend/apps/ads/management/commands/init_project_data.py`

**–ü–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:**
1. ‚úÖ –ú—ñ–≥—Ä–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (`python manage.py migrate`)
2. üìö –î–æ–≤—ñ–¥–Ω–∏–∫–∏ (—Ä–µ–≥—ñ–æ–Ω–∏, –º—ñ—Å—Ç–∞, –º–∞—Ä–∫–∏, –º–æ–¥–µ–ª—ñ, –∫–æ–ª—å–æ—Ä–∏)
3. üë• –¢–µ—Å—Ç–æ–≤—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ (12+ –∞–∫–∞—É–Ω—Ç—ñ–≤)
4. üîß –ü–æ–∫–æ–ª—ñ–Ω–Ω—è —Ç–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤
5. üìç –§–æ—Ä–º–∞—Ç–æ–≤–∞–Ω—ñ –∞–¥—Ä–µ—Å–∏
6. üöó –û–≥–æ–ª–æ—à–µ–Ω–Ω—è –ø—Ä–æ –ø—Ä–æ–¥–∞–∂ (10-100 —à—Ç)
7. üñºÔ∏è –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤ (—è–∫—â–æ —É–≤—ñ–º–∫–Ω–µ–Ω–æ)

**–í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É:**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `seeding_tracker` –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤
- –°—Ç–∞—Ç—É—Å –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ Redis
- –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—å—Å—è –≤–∂–µ –≤–∏–∫–æ–Ω–∞–Ω—ñ –∫—Ä–æ–∫–∏

---

### ‚öôÔ∏è –ö–µ—Ä—É–≤–∞–Ω–Ω—è —Å–∏–¥—ñ–Ω–≥–æ–º:

**–ó–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è** (—É —Ñ–∞–π–ª—ñ `env-config/.env.base`):
```bash
RUN_SEEDS=true                          # –£–≤—ñ–º–∫–Ω—É—Ç–∏/–≤–∏–º–∫–Ω—É—Ç–∏ —Å–∏–¥—ñ–Ω–≥
FORCE_RESEED=true                       # –ü—Ä–∏–º—É—Å–æ–≤–æ –ø–µ—Ä–µ—Å—ñ—è—Ç–∏ –≤—Å–µ
GENERATE_TEST_ADS_WITH_IMAGES=true     # –ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ AI
```

**–†—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫ –æ–∫—Ä–µ–º–∏—Ö –∫—Ä–æ–∫—ñ–≤:**
```bash
# –¢—ñ–ª—å–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ
docker-compose exec app python manage.py create_test_users

# –¢—ñ–ª—å–∫–∏ –≥–µ–æ–≥—Ä–∞—Ñ—ñ—è
docker-compose exec app python manage.py populate_ukraine_geography

# –¢—ñ–ª—å–∫–∏ –¥–æ–≤—ñ–¥–Ω–∏–∫–∏
docker-compose exec app python manage.py auto_populate_references

# –¢—ñ–ª—å–∫–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è (–±–µ–∑ –∑–æ–±—Ä–∞–∂–µ–Ω—å)
docker-compose exec app python manage.py seed_car_ads --count=50

# –û–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑ AI-–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º–∏
docker-compose exec app python manage.py generate_test_ads_with_images --count=10 --with-images

# –ü–æ–≤–Ω–∏–π —Ä–µ—Å—ñ–¥ (–æ—á–∏—Å—Ç–∏—Ç–∏ —ñ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–Ω–æ–≤–æ)
docker-compose exec app python manage.py init_project_data --force
```

---

### üìä –ü—ñ–¥—Å—É–º–∫–æ–≤–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

–ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ —Å–∏–¥—ñ–Ω–≥—É –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö –±—É–¥–µ:
- üìç **26 —Ä–µ–≥—ñ–æ–Ω—ñ–≤** –£–∫—Ä–∞—ó–Ω–∏
- üèôÔ∏è **200+ –º—ñ—Å—Ç** (–≤—Å—ñ –æ–±–ª–∞—Å–Ω—ñ —Ü–µ–Ω—Ç—Ä–∏ + –≤–µ–ª–∏–∫—ñ –º—ñ—Å—Ç–∞)
- üè≠ **10+ –º–∞—Ä–æ–∫** –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤
- üöô **100+ –º–æ–¥–µ–ª–µ–π** –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤
- üé® **20+ –∫–æ–ª—å–æ—Ä—ñ–≤**
- üîß **50+ –ø–æ–∫–æ–ª—ñ–Ω—å** –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤
- ‚öôÔ∏è **100+ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ–π**
- üë§ **12+ —Ç–µ—Å—Ç–æ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** (–≤—Å—ñ –∑ –ø–∞—Ä–æ–ª–µ–º `12345678`)
- üöó **10-100 –æ–≥–æ–ª–æ—à–µ–Ω—å** –ø—Ä–æ –ø—Ä–æ–¥–∞–∂
- üñºÔ∏è **10-100 –∑–æ–±—Ä–∞–∂–µ–Ω—å** –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤

**–î–æ—Å—Ç—É–ø –¥–æ –¥–∞–Ω–∏—Ö:**
- –ß–µ—Ä–µ–∑ Django Admin: `http://localhost:8000/admin/`
- –ß–µ—Ä–µ–∑ Swagger API: `http://localhost:8000/api/schema/swagger/`
- –ß–µ—Ä–µ–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥: `http://localhost:3000/`

**–¢–µ—Å—Ç–æ–≤—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ –¥–ª—è –≤—Ö–æ–¥—É:**
```
–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä: admin@autoria.com / 12345678
–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä:     moderator@autoria.com / 12345678
–ü—Ä–æ–¥–∞–≤–µ—Ü—å:     seller1@gmail.com / 12345678
–ü–æ–∫—É–ø–µ—Ü—å:      buyer1@gmail.com / 12345678
```

---

## üÜò TROUBLESHOOTING (–í–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º)

### üêò PostgreSQL –ü—Ä–æ–±–ª–µ–º–∏

#### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: `container pg is unhealthy`

**–ü—Ä–∏—á–∏–Ω–∞:** PostgreSQL –Ω–µ –≤—Å—Ç–∏–≥–∞—î —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏—Å—è –∞–±–æ –ø–æ—Ä—Ç –∑–∞–π–Ω—è—Ç–∏–π.

**–†—ñ—à–µ–Ω–Ω—è:**

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –ø–æ—Ä—Ç 5432 –≤—ñ–ª—å–Ω–∏–π:**
   ```bash
   # Windows
   netstat -ano | findstr :5432
   
   # Linux/Mac
   lsof -i :5432
   ```

2. **–Ø–∫—â–æ –ø–æ—Ä—Ç –∑–∞–π–Ω—è—Ç–∏–π - –∑—É–ø–∏–Ω—ñ—Ç—å –ø—Ä–æ—Ü–µ—Å –∞–±–æ –∑–º—ñ–Ω—ñ—Ç—å –ø–æ—Ä—Ç:**
   ```yaml
   # docker-compose.yml
   pg:
     ports:
       - "5433:5432"  # –ó–º—ñ–Ω–∏—Ç–∏ –Ω–∞ —ñ–Ω—à–∏–π –ø–æ—Ä—Ç
   ```

3. **–û—á–∏—Å—Ç—ñ—Ç—å —Ç–æ–º PostgreSQL —ñ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å:**
   ```bash
   docker-compose down
   docker volume rm final_drf_next_sept_2024_pg-data
   docker-compose up -d --force-recreate
   ```

4. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ PostgreSQL:**
   ```bash
   docker-compose logs pg
   ```

5. **–ó–±—ñ–ª—å—à—Ç–µ —á–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó:**
   ```yaml
   # docker-compose.yml
   pg:
     healthcheck:
       start_period: 120s  # –ó–±—ñ–ª—å—à–∏—Ç–∏ –¥–æ 120 —Å–µ–∫—É–Ω–¥
   ```

> üìñ **–î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:** [docs/POSTGRESQL_TROUBLESHOOTING.md](docs/POSTGRESQL_TROUBLESHOOTING.md)

---

### ‚öõÔ∏è React 18/19 Compatibility

#### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: `npm ERR! ERESOLVE unable to resolve dependency tree`

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–Ω—Ñ–ª—ñ–∫—Ç –≤–µ—Ä—Å—ñ–π React 18 vs React 19.

**–†—ñ—à–µ–Ω–Ω—è:**

1. **–ó–ê–í–ñ–î–ò –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `--legacy-peer-deps`:**
   ```bash
   npm install --legacy-peer-deps
   ```

2. **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
   ```bash
   # Windows
   .\frontend\scripts\fix-react-deps.ps1
   
   # Linux/Mac
   bash frontend/scripts/fix-react-deps.sh
   ```

3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ `overrides` –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –≤ `package.json`:**
   ```json
   "overrides": {
     "react": "19.1.0",
     "react-dom": "19.1.0",
     "@types/react": "^19.1.9",
     "@types/react-dom": "^19"
   }
   ```

4. **–û—á–∏—Å—Ç—ñ—Ç—å –∫–µ—à npm:**
   ```bash
   npm cache clean --force
   rm -rf node_modules package-lock.json
   npm install --legacy-peer-deps
   ```

> üìñ **–î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:** [frontend/REACT_COMPATIBILITY.md](frontend/REACT_COMPATIBILITY.md)  
> üöë **–®–≤–∏–¥–∫—ñ —Ä—ñ—à–µ–Ω–Ω—è:** [frontend/QUICK_FIX_REACT.md](frontend/QUICK_FIX_REACT.md)

---

### üê≥ Docker –ü—Ä–æ–±–ª–µ–º–∏

#### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: `Error response from daemon: Ports are not available`

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Ä—Ç–∏ –≤–∂–µ –∑–∞–π–Ω—è—Ç—ñ —ñ–Ω—à–∏–º–∏ –ø—Ä–æ—Ü–µ—Å–∞–º–∏.

**–†—ñ—à–µ–Ω–Ω—è:**

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–∞–π–Ω—è—Ç—ñ –ø–æ—Ä—Ç–∏:**
   ```bash
   # Windows
   netstat -ano | findstr ":3000 :8000 :5432 :6379 :5672 :15672 :5555 :5540"
   
   # Linux/Mac
   lsof -i :3000,:8000,:5432,:6379,:5672,:15672,:5555,:5540
   ```

2. **–ó—É–ø–∏–Ω—ñ—Ç—å –ø—Ä–æ—Ü–µ—Å–∏ –∞–±–æ –∑–º—ñ–Ω—ñ—Ç—å –ø–æ—Ä—Ç–∏** –≤ `docker-compose.yml`

3. **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –∞–≥—Ä–µ—Å–∏–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è Docker:**
   ```bash
   docker-compose down -v
   docker system prune -af --volumes
   ```

---

#### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: `docker-compose: command not found`

**–ü—Ä–∏—á–∏–Ω–∞:** Docker Compose –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π.

**–†—ñ—à–µ–Ω–Ω—è:**

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–µ—Ä—Å—ñ—é Docker Compose:**
   ```bash
   docker-compose --version
   # –∞–±–æ –¥–ª—è –Ω–æ–≤–æ—ó –≤–µ—Ä—Å—ñ—ó
   docker compose version
   ```

2. **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –Ω–æ–≤—É –∫–æ–º–∞–Ω–¥—É** (—è–∫—â–æ Docker Compose V2):
   ```bash
   docker compose up -d
   ```

3. **–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Docker Compose:**
   - Windows/Mac: Docker Desktop –≤–∫–ª—é—á–∞—î Compose
   - Linux: https://docs.docker.com/compose/install/

---

### üî• Frontend Build –ü—Ä–æ–±–ª–µ–º–∏

#### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: `Module not found: Can't resolve '@/...'`

**–ü—Ä–∏—á–∏–Ω–∞:** –í—ñ–¥—Å—É—Ç–Ω—ñ –º–æ–¥—É–ª—ñ –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ —à–ª—è—Ö–∏ —ñ–º–ø–æ—Ä—Ç—É.

**–†—ñ—à–µ–Ω–Ω—è:**

1. **–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ:**
   ```bash
   cd frontend
   npm install --legacy-peer-deps
   ```

2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `tsconfig.json` paths:**
   ```json
   {
     "compilerOptions": {
       "paths": {
         "@/*": ["./src/*"]
       }
     }
   }
   ```

3. **–û—á–∏—Å—Ç—ñ—Ç—å Next.js –∫–µ—à:**
   ```bash
   rm -rf .next
   npm run build
   ```

---

#### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: `Error: EMFILE: too many open files`

**–ü—Ä–∏—á–∏–Ω–∞:** –õ—ñ–º—ñ—Ç –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö —Ñ–∞–π–ª—ñ–≤ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–∏–π (Windows).

**–†—ñ—à–µ–Ω–Ω—è:**

1. **–ó–±—ñ–ª—å—à—ñ—Ç—å –ª—ñ–º—ñ—Ç —É WSL2** (—è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ):
   ```bash
   ulimit -n 65536
   ```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å Docker Desktop**

3. **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –º–µ–Ω—à–µ watchers** (—Ç–∏–º—á–∞—Å–æ–≤–µ —Ä—ñ—à–µ–Ω–Ω—è):
   ```bash
   # frontend/.env.local
   WATCHPACK_POLLING=true
   ```

---

### üîå Backend API –ü—Ä–æ–±–ª–µ–º–∏

#### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: `502 Bad Gateway` –ø—Ä–∏ –¥–æ—Å—Ç—É–ø—ñ –¥–æ API

**–ü—Ä–∏—á–∏–Ω–∞:** Backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å—Ç–∏–≤—Å—è –∞–±–æ –Ω–µ –≥–æ—Ç–æ–≤–∏–π.

**–†—ñ—à–µ–Ω–Ω—è:**

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤:**
   ```bash
   docker-compose ps
   ```

2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ backend:**
   ```bash
   docker-compose logs app
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å backend:**
   ```bash
   docker-compose restart app
   ```

4. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –º—ñ–≥—Ä–∞—Ü—ñ—ó –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ:**
   ```bash
   docker-compose exec app python manage.py migrate
   ```

---

#### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: `CORS error` –ø—Ä–∏ –∑–∞–ø–∏—Ç–∞—Ö –∑ frontend

**–ü—Ä–∏—á–∏–Ω–∞:** CORS –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–†—ñ—à–µ–Ω–Ω—è:**

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `env-config/.env.docker`:**
   ```bash
   CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
   CSRF_TRUSTED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
   ```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å backend –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏:**
   ```bash
   docker-compose restart app
   ```

---

### üìß Celery/RabbitMQ –ü—Ä–æ–±–ª–µ–º–∏

#### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: `celery.exceptions.TimeoutError`

**–ü—Ä–∏—á–∏–Ω–∞:** Celery worker –Ω–µ –∑–∞–ø—É—â–µ–Ω–∏–π –∞–±–æ RabbitMQ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π.

**–†—ñ—à–µ–Ω–Ω—è:**

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤—ñ—Å—ñ–≤:**
   ```bash
   docker-compose ps rabbitmq celery-worker flower
   ```

2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:**
   ```bash
   docker-compose logs celery-worker
   docker-compose logs rabbitmq
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤—ñ—Å–∏:**
   ```bash
   docker-compose restart rabbitmq celery-worker celery-beat
   ```

4. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ RabbitMQ:**
   - URL: http://localhost:15672
   - –õ–æ–≥—ñ–Ω: `guest` / `guest`

---

### üíæ Redis –ü—Ä–æ–±–ª–µ–º–∏

#### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: `Error: Redis connection failed`

**–ü—Ä–∏—á–∏–Ω–∞:** Redis –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω–∏–π –∞–±–æ –ø–æ—Ä—Ç –∑–∞–π–Ω—è—Ç–∏–π.

**–†—ñ—à–µ–Ω–Ω—è:**

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å Redis:**
   ```bash
   docker-compose ps redis
   ```

2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ Redis:**
   ```bash
   docker-compose logs redis
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å Redis:**
   ```bash
   docker-compose restart redis
   ```

4. **–û—á–∏—Å—Ç—ñ—Ç—å Redis –¥–∞–Ω—ñ** (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ):
   ```bash
   docker-compose exec redis redis-cli FLUSHALL
   ```

---

### üîç –õ–æ–≥–∏ –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–í—Å—ñ –ª–æ–≥–∏ —Ä–∞–∑–æ–º:**
```bash
docker-compose logs -f
```

**–û–∫—Ä–µ–º—ñ —Å–µ—Ä–≤—ñ—Å–∏:**
```bash
docker-compose logs -f app          # Backend Django
docker-compose logs -f pg           # PostgreSQL
docker-compose logs -f redis        # Redis
docker-compose logs -f rabbitmq     # RabbitMQ
docker-compose logs -f celery-worker # Celery Worker
docker-compose logs -f nginx        # Nginx
```

**–û—Å—Ç–∞–Ω–Ω—ñ 100 —Ä—è–¥–∫—ñ–≤:**
```bash
docker-compose logs --tail=100 app
```

**–õ–æ–≥–∏ –∑ –ø–µ–≤–Ω–æ–≥–æ —á–∞—Å—É:**
```bash
docker-compose logs --since 30m app  # –û—Å—Ç–∞–Ω–Ω—ñ 30 —Ö–≤–∏–ª–∏–Ω
```

---

### üö® –ü–æ–≤–Ω–µ –ø–µ—Ä–µ–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è (Nuclear Option)

–Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –¥–æ–ø–æ–º–∞–≥–∞—î:

```bash
# 1. –ó—É–ø–∏–Ω–∏—Ç–∏ –í–°–ï
docker-compose down -v

# 2. –û—á–∏—Å—Ç–∏—Ç–∏ Docker
docker system prune -af --volumes

# 3. –í–∏–¥–∞–ª–∏—Ç–∏ –ø–∞–ø–∫–∏ –∫–µ—à—É
rm -rf frontend/.next
rm -rf frontend/node_modules
rm -rf pg/data

# 4. –ü–µ—Ä–µ–∑—ñ–±—Ä–∞—Ç–∏ –∑ –Ω—É–ª—è
python deploy.py
```

> ‚ö†Ô∏è **–£–≤–∞–≥–∞**: –¶–µ –≤–∏–¥–∞–ª–∏—Ç—å –í–°–Ü –¥–∞–Ω—ñ, –≤–∫–ª—é—á–Ω–æ –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö!

---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∏–π —Å—Ç–µ–∫

### Backend
- **Django 5.0+** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Django REST Framework** - API —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL** - –æ—Å–Ω–æ–≤–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö
- **Redis** - –∫–µ—à—É–≤–∞–Ω–Ω—è —Ç–∞ —Å–µ—Å—ñ—ó
- **RabbitMQ** - –±—Ä–æ–∫–µ—Ä –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- **Celery** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è
- **JWT** - –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è
- **Swagger/OpenAPI** - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è API

### Frontend
- **Next.js 15** - React —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **TypeScript** - —Ç–∏–ø—ñ–∑–æ–≤–∞–Ω–∏–π JavaScript
- **Tailwind CSS** - CSS —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **shadcn/ui** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞
- **NextAuth.js** - –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è
- **React Hook Form** - —Ä–æ–±–æ—Ç–∞ –∑ —Ñ–æ—Ä–º–∞–º–∏
- **Lucide React** - —ñ–∫–æ–Ω–∫–∏

### DevOps & Tools
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü—ñ—è
- **Docker Compose** - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü—ñ—è
- **Nginx** - –≤–µ–±-—Å–µ—Ä–≤–µ—Ä (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
- **GitHub Actions** - CI/CD (–≥–æ—Ç–æ–≤–∏–π –¥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
DRF_NEXT_FULLSTACK_FINAL/
‚îú‚îÄ‚îÄ backend/                 # Django REST API
‚îÇ   ‚îú‚îÄ‚îÄ apps/               # Django –¥–æ–¥–∞—Ç–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ config/             # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Django
‚îÇ   ‚îú‚îÄ‚îÄ core/               # –ó–∞–≥–∞–ª—å–Ω—ñ —É—Ç–∏–ª—ñ—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt    # Python –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
‚îú‚îÄ‚îÄ frontend/               # Next.js –¥–æ–¥–∞—Ç–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ src/               # –í–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ public/            # –°—Ç–∞—Ç–∏—á–Ω—ñ —Ñ–∞–π–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ package.json       # Node.js –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
‚îú‚îÄ‚îÄ env-config/            # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –æ—Ç–æ—á–µ–Ω–Ω—è
‚îú‚îÄ‚îÄ docs/                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ docker-compose.yml     # Docker –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îî‚îÄ‚îÄ deploy.py             # –°–∫—Ä–∏–ø—Ç —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
```

## üéì –û—Å–≤—ñ—Ç–Ω—è —Ü—ñ–Ω–Ω—ñ—Å—Ç—å

–¶–µ–π –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î:

### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ –ø–∞—Ç–µ—Ä–Ω–∏
- **–ú—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞** –∑ Docker
- **API-first –ø—ñ–¥—Ö—ñ–¥** –¥–æ —Ä–æ–∑—Ä–æ–±–∫–∏
- **–†–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ** –º—ñ–∂ frontend —Ç–∞ backend
- **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** –ø—Ä–æ–µ–∫—Ç—É

### –ù–∞–π–∫—Ä–∞—â—ñ –ø—Ä–∞–∫—Ç–∏–∫–∏
- **–¢–∏–ø–æ–±–µ–∑–ø–µ–∫–∞** –∑ TypeScript
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è** (–≥–æ—Ç–æ–≤–µ –¥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è)
- **–î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—è API** –∑ Swagger
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü—ñ—è** –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
- **–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å—Ç–∞–Ω–æ–º** –≤ React –¥–æ–¥–∞—Ç–∫–∞—Ö

### –°—É—á–∞—Å–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó
- **Server-Side Rendering** –∑ Next.js
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –æ–±—Ä–æ–±–∫–∞** –∑ Celery
- **–†–µ–∞–∫—Ç–∏–≤–Ω–∏–π UI** –∑ —Å—É—á–∞—Å–Ω–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è**

## üîß –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∫–æ–º–∞–Ω–¥–∏

### –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç–æ–º
```bash
# –ó—É–ø–∏–Ω–∫–∞ –≤—Å—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
docker-compose down

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ—é
docker-compose down && docker-compose up -d --build

# –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤
docker-compose logs -f

# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤—ñ—Å—ñ–≤
docker-compose ps
```

### –†–æ–±–æ—Ç–∞ –∑ –¥–∞–Ω–∏–º–∏
```bash
# –ü—Ä–∏–º—É—Å–æ–≤–∏–π –ø–µ—Ä–µ—Å—ñ–¥ –¥–∞–Ω–∏—Ö
FORCE_RESEED=true docker-compose up -d

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—É–ø–µ—Ä–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
docker-compose exec app python manage.py createsuperuser

# –î–æ—Å—Ç—É–ø –¥–æ Django shell
docker-compose exec app python manage.py shell
```

### –†–æ–∑—Ä–æ–±–∫–∞
```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤ backend
docker-compose exec app python manage.py test

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤ frontend
cd frontend && npm test

# –õ—ñ–Ω—Ç–∏–Ω–≥ –∫–æ–¥—É
cd frontend && npm run lint
```

## üöÄ –î–µ–ø–ª–æ–π (–¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏)

> –û–±–∏–¥–≤–∞ —Å—Ü–µ–Ω–∞—Ä—ñ—ó –∑–∞–ø—É—Å–∫–∞—é—Ç—å—Å—è –æ–¥–Ω–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º `deploy.py`. –û–±–µ—Ä—ñ—Ç—å —Ä–µ–∂–∏–º —É –º–µ–Ω—é –∞–±–æ —è–≤–Ω–æ —á–µ—Ä–µ–∑ –ø—Ä–∞–ø–æ—Ä–µ—Ü—å `--mode`.

- **–†–µ–∂–∏–º 1: Backend —É Docker + Frontend –ª–æ–∫–∞–ª—å–Ω–æ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏)**
  - –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:
    - Docker: –ø—ñ–¥–Ω—ñ–º–∞—é—Ç—å—Å—è –≤—Å—ñ –±–µ–∫–µ–Ω–¥‚Äë—Å–µ—Ä–≤—ñ—Å–∏ (`docker-compose.yml`).
    - Frontend: –∑–±–∏—Ä–∞—î—Ç—å—Å—è —ñ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (`npm run build` ‚Üí `npm run start` –Ω–∞ –ø–æ—Ä—Ç—É 3000).
  - –ö–æ–º–∞–Ω–¥–∞:
    - –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ: `python deploy.py` —ñ –æ–±–µ—Ä—ñ—Ç—å –ø—É–Ω–∫—Ç 1
    - –ê–±–æ —è–≤–Ω–æ: `python deploy.py --mode local`
  - –ü–æ—Å–∏–ª–∞–Ω–Ω—è –ø—ñ—Å–ª—è —Å—Ç–∞—Ä—Ç—É:
    - Nginx (–∑–∞–≥–∞–ª—å–Ω–∏–π —à–ª—é–∑): http://localhost
    - Frontend –Ω–∞–ø—Ä—è–º—É: http://localhost:3000
    - Backend API: http://localhost:8000

- **–†–µ–∂–∏–º 2: –ü–æ–≤–Ω–∏–π Docker (–≤–∫–ª—é—á–Ω–æ –∑ Frontend)**
  - –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:
    - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è compose‚Äëoverride: `docker-compose.yml` + `docker-compose.with_frontend.yml` (–ª–∏—à–µ —Å–µ—Ä–≤—ñ—Å `frontend`).
    - Frontend –±—É–¥—É—î—Ç—å—Å—è —Ç–∞ –ø—Ä–∞—Ü—é—î –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–ø–æ—Ä—Ç 3000 –ø—Ä–æ–±—Ä–æ—à–µ–Ω–æ –Ω–∞–∑–æ–≤–Ω—ñ).
    - –õ–æ–∫–∞–ª—å–Ω–∏–π `npm start` –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è.
  - –ö–æ–º–∞–Ω–¥–∞:
    - –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ: `python deploy.py` —ñ –æ–±–µ—Ä—ñ—Ç—å –ø—É–Ω–∫—Ç 2
    - –ê–±–æ —è–≤–Ω–æ: `python deploy.py --mode with_frontend`
  - –ü–æ—Å–∏–ª–∞–Ω–Ω—è –ø—ñ—Å–ª—è —Å—Ç–∞—Ä—Ç—É:
    - Nginx (–∑–∞–≥–∞–ª—å–Ω–∏–π —à–ª—é–∑): http://localhost
    - Frontend –Ω–∞–ø—Ä—è–º—É: http://localhost:3000
    - Backend API (–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –º–µ—Ä–µ–∂—ñ): http://app:8000 (–∑–æ–≤–Ω—ñ: http://localhost:8000)

–ü—Ä–∏–º—ñ—Ç–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ
- –£ –ø—Ä–æ–¥‚Äë—Ä–µ–∂–∏–º—ñ –≤–∏–º–∫–Ω–µ–Ω–æ DevTools/HMR: `NEXT_DISABLE_DEVTOOLS=1`, `NEXT_TELEMETRY_DISABLED=1`.
- –ü–µ—Ä–µ–¥ –±—ñ–ª–¥–æ–º —Ñ—Ä–æ–Ω—Ç–∞ –æ—á–∏—â–∞—é—Ç—å—Å—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏ `.next/.turbo` –¥–ª—è ¬´—á–∏—Å—Ç–æ—ó¬ª –∑–±—ñ—Ä–∫–∏.
- –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ preconnect/dns‚Äëprefetch, `font-display: swap`, —ñ in‚Äëmemory –∫–µ—à –¥–æ–≤—ñ–¥–Ω–∏–∫—ñ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –π –∫–ª—ñ—î–Ω—Ç—ñ.
- –í –æ–±–æ—Ö —Ä–µ–∂–∏–º–∞—Ö –¥–æ—Å—Ç—É–ø–Ω—ñ –æ–¥–Ω–∞–∫–æ–≤—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è.

–ö–æ–º–∞–Ω–¥–∏ –¥–ª—è –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è
- –ó—É–ø–∏–Ω–∫–∞ —Å—Ç–µ–∫—É: `docker-compose down -v`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ–≤–Ω–æ–≥–æ Docker: `python deploy.py --mode with_frontend`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∑ –ª–æ–∫–∞–ª—å–Ω–∏–º —Ñ—Ä–æ–Ω—Ç–æ–º: `python deploy.py --mode local`

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

- **[üîê –ë–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∞ –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó](docs/MULTI_LEVEL_AUTH_ARCHITECTURE.md)** - –î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å —Ç—Ä–∏—Ä—ñ–≤–Ω–µ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- [–ü—Ä–æ—Ü–µ—Å —Å—ñ–¥–∏–Ω–≥—É –¥–∞–Ω–∏—Ö](docs/SEEDING_PROCESS_UA.md)
- [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è](http://localhost:3000/docs)
- [Swagger UI](http://localhost:8000/api/doc/)

## ü§ù –í–Ω–µ—Å–æ–∫ —É –ø—Ä–æ–µ–∫—Ç

–¶–µ–π –ø—Ä–æ–µ–∫—Ç —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –≤ –æ—Å–≤—ñ—Ç–Ω—ñ—Ö —Ü—ñ–ª—è—Ö. –í–∏ –º–æ–∂–µ—Ç–µ:

1. **–§–æ—Ä–∫–Ω—É—Ç–∏** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
2. **–°—Ç–≤–æ—Ä–∏—Ç–∏** feature branch
3. **–í–Ω–µ—Å—Ç–∏** –∑–º—ñ–Ω–∏
4. **–°—Ç–≤–æ—Ä–∏—Ç–∏** Pull Request

## üìÑ –õ—ñ—Ü–µ–Ω–∑—ñ—è

–¶–µ–π –ø—Ä–æ–µ–∫—Ç —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –≤ –æ—Å–≤—ñ—Ç–Ω—ñ—Ö —Ü—ñ–ª—è—Ö —Ç–∞ —Ä–æ–∑–ø–æ–≤—Å—é–¥–∂—É—î—Ç—å—Å—è –ø—ñ–¥ –ª—ñ—Ü–µ–Ω–∑—ñ—î—é MIT.

## üÜò –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

### –ß–∞—Å—Ç—ñ –ø—Ä–æ–±–ª–µ–º–∏

**–ü–æ—Ä—Ç–∏ –∑–∞–π–Ω—è—Ç—ñ:**
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞–π–Ω—è—Ç—ñ –ø–æ—Ä—Ç–∏
netstat -tulpn | grep :3000
netstat -tulpn | grep :8000
```

**–ü—Ä–æ–±–ª–µ–º–∏ –∑ Docker:**
```bash
# –û—á–∏—â–µ–Ω–Ω—è Docker
docker system prune -a
docker-compose down -v
```

**–ü—Ä–æ–±–ª–µ–º–∏ –∑ –¥–∞–Ω–∏–º–∏:**
```bash
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
FORCE_RESEED=true docker-compose up -d
```

### –õ–æ–≥–∏ –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```bash
# –í—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏
docker-compose logs

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Å–µ—Ä–≤—ñ—Å
docker-compose logs app
docker-compose logs pg
docker-compose logs redis
```

---

**–°—Ç–≤–æ—Ä–µ–Ω–æ –∑ ‚ù§Ô∏è –¥–ª—è –≤–∏–≤—á–µ–Ω–Ω—è —Å—É—á–∞—Å–Ω–æ—ó –≤–µ–±-—Ä–æ–∑—Ä–æ–±–∫–∏**

üéì **–ù–∞–≤—á–∞–ª—å–Ω–∏–π –ø—Ä–æ–µ–∫—Ç** | üöÄ **–ì–æ—Ç–æ–≤–∏–π –¥–æ –∑–∞–ø—É—Å–∫—É** | üìö **–ü–æ–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è**
