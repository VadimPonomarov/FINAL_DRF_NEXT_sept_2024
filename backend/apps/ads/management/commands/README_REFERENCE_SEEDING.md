# üìö Car Reference Data Seeding

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–æ–≤—ñ–¥–Ω–∏–∫—ñ–≤ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤ –∑ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –ø–∞–º'—è—Ç—ñ —Ç–∞ –∑'—î–¥–Ω–∞–Ω—å.

## üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è

### –ü—Ä–∏ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–µ–∫—Ç—É

–î–æ–≤—ñ–¥–Ω–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–µ–∫—Ç—É, —è–∫—â–æ –≤–æ–Ω–∏ –ø—É—Å—Ç—ã–µ:

```bash
# –í Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)
docker-compose up

# –õ–æ–∫–∞–ª—å–Ω–æ –∑ –∑–º—ñ–Ω–Ω–æ—é —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
AUTO_POPULATE_REFERENCES=true python manage.py runserver
```

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è

–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –≤ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö:

1. **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**: `IS_DOCKER=true`
2. **–ó–º—ñ–Ω–Ω–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞**: `AUTO_POPULATE_REFERENCES=true`
3. **Django settings**: `AUTO_POPULATE_REFERENCES = True`

## üõ†Ô∏è –†—É—á–Ω—ñ –∫–æ–º–∞–Ω–¥–∏

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è (—à–≤–∏–¥–∫–µ)

```bash
# –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –ø—É—Å—Ç–æ
python manage.py auto_populate_references

# –ü—Ä–∏–º—É—Å–æ–≤–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
python manage.py auto_populate_references --force
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –û–±—Ä–æ–±–ª—è—î –ø–µ—Ä—à—ñ 10,000 —Ä—è–¥–∫—ñ–≤ –¥–ª—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ
- –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –¥–ª—è –∑–∞–ø—É—Å–∫—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–∫—Ä–∏–≤–∞—î –∑'—î–¥–Ω–∞–Ω–Ω—è

### 2. –ë–µ–∑–ø–µ—á–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è (–ø–æ–≤–Ω–µ)

```bash
# –ü–æ–≤–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∑ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–æ–º –ø–∞–º'—è—Ç—ñ
python manage.py seed_references_safe --monitor-memory

# –û—á–∏—Å—Ç–∏—Ç–∏ —Ç–∞ –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ –∑–∞–Ω–æ–≤–æ
python manage.py seed_references_safe --clear

# –ó –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º —Ä–æ–∑–º—ñ—Ä—É –±–∞—Ç—á—É
python manage.py seed_references_safe --batch-size 500
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**
- –û–±—Ä–æ–±–ª—è—î –≤—Å—ñ –¥–∞–Ω—ñ –∑ CSV
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ
- –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–æ–∑–º—ñ—Ä—É –±–∞—Ç—á—ñ–≤
- –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è

### 3. –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è (—Ä–æ–∑—à–∏—Ä–µ–Ω–µ)

```bash
# –ü–æ–≤–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∑ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –ø–∞–º'—è—Ç—ñ
python manage.py populate_car_references --memory-check

# –ó –æ–±–º–µ–∂–µ–Ω–Ω—è–º –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Ä—è–¥–∫—ñ–≤
python manage.py populate_car_references --limit 5000

# –ó –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º –±–∞—Ç—á—É
python manage.py populate_car_references --batch-size 2000
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö

### –©–æ –∑–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è:

1. **–¢–∏–ø–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É** (`VehicleTypeModel`)
   - –õ–µ–≥–∫–æ–≤—ñ, –ú–æ—Ç–æ, –í–∞–Ω—Ç–∞–∂—ñ–≤–∫–∏, –ü—Ä–∏—á–µ–ø–∏, –°–ø–µ—Ü—Ç–µ—Ö–Ω—ñ–∫–∞, —Ç–æ—â–æ

2. **–ú–∞—Ä–∫–∏ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤** (`CarMarkModel`)
   - Toyota, BMW, Mercedes-Benz, Audi, —Ç–æ—â–æ
   - –ü—Ä–∏–≤'—è–∑–∞–Ω—ñ –¥–æ —Ç–∏–ø—ñ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É

3. **–ú–æ–¥–µ–ª—ñ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤** (`CarModel`)
   - Camry, Golf, Focus, —Ç–æ—â–æ
   - –ü—Ä–∏–≤'—è–∑–∞–Ω—ñ –¥–æ –º–∞—Ä–æ–∫

4. **–ö–æ–ª—å–æ—Ä–∏ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤** (`CarColorModel`)
   - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –Ω–∞–±—ñ—Ä –∫–æ–ª—å–æ—Ä—ñ–≤ –∑ hex-–∫–æ–¥–∞–º–∏

### –î–∂–µ—Ä–µ–ª–æ –¥–∞–Ω–∏—Ö:

```
backend/core/data/cars_dict_output.csv
```

–§–æ—Ä–º–∞—Ç: `–¢–∏–ø_—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É,–ú–∞—Ä–∫–∞,–ú–æ–¥–µ–ª—å`

## üß† –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–∞–º'—è—Ç—ñ

### –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:

1. **Bulk –æ–ø–µ—Ä–∞—Ü—ñ—ó** –∑–∞–º—ñ—Å—Ç—å –æ–∫—Ä–µ–º–∏—Ö INSERT
2. **–ë–∞—Ç—á—É–≤–∞–Ω–Ω—è** –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –Ω–∞–±–æ—Ä—ñ–≤ –¥–∞–Ω–∏—Ö
3. **Garbage collection** –º—ñ–∂ –±–∞—Ç—á–∞–º–∏
4. **–ó–∞–∫—Ä–∏—Ç—Ç—è –∑'—î–¥–Ω–∞–Ω—å** –ø—ñ—Å–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π
5. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º'—è—Ç—ñ** (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

### –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥:

```bash
# –£–≤—ñ–º–∫–Ω—É—Ç–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º'—è—Ç—ñ
python manage.py seed_references_safe --monitor-memory

# –í–∏–≤—ñ–¥:
# üß† Memory at Start: 45.23 MB
# üß† Memory at Row 5000: 67.45 MB
# üß† Memory at End: 48.12 MB
```

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### Docker Compose

```yaml
environment:
  AUTO_POPULATE_REFERENCES: true  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
  IS_DOCKER: true                 # –î–µ—Ç–µ–∫—Ü—ñ—è Docker —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
```

### Django Settings

```python
# settings.py
AUTO_POPULATE_REFERENCES = True  # –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∞–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
```

### –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

```bash
export AUTO_POPULATE_REFERENCES=true
export IS_DOCKER=true
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏ –∞–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
python manage.py test apps.ads.tests.test_auto_populate

# –¢–µ—Å—Ç–∏ –≤–∫–ª—é—á–∞—é—Ç—å:
# - –ê–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ø—Ä–∏ –ø—É—Å—Ç–∏—Ö –¥–æ–≤—ñ–¥–Ω–∏–∫–∞—Ö
# - –ü—Ä–æ–ø—É—Å–∫ –ø—Ä–∏ —ñ—Å–Ω—É—é—á–∏—Ö –¥–∞–Ω–∏—Ö
# - –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–∞–º'—è—Ç—ñ
# - –ó–∞–∫—Ä–∏—Ç—Ç—è –∑'—î–¥–Ω–∞–Ω—å
# - –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
```

## üìà –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å

### –¢–∏–ø–æ–≤—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏:

- **–®–≤–∏–¥–∫–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è**: ~30 —Å–µ–∫—É–Ω–¥ (10k —Ä—è–¥–∫—ñ–≤)
- **–ü–æ–≤–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è**: ~2-5 —Ö–≤–∏–ª–∏–Ω (20k+ —Ä—è–¥–∫—ñ–≤)
- **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ**: 50-100 MB
- **–†–æ–∑–º—ñ—Ä –±–∞—Ç—á—É**: 500-2000 –∑–∞–ø–∏—Å—ñ–≤

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:

1. **–î–ª—è production**: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
2. **–î–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏**: `seed_references_safe --clear`
3. **–î–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è**: `auto_populate_references --force`

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤—ñ –º–æ–º–µ–Ω—Ç–∏

### –ë–µ–∑–ø–µ–∫–∞:

1. **–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó**: –≤—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤ atomic –±–ª–æ–∫–∞—Ö
2. **Ignore conflicts**: —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤
3. **Graceful errors**: –Ω–µ –ª–∞–º–∞—î –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö
4. **Resource cleanup**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤

### –û–±–º–µ–∂–µ–Ω–Ω—è:

1. **CSV —Ñ–∞–π–ª**: –ø–æ–≤–∏–Ω–µ–Ω —ñ—Å–Ω—É–≤–∞—Ç–∏ –≤ `backend/core/data/`
2. **–§–æ—Ä–º–∞—Ç**: —Å—Ç—Ä–æ–≥–æ 3 –∫–æ–ª–æ–Ω–∫–∏ (—Ç–∏–ø, –º–∞—Ä–∫–∞, –º–æ–¥–µ–ª—å)
3. **–ö–æ–¥—É–≤–∞–Ω–Ω—è**: UTF-8
4. **–†–æ–∑–º—ñ—Ä**: –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –¥–ª—è —Ñ–∞–π–ª—ñ–≤ –¥–æ 50MB

## üîç –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É:

```python
from apps.ads.models.reference import VehicleTypeModel, CarMarkModel, CarModel

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤
print(f"Vehicle types: {VehicleTypeModel.objects.count()}")
print(f"Car marks: {CarMarkModel.objects.count()}")
print(f"Car models: {CarModel.objects.count()}")
```

### –õ–æ–≥–∏:

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏ Docker
docker-compose logs app | grep "Auto-populating"

# –û—á—ñ–∫—É–≤–∞–Ω–∏–π –≤–∏–≤—ñ–¥:
# üöÄ Auto-populating car reference data...
# ‚úÖ Created 8 vehicle types
# ‚úÖ Created 245 car marks
# ‚úÖ Created 3420 car models
```

## üö® –£—Å—É–Ω–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –î–∞–Ω—ñ –Ω–µ –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
echo $AUTO_POPULATE_REFERENCES
echo $IS_DOCKER

# –ü—Ä–∏–º—É—Å–æ–≤–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
python manage.py auto_populate_references --force
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–º–∏–ª–∫–∏ –ø–∞–º'—è—Ç—ñ

```bash
# –ó–º–µ–Ω—à–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä –±–∞—Ç—á—É
python manage.py seed_references_safe --batch-size 100

# –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º'—è—Ç—ñ
python manage.py seed_references_safe --monitor-memory
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–≤—ñ–ª—å–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è

```bash
# –®–≤–∏–¥–∫–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è (–æ–±–º–µ–∂–µ–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å)
python manage.py auto_populate_references

# –ê–±–æ –∑ –ª—ñ–º—ñ—Ç–æ–º
python manage.py populate_car_references --limit 5000
```
