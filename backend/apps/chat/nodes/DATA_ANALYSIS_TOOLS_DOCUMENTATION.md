# üìä Data Analysis Tools - Pandas & Seaborn Integration

## Overview

–ù–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ **pandas** –∏ **seaborn**.

---

## üéØ Capabilities

### 1. **Statistical Analysis** (–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑)
- **Mean, Median, Std** (–°—Ä–µ–¥–Ω–µ–µ, –ú–µ–¥–∏–∞–Ω–∞, –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ)
- **Min/Max, Quantiles** (–ú–∏–Ω–∏–º—É–º/–ú–∞–∫—Å–∏–º—É–º, –ö–≤–∞–Ω—Ç–∏–ª–∏ Q25/Q75)
- **Correlation Matrix** (–ú–∞—Ç—Ä–∏—Ü–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤)

### 2. **Data Grouping** (–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
- **Group By** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Å—Ç–æ–ª–±—Ü–∞ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
- **Aggregation Functions**: `mean`, `sum`, `count`, `min`, `max`
- **Value Counts** –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### 3. **Visualization** (–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–ø—Ä–æ—Å–∞:
- **Histogram** (–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è)
- **Heatmap** (—Ç–µ–ø–ª–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π)
- **Scatter Plot** (—Ç–æ—á–µ—á–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã)
- **Box Plot** (—è—â–∏–∫–∏ —Å —É—Å–∞–º–∏)
- **Bar Chart** (—Å—Ç–æ–ª–±—á–∞—Ç—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã)
- **Line Plot** (–ª–∏–Ω–µ–π–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ —Ç—Ä–µ–Ω–¥–∞)

---

## üîß Technical Implementation

### Intent Classification

**Intent**: `DATA_ANALYSIS`

**Trigger Keywords** (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ LLM):
- "—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑"
- "–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞", "—Å–≥—Ä—É–ø–ø–∏—Ä—É–π", "group by"
- "–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è", "–≥—Ä–∞—Ñ–∏–∫", "chart", "plot"
- "–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è", "correlation"
- "—Å—Ä–µ–¥–Ω–µ–µ", "–º–µ–¥–∏–∞–Ω–∞", "mean", "median"

**Examples**:
```
‚úÖ "–ü–æ—Å—á–∏—Ç–∞–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —ç—Ç–∏–º –¥–∞–Ω–Ω—ã–º"
‚úÖ "–ü–æ—Å—Ç—Ä–æ–π –≥—Ä–∞—Ñ–∏–∫ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏"
‚úÖ "–°–≥—Ä—É–ø–ø–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"
‚úÖ "–ü–æ–∫–∞–∂–∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–µ–Ω"
‚úÖ "–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –≥—Ä—É–ø–ø–∞–º"
```

### Node: `pandas_analysis_node`

**Location**: `backend/apps/chat/nodes/data_analysis_nodes.py`

**Input**:
- `state.context['data_for_analysis']` - List[Dict] —Å –¥–∞–Ω–Ω—ã–º–∏
- `state.table_data` - Fallback –µ—Å–ª–∏ `data_for_analysis` –Ω–µ –∑–∞–¥–∞–Ω
- `state.query` - –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –∞–Ω–∞–ª–∏–∑–∞

**Output**:
- `state.result` - –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `state.image_url` - Base64-encoded –≥—Ä–∞—Ñ–∏–∫ (–µ—Å–ª–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)
- `state.images` - –°–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `state.metadata` - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞

---

## üì¶ Service Class: `DataAnalysisService`

### Methods

#### 1. `analyze_data(data, query)` 
–ì–ª–∞–≤–Ω—ã–π –º–µ—Ç–æ–¥ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö.

**Returns**:
```python
{
    'dataframe_info': {...},      # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ DataFrame
    'statistics': {...},           # –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
    'grouped_data': {...},         # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
    'visualization': "data:image/png;base64,...",  # –ì—Ä–∞—Ñ–∏–∫
    'summary_text': "..."         # –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Ä–µ–∑—é–º–µ
}
```

#### 2. `_statistical_analysis(df)`
–í—ã—á–∏—Å–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤.

**Returns**:
```python
{
    'column_name': {
        'count': 100,
        'mean': 45.2,
        'median': 42.0,
        'std': 12.5,
        'min': 10.0,
        'max': 90.0,
        'q25': 30.0,
        'q75': 60.0
    },
    'correlation_matrix': {...}
}
```

#### 3. `_group_data(df, query)`
–ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π.

**Returns**:
```python
{
    'grouped_by': 'category',
    'numeric_columns': ['price', 'quantity'],
    'aggregation': ['mean', 'sum', 'count', 'min', 'max'],
    'results': {...}
}
```

#### 4. `_create_visualization(df, query)`
–°–æ–∑–¥–∞–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–ø—Ä–æ—Å–∞.

**Returns**: Base64-encoded PNG image string.

**Chart Types Detection**:
- "–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º" / "histogram" ‚Üí Histogram
- "—Ç–µ–ø–ª–æ–≤–∞—è" / "heatmap" / "–∫–æ—Ä—Ä–µ–ª—è" ‚Üí Correlation Heatmap
- "scatter" / "—Ç–æ—á–µ—á–Ω" ‚Üí Scatter Plot
- "box" / "—è—â–∏–∫" ‚Üí Box Plot
- Default ‚Üí Bar Chart or Line Plot

---

## üöÄ Usage Examples

### Example 1: Statistical Analysis

**User Query**:
```
"–ü–æ—Å—á–∏—Ç–∞–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ü–µ–Ω–∞–º"
```

**Data** (from crawler or other source):
```python
[
    {"name": "Product 1", "price": 100.0, "category": "A"},
    {"name": "Product 2", "price": 150.0, "category": "B"},
    {"name": "Product 3", "price": 120.0, "category": "A"},
    ...
]
```

**Response**:
```
üìà –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑:

**price:**
  ‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ: 123.33
  ‚Ä¢ –ú–µ–¥–∏–∞–Ω–∞: 120.00
  ‚Ä¢ Std: 25.17
  ‚Ä¢ Min: 100.00, Max: 150.00
  ‚Ä¢ Q25: 110.00, Q75: 135.00
```

---

### Example 2: Data Grouping

**User Query**:
```
"–°–≥—Ä—É–ø–ø–∏—Ä—É–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"
```

**Response**:
```
üî¢ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ 'category':

  ‚Ä¢ A: 15 items
  ‚Ä¢ B: 10 items
  ‚Ä¢ C: 8 items
```

---

### Example 3: Visualization

**User Query**:
```
"–ü–æ—Å—Ç—Ä–æ–π –≥—Ä–∞—Ñ–∏–∫ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É —Ü–µ–Ω–æ–π –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º"
```

**Response**:
- –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ**: Correlation heatmap (seaborn)

---

## üîó Integration Points

### 1. Graph Integration (`graph.py`)

```python
# Node –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä–∞—Ñ:
"data_analysis": pandas_analysis_node

# Routing:
Intent.DATA_ANALYSIS: "data_analysis"

# Edge to output:
graph.add_edge("data_analysis", "output")
```

### 2. Classifier Integration (`intelligent_classifier.py`)

```python
# Intent –æ–ø–∏—Å–∞–Ω –≤ system instructions:
- DATA_ANALYSIS: Statistical analysis, data grouping, 
                 visualization with pandas/seaborn

# Examples added:
- "–ü–æ—Å—á–∏—Ç–∞–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —ç—Ç–∏–º –¥–∞–Ω–Ω—ã–º" ‚Üí DATA_ANALYSIS + HISTORICAL
- "–ü–æ—Å—Ç—Ä–æ–π –≥—Ä–∞—Ñ–∏–∫ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏" ‚Üí DATA_ANALYSIS + HISTORICAL
- "–°–≥—Ä—É–ø–ø–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º" ‚Üí DATA_ANALYSIS + HISTORICAL
```

### 3. Data Flow

```
1. User Query ‚Üí Intent Classification (DATA_ANALYSIS)
2. Route to `pandas_analysis_node`
3. Extract data from state.context or state.table_data
4. Perform analysis (statistics, grouping, visualization)
5. Return results (text + image if applicable)
6. Send to user via WebSocket
```

---

## üé® Visualization Styling

**Seaborn Theme**: `whitegrid`  
**Palette**: `husl` (vibrant colors)  
**Figure Size**: `10x6` inches  
**DPI**: 100

**Chart Features**:
- Annotated heatmaps (values displayed)
- Labeled axes
- Titles and legends
- Tight layout for better presentation

---

## ‚öôÔ∏è Configuration

**Dependencies** (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã):
- `pandas ^2.2.0` - DataFrames and data manipulation
- `seaborn ^0.13.2` - Statistical visualizations
- `matplotlib ^3.10.3` - Plotting backend
- `numpy ^2.2.6` - Numerical operations

**Model Used** (for classification):
- Intent classification via `intelligent_classifier` (LLM-based)

---

## üìù Notes

- **Non-interactive backend**: `matplotlib.use('Agg')` –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
- **Base64 encoding**: –ì—Ä–∞—Ñ–∏–∫–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–∞–∫ data URLs
- **Intelligent column detection**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
- **Error handling**: Graceful degradation —Å fallback –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

## üîÆ Future Enhancements

- [ ] Support for time series analysis
- [ ] Custom color palettes based on user preferences
- [ ] Advanced statistical tests (t-test, ANOVA, chi-square)
- [ ] Multi-chart compositions (subplots)
- [ ] Interactive plots with Plotly
- [ ] Export to CSV/Excel
- [ ] Data cleaning and preprocessing tools
- [ ] Machine learning predictions (linear regression, clustering)

---

**Created**: 2025-10-24  
**Author**: AI Assistant  
**Version**: 1.0

