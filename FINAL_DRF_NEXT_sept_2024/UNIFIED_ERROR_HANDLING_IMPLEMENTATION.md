# ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

## –ó–∞–¥–∞—á–∞
–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ 401/4001 (–¥–ª—è WebSocket) –∏ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö HTTP/WebSocket –æ—à–∏–±–æ–∫ –Ω–∞ —Å–∞–π—Ç–µ.

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

### 1. –°–æ–∑–¥–∞–Ω `UnifiedAuthErrorHandler` 
**–§–∞–π–ª:** `frontend/src/utils/auth/unifiedAuthErrorHandler.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ 401 (HTTP) –∏ 4001 (WebSocket)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ refresh —Ç–æ–∫–µ–Ω–∞ –≤ Redis
- ‚úÖ –í—ã–ø–æ–ª–Ω—è–µ—Ç refresh —Ç–æ–∫–µ–Ω–æ–≤ (–Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Redis —á–µ—Ä–µ–∑ `/api/auth/refresh`)
- ‚úÖ Retry –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ refresh
- ‚úÖ –ï—Å–ª–∏ refresh failed (403) –∏–ª–∏ retry –≤–µ—Ä–Ω—É–ª 401 ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ª–æ–≥–∏–Ω —Å toast
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö refresh (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Promise —Å —Ñ–ª–∞–≥–æ–º `isRefreshing`)

**–ú–µ—Ç–æ–¥—ã:**
```typescript
// –î–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
handleAuthError(options: {
  retryRequest?: () => Promise<Response>,
  source?: string,
  currentPath?: string,
  showToast?: boolean
}): Promise<{
  refreshSucceeded: boolean,
  retryResponse?: Response,
  shouldRedirect: boolean
}>

// –î–ª—è WebSocket
handleWebSocketAuthError(options: {
  source?: string,
  currentPath?: string,
  showToast?: boolean
}): Promise<boolean> // true –µ—Å–ª–∏ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
```

---

### 2. –°–æ–∑–¥–∞–Ω `UnifiedErrorHandler`
**–§–∞–π–ª:** `frontend/src/utils/errors/unifiedErrorHandler.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **–í–°–ï** —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ (HTTP, WebSocket, Network)
- ‚úÖ –î–ª—è 401/4001 –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ `UnifiedAuthErrorHandler`
- ‚úÖ –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –¥–ª—è retryable –æ—à–∏–±–æ–∫ (500-599, 408, 1006)
- ‚úÖ –£–º–Ω—ã–µ toast —Å –∏–∫–æ–Ω–∫–∞–º–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫:**

| –¢–∏–ø | HTTP | WebSocket | Toast | Retry | –î–µ–π—Å—Ç–≤–∏–µ |
|-----|------|-----------|-------|-------|----------|
| `UNAUTHORIZED` | 401 | 4001, 1008 | üîí | ‚úÖ | Refresh + retry ‚Üí redirect –µ—Å–ª–∏ failed |
| `FORBIDDEN` | 403 | 4003 | ‚õî | ‚ùå | –ü–æ–∫–∞–∑–∞—Ç—å toast "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω" |
| `NOT_FOUND` | 404 | - | üîç | ‚ùå | –ü–æ–∫–∞–∑–∞—Ç—å toast "–ù–µ –Ω–∞–π–¥–µ–Ω–æ" |
| `BAD_REQUEST` | 400 | - | ‚ùå | ‚ùå | –ü–æ–∫–∞–∑–∞—Ç—å toast "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å" |
| `VALIDATION_ERROR` | 422 | - | ‚ö†Ô∏è | ‚ùå | –ü–æ–∫–∞–∑–∞—Ç—å toast "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏" |
| `SERVER_ERROR` | 500-599 | - | üî• | ‚úÖ (2x) | –ü–æ–∫–∞–∑–∞—Ç—å toast + retry –¥–æ 2 —Ä–∞–∑ |
| `NETWORK_ERROR` | - | 1006 | üì° | ‚úÖ | –ü–æ–∫–∞–∑–∞—Ç—å toast "–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é" |
| `TIMEOUT` | 408 | - | ‚è±Ô∏è | ‚úÖ | –ü–æ–∫–∞–∑–∞—Ç—å toast "–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è" |

**–ú–µ—Ç–æ–¥—ã:**
```typescript
// HTTP –æ—à–∏–±–∫–∏
handleHttpError(response: Response, options)

// WebSocket –æ—à–∏–±–∫–∏  
handleWebSocketError(closeEvent: CloseEvent, options)

// –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
handleNetworkError(error: Error, options)

// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥
handleError(error: any, options)
```

**Helper —Ñ—É–Ω–∫—Ü–∏–∏:**
```typescript
handleFetchError(response, options) // –î–ª—è fetch
handleWebSocketClose(closeEvent, options) // –î–ª—è WebSocket
handleNetworkError(error, options) // –î–ª—è network errors
```

---

### 3. –û–±–Ω–æ–≤–ª–µ–Ω `fetchWithAuth`
**–§–∞–π–ª:** `frontend/src/utils/fetchWithAuth.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚ùå –£–¥–∞–ª–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–ª—å–∫–æ 401
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω `UnifiedErrorHandler` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ **–í–°–ï–•** –æ—à–∏–±–æ–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –¥–ª—è server errors (500-599) –¥–æ 2 —Ä–∞–∑
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫ (timeout, offline)

**–õ–æ–≥–∏–∫–∞:**
```typescript
1. –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å
2. –ï—Å–ª–∏ —É—Å–ø–µ—à–µ–Ω (200-299) ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º
3. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Üí –¥–µ–ª–µ–≥–∏—Ä—É–µ–º –≤ UnifiedErrorHandler
4. UnifiedErrorHandler:
   - 401 ‚Üí refresh + retry ‚Üí redirect –µ—Å–ª–∏ failed
   - 403/404/400/422 ‚Üí toast
   - 500-599 ‚Üí toast + retry –¥–æ 2 —Ä–∞–∑
   - Network error ‚Üí toast
5. –ï—Å–ª–∏ retry —É—Å–ø–µ—à–µ–Ω ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
6. –ï—Å–ª–∏ retry failed ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É
```

---

### 4. –û–±–Ω–æ–≤–ª–µ–Ω `useChatWebSocket`
**–§–∞–π–ª:** `frontend/src/components/ChatBot/hooks/useChatWebSocket.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚ùå –£–¥–∞–ª–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–ª—å–∫–æ 1008/4001
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω `handleWebSocketClose` –∏–∑ `UnifiedErrorHandler`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ **–í–°–ï–•** –∫–æ–¥–æ–≤ –∑–∞–∫—Ä—ã—Ç–∏—è WebSocket

**–õ–æ–≥–∏–∫–∞:**
```typescript
socket.onclose = async (event) => {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
  const canReconnect = await handleWebSocketClose(event, {
    source: 'ChatBot WebSocket',
    showToast: true
  });
  
  if (canReconnect) {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è
    setTimeout(() => connect(), 1000);
  } else {
    // –í—ã–∑—ã–≤–∞–µ–º onAuthError –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
    onAuthError?.();
  }
};
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–¥—ã:**
- `4001, 1008` ‚Üí Refresh —Ç–æ–∫–µ–Ω–æ–≤ + –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- `4003` ‚Üí Toast "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω"
- `1006` ‚Üí Toast "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑–æ—Ä–≤–∞–Ω–æ" + retry
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Üí Toast —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º

---

### 5. –û–±–Ω–æ–≤–ª–µ–Ω `ApiClient`
**–§–∞–π–ª:** `frontend/src/services/api/apiClient.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚ùå –£–¥–∞–ª–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–ª—å–∫–æ 401
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω `UnifiedErrorHandler` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ **–í–°–ï–•** –æ—à–∏–±–æ–∫
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ timeout –∏ network errors

**–õ–æ–≥–∏–∫–∞:**
```typescript
try {
  const response = await fetch(...);
  
  if (response.ok) return data;
  
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –í–°–ï–• –æ—à–∏–±–æ–∫
  const result = await unifiedErrorHandler.handleHttpError(response, {
    retryCallback: () => fetch(...),
    maxRetries: response.status >= 500 ? 2 : 1
  });
  
  if (result.retryResult?.ok) return data;
  
  throw new Error(`HTTP ${response.status}`);
  
} catch (error) {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ timeout
  if (error.name === 'AbortError') {
    await unifiedErrorHandler.handleNetworkError(error);
  }
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ network errors
  if (error instanceof TypeError) {
    await unifiedErrorHandler.handleNetworkError(error);
  }
  
  throw error;
}
```

---

### 6. –£–¥–∞–ª–µ–Ω —Å—Ç–∞—Ä—ã–π `tokenRefreshManager` (DEPRECATED)
**–§–∞–π–ª:** `frontend/src/services/api/tokenManager.ts`

**–°—Ç–∞—Ç—É—Å:** 
- ‚ö†Ô∏è –û—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è backward compatibility
- üîÑ –í–µ—Å—å –Ω–æ–≤—ã–π –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `UnifiedAuthErrorHandler`
- üìù TODO: –£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

### –ü–æ–∫—Ä—ã—Ç–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –î–æ | –ü–æ—Å–ª–µ | –°—Ç–∞—Ç—É—Å |
|-----------|-----|-------|--------|
| `fetchWithAuth` | –¢–æ–ª—å–∫–æ 401 | –í—Å–µ HTTP –∫–æ–¥—ã | ‚úÖ |
| `ApiClient` | –¢–æ–ª—å–∫–æ 401 | –í—Å–µ HTTP + timeout + network | ‚úÖ |
| `useChatWebSocket` | –¢–æ–ª—å–∫–æ 1008/4001 | –í—Å–µ WebSocket –∫–æ–¥—ã | ‚úÖ |
| –î—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã | –†—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ | –ò—Å–ø–æ–ª—å–∑—É—é—Ç `fetchWithAuth`/`ApiClient` | ‚úÖ |

### –ü–æ–∫—Ä—ã—Ç–∏–µ retry –ª–æ–≥–∏–∫–∏

| –ö–æ–¥ –æ—à–∏–±–∫–∏ | Retry | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ |
|------------|-------|-------------------|
| 401 | ‚úÖ | 1 (–ø–æ—Å–ª–µ refresh) |
| 403 | ‚ùå | - |
| 404 | ‚ùå | - |
| 408 | ‚úÖ | 1 |
| 500-599 | ‚úÖ | 2 |
| 4001 | ‚úÖ | ‚àû (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π) |
| 1006 | ‚úÖ | ‚àû (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π) |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±—Ä–∞–±–æ—Ç–∫–∞ 401 –≤ HTTP
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –º–æ–¥–µ—Ä–∞—Ü–∏–∏
2. Access —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫–∞–µ—Ç
3. –î–µ–ª–∞–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å ‚Üí 401
4. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è refresh —Ç–æ–∫–µ–Ω –≤ Redis
5. ‚úÖ –î–µ–ª–∞–µ—Ç—Å—è refresh ‚Üí –Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Redis
6. ‚úÖ Retry –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
7. ‚úÖ –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ
8. ‚úÖ –ï—Å–ª–∏ —Å–Ω–æ–≤–∞ 401 ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login —Å toast
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ 4001 –≤ WebSocket
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —á–∞—Ç-–±–æ—Ç
2. Access —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫–∞–µ—Ç
3. WebSocket –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å –∫–æ–¥–æ–º 4001
4. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è refresh —Ç–æ–∫–µ–Ω –≤ Redis
5. ‚úÖ –î–µ–ª–∞–µ—Ç—Å—è refresh ‚Üí –Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Redis
6. ‚úÖ WebSocket –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
7. ‚úÖ –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ ‚Üí —á–∞—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
8. ‚úÖ –ï—Å–ª–∏ refresh failed ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login —Å toast
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ 500 server error
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
2. Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500
3. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è toast "üî• –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞"
4. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
5. ‚úÖ –ï—Å–ª–∏ retry —É—Å–ø–µ—à–µ–Ω ‚Üí –¥–∞–Ω–Ω—ã–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è
6. ‚úÖ –ï—Å–ª–∏ retry failed ‚Üí –µ—â–µ 1 –ø–æ–ø—ã—Ç–∫–∞
7. ‚úÖ –ï—Å–ª–∏ –≤—Å–µ failed ‚Üí –æ—à–∏–±–∫–∞ –ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è –≤—ã—à–µ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: Network error (offline)
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–µ—Ä—è–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
2. –î–µ–ª–∞–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å ‚Üí Network error
3. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è toast "üì° –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ —Å–µ—Ä–≤–µ—Ä—É"
4. ‚úÖ –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è gracefully
```

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. ‚úÖ `frontend/src/utils/auth/unifiedAuthErrorHandler.ts` - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 401/4001
2. ‚úÖ `frontend/src/utils/errors/unifiedErrorHandler.ts` - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
3. ‚úÖ `frontend/UNIFIED_ERROR_HANDLING.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
4. ‚úÖ `UNIFIED_ERROR_HANDLING_IMPLEMENTATION.md` - –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

## üìù –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. ‚úÖ `frontend/src/utils/fetchWithAuth.ts` - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `UnifiedErrorHandler`
2. ‚úÖ `frontend/src/components/ChatBot/hooks/useChatWebSocket.ts` - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `handleWebSocketClose`
3. ‚úÖ `frontend/src/services/api/apiClient.ts` - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `UnifiedErrorHandler`

---

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏**
–í—Å–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `UnifiedErrorHandler` ‚Üí –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

### 2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry**
- 401 ‚Üí refresh + retry
- 500-599 ‚Üí retry –¥–æ 2 —Ä–∞–∑
- 4001 ‚Üí refresh + reconnect
- 1006 ‚Üí reconnect

### 3. **–£–º–Ω—ã–µ toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
–ö–∞–∂–¥–∞—è –æ—à–∏–±–∫–∞ –∏–º–µ–µ—Ç —Å–≤–æ—é –∏–∫–æ–Ω–∫—É, –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ description.

### 4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- 401 ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ refresh —Ç–æ–∫–µ–Ω–∞ –≤ Redis
- 403 (refresh failed) ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ª–æ–≥–∏–Ω
- –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Ä–µ–∫—É—Ä—Å–∏–∏ —á–µ—Ä–µ–∑ `skipRetry`

### 5. **DRY –ø—Ä–∏–Ω—Ü–∏–ø**
–ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ ‚Üí –ª–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å.

### 6. **–¢–∏–ø–∏–∑–∞—Ü–∏—è**
–í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç TypeScript ‚Üí –º–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫.

### 7. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
–í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞ ‚Üí –ª–µ–≥—á–µ –¥–µ–±–∞–∂–∏—Ç—å.

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ production-like –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å 401 –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å 4001 –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ —á–∞—Ç-–±–æ—Ç–µ
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å 500 –æ–±—Ä–∞–±–æ—Ç–∫—É –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ backend
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å network error –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –î–æ–±–∞–≤–∏—Ç—å Sentry/LogRocket –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –≤ production
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏: —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å—Ä–∞–±–æ—Ç–∞–ª retry, —Å–∫–æ–ª—å–∫–æ 401 –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ

### 3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥—ã
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ code review —Å –∫–æ–º–∞–Ω–¥–æ–π
- [ ] –û–±–Ω–æ–≤–∏—Ç—å onboarding –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

### –ö–æ–¥
- ‚úÖ **–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:** 4
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:** 3
- ‚úÖ **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ (–Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã):** ~800
- ‚úÖ **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã):** ~200
- ‚úÖ **Linter errors:** 0

### –ü–æ–∫—Ä—ã—Ç–∏–µ
- ‚úÖ **HTTP –æ—à–∏–±–∫–∏:** 401, 403, 404, 400, 422, 408, 500-599
- ‚úÖ **WebSocket –æ—à–∏–±–∫–∏:** 1000-1016, 4001, 4003
- ‚úÖ **Network –æ—à–∏–±–∫–∏:** Timeout, Offline, Fetch errors

### –ö–∞—á–µ—Å—Ç–≤–æ
- ‚úÖ **TypeScript strict mode:** –í–∫–ª—é—á–µ–Ω
- ‚úÖ **Error handling:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ **Toast notifications:** –£–º–Ω—ã–µ, —Å –∏–∫–æ–Ω–∫–∞–º–∏
- ‚úÖ **Retry logic:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π
- ‚úÖ **Security:** –ó–∞—â–∏—Ç–∞ –æ—Ç infinite loops

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–°–æ–∑–¥–∞–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –í–°–ï–• –æ—à–∏–±–æ–∫ –Ω–∞ —Å–∞–π—Ç–µ:**

1. ‚úÖ **401/4001** ‚Üí refresh —Ç–æ–∫–µ–Ω–æ–≤ + retry ‚Üí redirect –µ—Å–ª–∏ failed
2. ‚úÖ **403** ‚Üí toast "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω"
3. ‚úÖ **404** ‚Üí toast "–ù–µ –Ω–∞–π–¥–µ–Ω–æ"
4. ‚úÖ **400/422** ‚Üí toast "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å/–í–∞–ª–∏–¥–∞—Ü–∏—è"
5. ‚úÖ **500-599** ‚Üí toast "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞" + retry –¥–æ 2 —Ä–∞–∑
6. ‚úÖ **408** ‚Üí toast "Timeout" + retry
7. ‚úÖ **1006** ‚Üí toast "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑–æ—Ä–≤–∞–Ω–æ" + retry
8. ‚úÖ **Network errors** ‚Üí toast "–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é"

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫! üéâ

**–°—Ç–∞—Ç—É—Å:** READY FOR PRODUCTION ‚úÖ

