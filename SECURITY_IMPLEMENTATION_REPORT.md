# üîí –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏

## –î–∞—Ç–∞: 2025-10-24

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞

### 1. **Backend API - –ú–æ–¥–µ—Ä–∞—Ü–∏—è** ‚úÖ

**–§–∞–π–ª:** `backend/apps/ads/views/moderation_queue_views.py`

**–ó–∞—â–∏—Ç–∞:**
```python
# –û—á–µ—Ä–µ–¥—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏
class ModerationQueueView:
    permission_classes = [IsAuthenticated, IsStaffOrSuperUser]  ‚úÖ

# Approve, Reject, Review
@permission_classes([IsAuthenticated, IsStaffOrSuperUser])  ‚úÖ

# Block, Activate (–¢–û–õ–¨–ö–û —Å—É–ø–µ—Ä—é–∑–µ—Ä)
@permission_classes([IsAuthenticated, IsSuperUser])  ‚úÖ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –¢–æ–ª—å–∫–æ staff –∏ superuser –º–æ–≥—É—Ç –º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞—Ç—å

---

### 2. **Backend API - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∞–∫–∫–∞—É–Ω—Ç–∞** ‚úÖ

**–§–∞–π–ª:** `backend/apps/accounts/views/account_type_views.py`

**–ó–∞—â–∏—Ç–∞:**
```python
@api_view(['PATCH'])
@permission_classes([IsAuthenticated, IsSuperUser])  ‚úÖ
def change_account_type(request, account_id):
    """Change BASIC ‚Üî PREMIUM (–¢–û–õ–¨–ö–û —Å—É–ø–µ—Ä—é–∑–µ—Ä)"""
```

**Endpoint:** `PATCH /api/accounts/{account_id}/change-type/`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `account_type`: "BASIC" –∏–ª–∏ "PREMIUM"
- `reason`: –ø—Ä–∏—á–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- `notify_user`: —É–≤–µ–¥–æ–º–∏—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `valid_until`: —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–¥–ª—è premium)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –¢–æ–ª—å–∫–æ superuser –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞

---

### 3. **Frontend - –ú–µ–Ω—é –º–æ–¥–µ—Ä–∞—Ü–∏–∏** ‚úÖ

**–§–∞–π–ª:** `frontend/src/components/AutoRia/Layout/AutoRiaHeader.tsx`

**–ó–∞—â–∏—Ç–∞:**
```typescript
const moderationItem = {
  href: '/autoria/moderation',
  label: '–ú–æ–¥–µ—Ä–∞—Ü–∏—è',
  icon: Shield,
  id: 'moderation',
};

// –¢–æ–ª—å–∫–æ –¥–ª—è —Å—É–ø–µ—Ä—é–∑–µ—Ä–æ–≤
...(isSuperUser ? [moderationItem] : []),  ‚úÖ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü—É–Ω–∫—Ç –º–µ–Ω—é "–ú–æ–¥–µ—Ä–∞—Ü–∏—è" –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ superuser

---

### 4. **Frontend - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏** ‚úÖ

**–§–∞–π–ª:** `frontend/src/components/AutoRia/Pages/ModerationPage.tsx`

**–ó–∞—â–∏—Ç–∞:**
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ - –¢–û–õ–¨–ö–û —Å—É–ø–µ—Ä—é–∑–µ—Ä—ã
useEffect(() => {
  if (authLoading) return;

  if (!isSuperUser) {
    toast({
      title: "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω",
      description: "–¢–æ–ª—å–∫–æ —Å—É–ø–µ—Ä—é–∑–µ—Ä—ã –º–æ–≥—É—Ç –º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è",
      variant: "destructive",
    });
    
    // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
    setTimeout(() => {
      window.location.href = '/';
    }, 1000);
  }
}, [isSuperUser, authLoading, toast]);  ‚úÖ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ù–µ-—Å—É–ø–µ—Ä—é–∑–µ—Ä—ã –Ω–µ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É

---

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|------------|--------|------------|
| **–ü—É–Ω–∫—Ç –º–µ–Ω—é –º–æ–¥–µ—Ä–∞—Ü–∏—è –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ superuser** | ‚úÖ | `AutoRiaHeader.tsx` - —É—Å–ª–æ–≤–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ |
| **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ superuser** | ‚úÖ | `ModerationPage.tsx` - –ø—Ä–æ–≤–µ—Ä–∫–∞ + —Ä–µ–¥–∏—Ä–µ–∫—Ç |
| **–ú–æ–¥–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ superuser** | ‚úÖ | Backend API - `IsStaffOrSuperUser` |
| **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ BASIC ‚Üî PREMIUM —Ç–æ–ª—å–∫–æ superuser** | ‚úÖ | Backend API - `IsSuperUser` |

---

## üîê –£—Ä–æ–≤–Ω–∏ –∑–∞—â–∏—Ç—ã

### Backend (3 —É—Ä–æ–≤–Ω—è):
1. **Permission Classes** - `IsSuperUser`, `IsStaffOrSuperUser`
2. **API Endpoints** - –ø—Ä–æ–≤–µ—Ä–∫–∞ permissions
3. **Business Logic** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### Frontend (3 —É—Ä–æ–≤–Ω—è):
1. **–ú–µ–Ω—é** - —É—Å–ª–æ–≤–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
2. **Routing** - –ø—Ä–æ–≤–µ—Ä–∫–∞ + —Ä–µ–¥–∏—Ä–µ–∫—Ç
3. **UI Components** - —É—Å–ª–æ–≤–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫

---

## üéØ API –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∞–∫–∫–∞—É–Ω—Ç–∞

### Endpoint:
```
PATCH /api/accounts/{account_id}/change-type/
```

### Request:
```json
{
  "account_type": "PREMIUM",  // –∏–ª–∏ "BASIC"
  "reason": "Promotional upgrade",
  "notify_user": true,
  "valid_until": "2025-12-31T23:59:59Z"  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}
```

### Response:
```json
{
  "account_id": 123,
  "user_email": "user@example.com",
  "old_type": "BASIC",
  "new_type": "PREMIUM",
  "changed_by": "admin@example.com",
  "changed_at": "2025-10-24T15:30:00Z",
  "reason": "Promotional upgrade",
  "valid_until": "2025-12-31T23:59:59Z"
}
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å:
1. ‚è≥ Frontend UI –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∞–∫–∫–∞—É–Ω—Ç–∞
2. ‚è≥ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
3. ‚è≥ –ö–Ω–æ–ø–∫–∞ "–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ Premium" / "–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ Basic"
4. ‚è≥ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –∏ –ø—Ä–∏—á–∏–Ω–æ–π

---

## ‚úÖ –ò—Ç–æ–≥

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞:**
- ‚úÖ Backend API –∑–∞—â–∏—â–µ–Ω
- ‚úÖ Frontend –º–µ–Ω—é –∑–∞—â–∏—â–µ–Ω–æ
- ‚úÖ Frontend —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞—â–∏—â–µ–Ω–∞
- ‚úÖ API –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—â–∏—â–µ–Ω

**–ù–µ-—Å—É–ø–µ—Ä—é–∑–µ—Ä—ã:**
- ‚ùå –ù–µ –≤–∏–¥—è—Ç –ø—É–Ω–∫—Ç –º–µ–Ω—é "–ú–æ–¥–µ—Ä–∞—Ü–∏—è"
- ‚ùå –ù–µ –º–æ–≥—É—Ç –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (—Ä–µ–¥–∏—Ä–µ–∫—Ç)
- ‚ùå –ù–µ –º–æ–≥—É—Ç –≤—ã–∑–≤–∞—Ç—å API –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (401/403)
- ‚ùå –ù–µ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞ (403)

**–¢–æ–ª—å–∫–æ —Å—É–ø–µ—Ä—é–∑–µ—Ä—ã –º–æ–≥—É—Ç:**
- ‚úÖ –í–∏–¥–µ—Ç—å –º–µ–Ω—é –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –û—Ç–∫—Ä—ã–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –ú–æ–¥–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- ‚úÖ –ò–∑–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞ BASIC ‚Üî PREMIUM

---

**–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã! üîí**

