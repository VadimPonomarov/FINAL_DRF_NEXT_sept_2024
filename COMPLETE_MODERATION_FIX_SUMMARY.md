# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç

## –î–∞—Ç–∞: 2025-10-24

---

## üéØ –ó–∞–¥–∞—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. ‚ùå –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫–∏ 500 –≤ GET –∑–∞–ø—Ä–æ—Å–∞—Ö
2. ‚ùå –ú–æ–¥–µ—Ä–∞—Ü–∏—è –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
3. ‚ùå –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä –Ω–µ –≤–∏–¥–∏—Ç –≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
4. ‚ùå –õ–æ–≥–∏–∫–∞: –≤—Å–µ —á—Ç–æ –µ—Å—Ç—å –≤ –ø–æ–∏—Å–∫–µ ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –º–æ–¥–µ—Ä–∞—Ü–∏–∏

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–§–∏–ª—å—Ç—Ä –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω** ‚úÖ

**–§–∞–π–ª:** `backend/apps/ads/views/moderation_queue_views.py`

**–ë—ã–ª–æ:**
```python
queryset = queryset.filter(
    status__in=[
        AdStatusEnum.PENDING,
        AdStatusEnum.NEEDS_REVIEW,
        AdStatusEnum.REJECTED,
        AdStatusEnum.BLOCKED,
        AdStatusEnum.ACTIVE,
    ]
)
```

**–°—Ç–∞–ª–æ:**
```python
# –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –≤–∏–¥—è—Ç –í–°–ï –æ–±—ä—è–≤–ª–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è —á–µ—Ä–Ω–æ–≤–∏–∫–∏ –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ
queryset = CarAd.objects.select_related(
    "account", "account__user", "mark", "moderated_by"
).order_by("-created_at")

# –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω —Å—Ç–∞—Ç—É—Å-—Ñ–∏–ª—å—Ç—Ä, –ø—Ä–∏–º–µ–Ω—è–µ–º –µ–≥–æ
status_filter = self.request.GET.get("status")
if status_filter:
    queryset = queryset.filter(status=status_filter)

# –í–ê–ñ–ù–û: –ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –í–°–ï –æ–±—ä—è–≤–ª–µ–Ω–∏—è
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –¢–µ–ø–µ—Ä—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç **–≤—Å–µ** –æ–±—ä—è–≤–ª–µ–Ω–∏—è (DRAFT, INCOMPLETE, PENDING, ACTIVE, REJECTED, BLOCKED)

---

### 2. **Reference endpoints –ø–æ—á–∏–Ω–µ–Ω—ã** ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `/api/public/reference/vehicle-types` ‚Üí 500 ‚ùå
- `/api/public/reference/regions` ‚Üí 500 ‚ùå  
- `/api/public/reference/colors` ‚Üí 500 ‚ùå

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `/api/public/reference/vehicle-types` ‚Üí 200 ‚úÖ
- `/api/public/reference/regions` ‚Üí 200 ‚úÖ
- `/api/public/reference/colors` ‚Üí 200 ‚úÖ

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏–ª–æ—Å—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ API routes

---

## ‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### **–ü—Ä–æ–±–ª–µ–º–∞ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π** ‚ùå

**–°–∏–º–ø—Ç–æ–º—ã:**
1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
2. **–ù–û** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–û–≥–æ–ª–æ—à–µ–Ω—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ"
3. **useAutoRiaAuth: ‚ùå** (–Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω)
4. **–ó–∞–ø—Ä–æ—Å –∫ `/api/ads/moderation/queue` –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è**

**–ü—Ä–∏—á–∏–Ω–∞:**
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç `ModerationPage` –∂–¥–µ—Ç `isAuthenticated === true` –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –¥–∞–Ω–Ω—ã—Ö:

```typescript
useEffect(() => {
    if (isAuthenticated) {  // ‚ùå –í—Å–µ–≥–¥–∞ false
      loadModerationQueue();
      loadModerationStats();
    }
  }, [statusFilter, searchQuery, sortBy, sortOrder, isAuthenticated]);
```

**–ö–æ–¥ –≤ `ModerationPage.tsx` (—Å—Ç—Ä–æ–∫–∏ 106-136):**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `isAuthenticated`
- –ï—Å–ª–∏ true ‚Üí –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ `/api/ads/moderation/queue`
- –ï—Å–ª–∏ false ‚Üí –Ω–µ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å

**Network requests:**
- ‚úÖ `/api/auth/session` ‚Üí 200 OK
- ‚úÖ All reference endpoints ‚Üí 200 OK
- ‚ùå `/api/ads/moderation/queue` ‚Üí **–ù–ï –û–¢–ü–†–ê–í–õ–Ø–ï–¢–°–Ø!**

---

## üîß –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `useAutoRiaAuth`
–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ö—É–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `isSuperUser` –≤–º–µ—Å—Ç–æ `isAuthenticated`:

```typescript
useEffect(() => {
    if (isSuperUser) {  // –£–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ true
      loadModerationQueue();
      loadModerationStats();
    }
  }, [statusFilter, searchQuery, sortBy, sortOrder, isSuperUser]);
```

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| **Backend —Ñ–∏–ª—å—Ç—Ä –º–æ–¥–µ—Ä–∞—Ü–∏–∏** | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–ï –æ–±—ä—è–≤–ª–µ–Ω–∏—è |
| **Reference endpoints** | ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç | 200 OK |
| **Frontend –º–æ–¥–µ—Ä–∞—Ü–∏—è** | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ |
| **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** | ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ | `useAutoRiaAuth` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç false |
| **–ó–∞–ø—Ä–æ—Å –∫ queue** | ‚ùå –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è | –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–æ–π `isAuthenticated` |

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚è≥ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å `useAutoRiaAuth` –ò–õ–ò
2. ‚è≥ –ò–∑–º–µ–Ω–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –≤ `ModerationPage` –Ω–∞ `isSuperUser` (—É–∂–µ true)
3. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –æ–±—ä—è–≤–ª–µ–Ω–∏–π
4. ‚è≥ –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –í–°–ï –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤–∏–¥–Ω—ã (–≤–∫–ª—é—á–∞—è —Ç–µ—Å—Ç–æ–≤—ã–µ —Å DRAFT)

---

**–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** Frontend –Ω–µ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ backend –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π ‚ùó

