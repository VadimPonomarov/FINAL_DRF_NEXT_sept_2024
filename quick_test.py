# -*- coding: utf-8 -*-
"""–®–≤–∏–¥–∫–∏–π —Ç–µ—Å—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—ó –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó"""
import sys
import io
import requests
import time

sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8', errors='replace')

BACKEND_URL = "http://localhost:8000/api/chat/generate-car-images/"

# –û–¥–∏–Ω —à–≤–∏–¥–∫–∏–π —Ç–µ—Å—Ç
test_data = {
    "car_data": {
        "brand": "Renault",
        "model": "Clio",
        "year": 2019,
        "color": "blue",
        "vehicle_type_name": "–ª–µ–≥–∫–æ–≤—ñ",
        "body_type": "hatchback"
    },
    "angles": ["front", "side"],
    "style": "realistic",
    "use_mock_algorithm": True
}

print("üöÄ –¢–µ—Å—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—ó –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó...")
print(f"üìã –ú–∞—Ä–∫–∞: {test_data['car_data']['brand']} {test_data['car_data']['model']}")
print(f"üì∏ –†–∞–∫—É—Ä—Å–∏: {len(test_data['angles'])}")

start = time.time()
try:
    response = requests.post(BACKEND_URL, json=test_data, timeout=60)
    duration = time.time() - start
    
    if response.status_code == 200:
        result = response.json()
        images = result.get('images', [])
        session_id = result.get('session_id', '')
        
        print(f"\n‚úÖ –£—Å–ø—ñ—Ö! –ß–∞—Å: {duration:.1f}s")
        print(f"üìä –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ: {len(images)} –∑–æ–±—Ä–∞–∂–µ–Ω—å")
        print(f"üîó Session ID: {session_id}")
        
        # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ seeds
        seeds = [img.get('seed') for img in images]
        print(f"üé≤ Seeds: {seeds}")
        print(f"‚úì –£–Ω—ñ–∫–∞–ª—å–Ω—ñ: {'‚úÖ' if len(seeds) == len(set(seeds)) else '‚ùå'}")
        
        # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ consistency
        has_consistency = sum(1 for img in images if 'consistency' in img.get('prompt', '').lower())
        print(f"‚úì Consistency hints: {has_consistency}/{len(images)}")
        
        # URLs
        print(f"\nüñºÔ∏è –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è:")
        for img in images:
            print(f"   {img['angle']}: {img['url'][:60]}...")
            
    else:
        print(f"‚ùå –ü–æ–º–∏–ª–∫–∞: HTTP {response.status_code}")
        print(response.text[:200])
        
except Exception as e:
    print(f"‚ùå –ü–æ–º–∏–ª–∫–∞: {e}")

